var tl=Object.defineProperty;var ll=(p,h,i)=>h in p?tl(p,h,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[h]=i;var lt=(p,h,i)=>ll(p,typeof h!="symbol"?h+"":h,i);import{p as Dt,M as Lt,N as ol,ai as sl,F as nl,U as al,t as n,z as je,A as il,a as bt,c as Ue,d as Be,o as a,b as u,r as gt,n as ge,e as t,_ as Tt,q as rl,x as cl,s as ul,Y as e,Z as B,$ as _,a4 as l,i as r,h as fe,a8 as dl,G as pl,au as it,ad as Ze,H as ze,I as dt,w as fl,g as ml,aD as gl,aE as et,aB as pt,B as ot,aF as Oe,J as Ie,a3 as $e,f as Je,a0 as me,aG as vt,T as Nt,aH as rt,aI as at,aa as Fe,al as Ye,aJ as vl,a9 as Ve,V as nt,aK as hl,y as Vt}from"./index-DZ6OSBbF.js";import{v as ct,b as Xe,c as ft,e as mt}from"./el-select-B8Gl4LcX.js";import{E as Ut}from"./el-empty-Dvzr1Umg.js";import{U as Rt,C as Gt,b as tt,E as ht}from"./el-scrollbar-BlCa7Rp_.js";import{E as ut}from"./el-input-y9r0mkIm.js";import{E as Ke,a as xt}from"./el-button-qQztgBCg.js";import{I as S}from"./iconify-BPuWgN66.js";import{g as At}from"./account.StatusEnum-B7ItzWu9.js";import{g as yl,a as _l,d as Et,b as Ft,c as wt,e as Il,s as bl,f as xl,h as wl,i as zt,j as Pt,k as Cl,l as kl,m as Al,t as Ml,n as $l,o as jl,p as Sl,q as Dl,r as Ll,v as Tl,w as Nl,x as Vl,y as Ul,z as Rl}from"./im-DORR8L9K.js";import{c as Mt}from"./refs-oheuzvZj.js";import{E as Gl}from"./index-B7McNZUi.js";import{f as El}from"./index-qLe27GZx.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{E as Bt,a as Fl}from"./el-checkbox-BOfaHGRD.js";import{_ as zl}from"./oneClickG.vue_vue_type_script_setup_true_lang-CGkkst8S.js";import{G as yt,f as $t}from"./utils-BDpUbmYL.js";import"./el-tag-2XB_r1MG.js";import{E as Ht,a as qt}from"./el-table-column-CJ7COIBb.js";import{_ as Pl,E as Bl,a as Hl}from"./el-step-BMlsScJN.js";import{E as Ct,a as kt}from"./el-form-item-DTrh179H.js";import{a as Ot,b as ql,c as Kt,d as Ol,e as Kl,f as Jl,u as Wl,h as Ql,i as Zl}from"./material-HQDG54q8.js";import{E as Jt}from"./el-upload-av4bLNwW.js";import{E as Wt}from"./index-DD5px6PB.js";import{t as Qt}from"./translations-DaIsc1a6.js";import{E as Xl}from"./el-switch-BFr50as_.js";import{_ as Yl}from"./addSpeech.vue_vue_type_script_setup_true_lang-CuQsjwzW.js";import"./_Uint8Array-DLVRKYZY.js";import"./account-Dsg97R6N.js";import"./_initCloneObject-8AaWY8d6.js";import"./validator-D64yUxIT.js";const jt=p=>sl(p)||nl(p)||al(p),eo=Dt({accordion:Boolean,modelValue:{type:Lt([Array,String,Number]),default:()=>ol([])}}),to={[Rt]:jt,[Gt]:jt},Zt=Symbol("collapseContextKey"),lo=(p,h)=>{const i=n(Mt(p.modelValue)),o=y=>{i.value=y;const v=p.accordion?i.value[0]:i.value;h(Rt,v),h(Gt,v)},m=y=>{if(p.accordion)o([i.value[0]===y?"":y]);else{const v=[...i.value],j=v.indexOf(y);j>-1?v.splice(j,1):v.push(y),o(v)}};return je(()=>p.modelValue,()=>i.value=Mt(p.modelValue),{deep:!0}),il(Zt,{activeNames:i,handleItemClick:m}),{activeNames:i,setActiveNames:o}},oo=()=>{const p=bt("collapse");return{rootKls:Ue(()=>p.b())}},so=Be({name:"ElCollapse"}),no=Be({...so,props:eo,emits:to,setup(p,{expose:h,emit:i}){const o=p,{activeNames:m,setActiveNames:y}=lo(o,i),{rootKls:v}=oo();return h({activeNames:m,setActiveNames:y}),(j,E)=>(a(),u("div",{class:ge(t(v))},[gt(j.$slots,"default")],2))}});var ao=Tt(no,[["__file","collapse.vue"]]);const io=Dt({title:{type:String,default:""},name:{type:Lt([String,Number]),default:void 0},icon:{type:rl,default:cl},disabled:Boolean}),ro=p=>{const h=ul(Zt),{namespace:i}=bt("collapse"),o=n(!1),m=n(!1),y=El(),v=Ue(()=>y.current++),j=Ue(()=>{var te;return(te=p.name)!=null?te:`${i.value}-id-${y.prefix}-${t(v)}`}),E=Ue(()=>h==null?void 0:h.activeNames.value.includes(t(j)));return{focusing:o,id:v,isActive:E,handleFocus:()=>{setTimeout(()=>{m.value?m.value=!1:o.value=!0},50)},handleHeaderClick:()=>{p.disabled||(h==null||h.handleItemClick(t(j)),o.value=!1,m.value=!0)},handleEnterClick:()=>{h==null||h.handleItemClick(t(j))}}},co=(p,{focusing:h,isActive:i,id:o})=>{const m=bt("collapse"),y=Ue(()=>[m.b("item"),m.is("active",t(i)),m.is("disabled",p.disabled)]),v=Ue(()=>[m.be("item","header"),m.is("active",t(i)),{focusing:t(h)&&!p.disabled}]),j=Ue(()=>[m.be("item","arrow"),m.is("active",t(i))]),E=Ue(()=>m.be("item","wrap")),x=Ue(()=>m.be("item","content")),M=Ue(()=>m.b(`content-${t(o)}`)),L=Ue(()=>m.b(`head-${t(o)}`));return{arrowKls:j,headKls:v,rootKls:y,itemWrapperKls:E,itemContentKls:x,scopedContentId:M,scopedHeadId:L}},uo=Be({name:"ElCollapseItem"}),po=Be({...uo,props:io,setup(p,{expose:h}){const i=p,{focusing:o,id:m,isActive:y,handleFocus:v,handleHeaderClick:j,handleEnterClick:E}=ro(i),{arrowKls:x,headKls:M,rootKls:L,itemWrapperKls:te,itemContentKls:ce,scopedContentId:ie,scopedHeadId:H}=co(i,{focusing:o,isActive:y,id:m});return h({isActive:y}),(q,W)=>(a(),u("div",{class:ge(t(L))},[e("button",{id:t(H),class:ge(t(M)),"aria-expanded":t(y),"aria-controls":t(ie),"aria-describedby":t(ie),tabindex:q.disabled?-1:0,type:"button",onClick:t(j),onKeydown:it(Ze(t(E),["stop","prevent"]),["space","enter"]),onFocus:t(v),onBlur:b=>o.value=!1},[gt(q.$slots,"title",{},()=>[B(_(q.title),1)]),gt(q.$slots,"icon",{isActive:t(y)},()=>[l(t(pl),{class:ge(t(x))},{default:r(()=>[(a(),fe(dl(q.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),l(t(Gl),null,{default:r(()=>[ze(e("div",{id:t(ie),role:"region",class:ge(t(te)),"aria-hidden":!t(y),"aria-labelledby":t(H)},[e("div",{class:ge(t(ce))},[gt(q.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[dt,t(y)]])]),_:3})],2))}});var Xt=Tt(po,[["__file","collapse-item.vue"]]);const Yt=fl(ao,{CollapseItem:Xt}),el=ml(Xt),Ne=gl("im",{state:()=>({showReply:!1,index:0,accountsIdMap:[],lineState:[{currentAccId:0,userId:0,status:!1,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:0,gMessage:"",remark:""}]}),actions:{setReplyTrue(){this.showReply=!0},setReplyFalse(){this.showReply=!1},setReplyIndex(p){this.index=p},setAccounts(p){this.accountsIdMap=p},getAccountIdById(p){const h=this.accountsIdMap.find(i=>i.accountId!==void 0&&i.accountId===p);return h?h.id:null},addlineState(p){const h=this.lineState.findIndex(o=>o.userId===p.userId&&o.currentAccId===p.currentAccId),i=this.lineState.findIndex(o=>o.groupId===p.groupId&&o.currentAccId===p.currentAccId);p.userId!=0&&h!==-1||p.groupId!=0&&i!==-1||this.lineState.push({currentAccId:p.currentAccId,userId:p.userId,status:p.status,message:p.message,filePath:p.filePath,msgDate:p.msgDate,count:p.count,label:p.label,groupId:p.groupId,gMessage:p.gMessage,remark:p.remark})},sendLineMsg({currentAccId:p,userId:h,message:i,filePath:o,msgDate:m,groupId:y,gMessage:v}){let j=null;h!=0?j=this.lineState.find(E=>E.userId===h&&E.currentAccId===p):y!=0&&(j=this.lineState.find(E=>E.groupId===y&&E.currentAccId===p)),j&&(j.message=i,j.filePath=o,j.msgDate=m,j.groupId=y,j.gMessage=v)},updateLineStatus({currentAccId:p,userId:h,status:i}){const o=this.lineState.find(m=>m.userId===h&&m.currentAccId===p);o?o.status=i:this.lineState.push({currentAccId:p,userId:h,status:i,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:0,gMessage:"",remark:""})},updateLineMessage({currentAccId:p,userId:h,message:i,filePath:o,msgDate:m}){const y=this.lineState.find(v=>v.userId===h&&v.currentAccId===p);y?(y.message=i,y.filePath=o,y.msgDate=m):this.lineState.push({currentAccId:p,userId:h,status:!0,message:i,filePath:o,msgDate:m,count:0,label:"",groupId:0,gMessage:"",remark:""})},updateLineGroupMessage({currentAccId:p,groupId:h,gMessage:i,msgDate:o}){const m=this.lineState.find(y=>y.groupId===h&&y.currentAccId===p);m?(m.gMessage=i,m.msgDate=o):this.lineState.push({currentAccId:p,userId:0,status:!0,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:h,gMessage:i,remark:""})},updateLineMessageCount({currentAccId:p,userId:h,count:i}){const o=this.lineState.find(m=>m.userId===h&&m.currentAccId===p);o?o.count=i:this.lineState.push({currentAccId:p,userId:h,status:!0,message:"",filePath:"",msgDate:"",count:i,label:"",groupId:0,gMessage:"",remark:""})},updateLineMessageGroupCount({currentAccId:p,groupId:h,count:i}){const o=this.lineState.find(m=>m.groupId===h&&m.currentAccId===p);o?o.count=i:this.lineState.push({currentAccId:p,userId:0,status:!0,message:"",filePath:"",msgDate:"",count:i,label:"",groupId:h,gMessage:"",remark:""})},updateLineMessageLabel({currentAccId:p,userId:h,label:i}){const o=this.lineState.find(m=>m.userId===h&&m.currentAccId===p);o?o.label=i:this.lineState.push({currentAccId:p,userId:h,status:!0,message:"",filePath:"",msgDate:"",count:0,label:i,groupId:0,gMessage:"",remark:""})},updateRemark({currentAccId:p,userId:h,remark:i}){const o=this.lineState.find(m=>m.userId===h&&m.currentAccId===p);o&&(o.remark=i)},getRemarkById(p,h){const i=this.lineState.find(o=>o.userId===h&&o.currentAccId===p);return i?i.remark:""},getLineStatusById(p,h){const i=this.lineState.find(o=>o.userId===h&&o.currentAccId===p);return i?i.status:!1},getNewMsgById(p,h){const i=this.lineState.find(o=>o.userId===h&&o.currentAccId===p);return i?i.message:""},getNewMsgDateById(p,h){const i=this.lineState.find(y=>y.userId===h&&y.currentAccId===p);if(!i||!i.msgDate)return"";const o=new Date(i.msgDate);return`${String(o.getUTCMonth()+1).padStart(2,"0")}.${String(o.getUTCDate()).padStart(2,"0")} ${String(o.getUTCHours()).padStart(2,"0")}:${String(o.getUTCMinutes()).padStart(2,"0")}`},getNewMsgDateIntactById(p,h,i){let o=null;return h!=0&&h!=null&&h!=null?o=this.lineState.find(v=>v.userId===h&&v.currentAccId===p):i!=0&&i!=null&&i!=null&&(o=this.lineState.find(v=>v.groupId===i&&v.currentAccId===p)),!o||!o.msgDate?"":new Date(o.msgDate).toISOString()},getCountById(p,h){const i=this.lineState.find(o=>o.userId===h&&o.currentAccId===p);return i?Number(i.count):0},getLabelById(p,h){const i=this.lineState.find(o=>o.userId===h&&o.currentAccId===p);return i?i.label:""},getTotalUnreadCount(p){return this.lineState.filter(h=>h.currentAccId===p).reduce((h,i)=>h+i.count,0)},getTotalUnreadCountByUserId(p){return this.lineState.filter(h=>h.currentAccId===p&&h.userId!==0).reduce((h,i)=>h+i.count,0)},getTotalUnreadCountByGroupId(p){return this.lineState.filter(h=>h.currentAccId===p&&h.groupId!==0).reduce((h,i)=>h+i.count,0)},getLatestMsgDateByCurrentAccId(p){var m;const h=this.lineState.filter(y=>y.currentAccId===p);if(h.length===0)return null;const o=(m=h.filter(y=>y.msgDate).sort((y,v)=>new Date(v.msgDate).getTime()-new Date(y.msgDate).getTime())[0])==null?void 0:m.msgDate;return o||null},getLatestMessageByCurrentAccId(p){const h=this.lineState.filter(o=>o.currentAccId===p&&o.msgDate).map(o=>({...o,date:new Date(o.msgDate).getTime()})).sort((o,m)=>m.date-o.date);if(h.length===0)return null;const i=h[0];if(i){if(i.message)return i.message;if(i.gMessage)return i.gMessage}return null},getNewMsgByGroupId(p,h){const i=this.lineState.find(o=>o.groupId===h&&o.currentAccId===p);return i?i.gMessage:""},getNewMsgDateByGroupId(p,h){const i=this.lineState.find(y=>y.groupId===h&&y.currentAccId===p);if(!i||!i.msgDate)return"";const o=new Date(i.msgDate);return`${String(o.getUTCMonth()+1).padStart(2,"0")}.${String(o.getUTCDate()).padStart(2,"0")} ${String(o.getUTCHours()).padStart(2,"0")}:${String(o.getUTCMinutes()).padStart(2,"0")}`},getCountBygroupId(p,h){const i=this.lineState.find(o=>o.groupId===h&&o.currentAccId===p);return i?Number(i.count):0}},persist:!0}),fo={class:"col-span-2 mt-1 bg-white rounded-md p-4"},mo={class:"flex justify-between items-center mb-4 pb-4",style:{"border-bottom":"1px solid #ccc"}},go={class:"demo-collapse"},vo=["onClick"],ho={class:"absolute -top-3 left-6"},yo={class:"w-full h-full text-xl text-white flex justify-center items-center"},_o={class:"col-span-8 h-12 ml-2"},Io={class:"grid grid-cols-10 gap-4"},bo={class:"text-with-ellipsis col-span-6 font-bold text-sm"},xo={class:"font-thin text-xs flex"},wo={class:"grid grid-cols-10 gap-4"},Co={class:"col-span-6 font-thin text-xs flex"},ko={class:"text-with-ellipsis"},Ao={class:"col-span-4 font-thin text-xs -ml-2"},Mo=["onClick"],$o={class:"absolute -top-3 left-6"},jo={class:"w-full h-full text-xl text-white flex justify-center items-center"},So={class:"col-span-8 h-12 ml-2"},Do={class:"grid grid-cols-10 gap-4"},Lo={class:"text-with-ellipsis col-span-6 font-bold text-sm"},To={class:"font-thin text-xs flex"},No={class:"grid grid-cols-10 gap-4"},Vo={class:"col-span-6 font-thin text-xs flex"},Uo={class:"text-with-ellipsis"},Ro={class:"col-span-4 font-thin text-xs -ml-2"},Go=Be({__name:"account",props:{currentConId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},upAutoReply:{type:Boolean,required:!1}},emits:["accountId","loginError","accountList"],setup(p,{emit:h}){const i=p,o=h;je(()=>i.upAutoReply,()=>{L.value.forEach(C=>{C.id==E.value&&(C.automaticReply=i.upAutoReply)})});const m=n(!1),y=n(!1),v=Ne(),j=n(-1),E=n(0);function x(C,k){j.value=C,E.value=C,o("accountId",C,j.value,k)}const M=n(""),L=n([]),te=n([]);function ce(){m.value=!0;let C={GroupId:0,GetLastMsg:!0,Like:M.value};yl(C).then(k=>{try{y.value=!0;const se=k.data.data.data.map(P=>({accountId:P.account.accountId,id:P.account.id}));v.setAccounts(se);let J=k.data.data.data;for(let P=0;P<J.length;P++){let X=J[P];if(X.lastMsg){let re=0;X.account.accountId!=null&&(re=ve(J,X.account.accountId));const $={currentAccId:re,userId:X.lastMsg.toUserId,message:X.lastMsg.message,filePath:X.lastMsg.filePath?X.lastMsg.filePath:"",msgDate:X.lastMsg.date};v.updateLineMessage($)}}L.value=k.data.data.data.map(P=>({id:P.account.id,accountId:P.account.accountId,groupId:P.account.groupId,status:P.account.status,accountName:P.account.nickName,phone:P.account.phone,language:P.account.language,automaticReply:P.account.automaticReply,automaticReplyAll:P.account.automaticReplyAll,avatar:P.account.nickName===null?"A":P.account.nickName.charAt(0).toUpperCase(),msgNewDate:q(P.account.id),message:W(P.account.id),color:oe()})),L.value.sort((P,X)=>P.msgNewDate&&!X.msgNewDate?-1:!P.msgNewDate&&X.msgNewDate?1:P.msgNewDate&&X.msgNewDate?new Date(X.msgNewDate).getTime()-new Date(P.msgNewDate).getTime():0),o("accountList",L.value)}catch{}}).catch(k=>{y.value=!1}).finally(()=>{m.value=!1})}const ie=C=>{const k=JSON.parse(C);if(k.Type===Oe.OnLine){const{accountId:se,userId:J,status:P}=k.Message,X=ae(L.value,se);if(X===null)return;const re={currentAccId:X,userId:J,status:P==="Online"};v.updateLineStatus(re)}if(k.Type===Oe.OffLine){const{accountId:se,userId:J,status:P}=k.Message,X=ae(L.value,se);if(X===null)return;const re={currentAccId:X,userId:J,status:P!=="Offline"};v.updateLineStatus(re)}if(k.type===Oe.NewGroupMessage||k.type===Oe.NewClannelMessage){const{accountId:se,chatId:J,message:P,date:X}=k,re=ae(L.value,se);if(re===null)return;let $=Number(ue(re,J));re===E.value&&(j.value=re);const U={currentAccId:re,groupId:J,gMessage:P,msgDate:X};if(v.updateLineGroupMessage(U),i.currentGroId===J)return;{$++;const N={currentAccId:re,groupId:J,count:$};v.updateLineMessageGroupCount(N),Q(re)}let T=L.value.find(N=>N.id===re);T&&(T.msgNewDate=q(re)??"",T.message=W(re)||""),Z(re)}if(k.type===Oe.NewUserMessage){const{accountId:se,formUserId:J,message:P,date:X,filePath:re}=k,$=ae(L.value,se);if($===null)return;let U=Number(b($,J));$===E.value&&(j.value=$);const T={currentAccId:$,userId:J,message:P,filePath:re,msgDate:X};if(v.updateLineMessage(T),i.currentConId===J&&$===E.value){let I=L.value.find(g=>g.id===$);I&&(I.msgNewDate=q($)??"",I.message=W($)||"");return}else{U++;const I={currentAccId:$,userId:J,count:U};v.updateLineMessageCount(I),Q($)}let N=L.value.find(I=>I.id===$);N&&(N.msgNewDate=q($)??"",N.message=W($)||""),Z($)}if(k.Type===Oe.ErrorOnLine){const{type:se}=k.Message;o("loginError",se)}};function H(C){if(C==null||C==="")return"";const k=new Date(C);return`${String(k.getUTCMonth()+1).padStart(2,"0")}.${String(k.getUTCDate()).padStart(2,"0")} ${String(k.getUTCHours()).padStart(2,"0")}:${String(k.getUTCMinutes()).padStart(2,"0")}`??""}function q(C){return v.getLatestMsgDateByCurrentAccId(C)??""}function W(C){return v.getLatestMessageByCurrentAccId(C)}const b=(C,k)=>v.getCountById(C,k),ue=(C,k)=>v.getCountBygroupId(C,k);function Q(C){return Ne().getTotalUnreadCount(C)}function ae(C,k){const se=C.find(J=>J.accountId!=null?J.accountId===k:"");return se?se.id:null}function ve(C,k){const se=C.find(J=>J.account.accountId!=null?J.account.accountId===k:"");return se?se.account.id:0}function Z(C){const k=L.value.findIndex(se=>se.id===C);if(k!==-1){const[se]=L.value.splice(k,1);se&&L.value.unshift(se)}}et.on("updateNotice",ie),pt(()=>{et.off("updateNotice",ie)});const le=n("-1"),Ae=C=>{te.value=L.value.filter(k=>k.groupId===C)},ye=n([]);function he(){_l().then(C=>{try{ye.value=C.data.data.data.map(k=>({id:k.id,groupName:k.name}))}catch{}}).catch(C=>{C.data})}function oe(){let J,P,X;do J=Math.floor(Math.random()*360),P=Math.floor(Math.random()*51)+50,X=Math.floor(Math.random()*41)+30;while(P<50||X>70);return`hsl(${J}, ${P}%, ${X}%)`}return ot(()=>{he(),ce()}),(C,k)=>{const se=Ke,J=ut,P=vt,X=tt,re=Ut,$=el,U=Yt,T=ct;return a(),u("div",fo,[e("div",mo,[l(J,{modelValue:M.value,"onUpdate:modelValue":k[0]||(k[0]=N=>M.value=N),class:ge(["w-full","input-with-select"]),placeholder:C.$t("btn.inputSearch")},{append:r(()=>[l(se,{type:"primary",plain:"",onClick:ce},{default:r(()=>[l(t(S),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue","placeholder"])]),l(X,{class:"w-full overflow-hidden",style:{height:"80.5vh"}},{default:r(()=>[e("div",go,[ze((a(),fe(U,{accordion:"",modelValue:le.value,"onUpdate:modelValue":k[1]||(k[1]=N=>le.value=N),onChange:Ae},{default:r(()=>[l($,{name:"-1"},{title:r(()=>[B(_(C.$t("im.account.allAccount")),1)]),default:r(()=>[y.value?(a(),fe(X,{key:0,class:"w-full overflow-y-auto",style:{height:"62vh"}},{default:r(()=>[(a(!0),u(Ie,null,$e(L.value,(N,I)=>(a(),u("div",{key:I,class:ge(["rounded-md shadow-md mb-1 h-20 grid grid-cols-10 gap-4 flex justify-between items-center hover:scale-95 transition-all duration-30 cursor-pointer",{"h-16 bg-sky-400 text-white":j.value===N.id,"h-12":j.value!==N.id}]),style:{border:"1px solid #38bdf8"},onClick:g=>x(N.id,N)},[e("div",{class:"col-span-2 w-10 h-10 rounded-full ml-4 relative",style:Je({backgroundColor:N.color})},[e("div",ho,[Q(N.id)!=0?(a(),fe(P,{key:0,value:Q(N.id),class:"h-1 w-1",offset:[-20,5]},null,8,["value"])):me("",!0)]),e("div",yo,_(N.avatar),1)],4),e("div",_o,[e("div",Io,[e("div",bo,_(N.accountName),1),e("div",{class:ge(["text-with-ellipsis col-span-4 font-thin text-xs mr-2",N.status==1?"text-green-300":"text-red-500"])},_(t(At)(N.status)),3)]),e("div",xo,[l(t(S),{icon:"line-md:phone",style:{"font-size":"16px"}}),B(" : "+_(N.phone),1)]),e("div",wo,[e("div",Co,[e("span",null,[l(t(S),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),e("div",ko," : "+_(N.message),1)]),e("div",Ao,_(H(N.msgNewDate)),1)])])],10,vo))),128))]),_:1})):(a(),fe(re,{key:1,description:"暂无数据"}))]),_:1}),(a(!0),u(Ie,null,$e(ye.value,(N,I)=>(a(),fe($,{key:I,name:N.id},{title:r(()=>[B(_(C.$t("im.account.grouping"))+" : "+_(N.groupName),1)]),default:r(()=>[l(X,{class:"w-full overflow-hidden",style:{height:"50vh"}},{default:r(()=>[(a(!0),u(Ie,null,$e(te.value,(g,ne)=>(a(),u("div",{key:ne,class:ge(["rounded-md shadow-md mb-1 h-20 grid grid-cols-10 gap-4 flex justify-between items-center hover:scale-95 transition-all duration-30 cursor-pointer",{"h-16 bg-sky-400 text-white":j.value===g.id,"h-12":j.value!==g.id}]),style:{border:"1px solid #38bdf8"},onClick:Y=>x(g.id)},[e("div",{class:"col-span-2 w-10 h-10 rounded-full ml-4 relative",style:Je({backgroundColor:g.color})},[e("div",$o,[Q(g.id)!=0?(a(),fe(P,{key:0,value:Q(g.id),class:"h-1 w-1",offset:[-20,5]},null,8,["value"])):me("",!0)]),e("div",jo,_(g.avatar),1)],4),e("div",So,[e("div",Do,[e("div",Lo,_(g.accountName),1),e("div",{class:ge(["text-with-ellipsis col-span-4 font-thin text-xs mr-2",g.status==1?"text-green-300":"text-red-500"])},_(t(At)(g.status)),3)]),e("div",To,[l(t(S),{icon:"line-md:phone",style:{"font-size":"16px"}}),B(" : "+_(g.phone),1)]),e("div",No,[e("div",Vo,[e("span",null,[l(t(S),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),e("div",Uo," : "+_(g.message),1)]),e("div",Ro,_(H(g.msgNewDate)),1)])])],10,Mo))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])),[[T,m.value]])])]),_:1})])}}}),Eo=We(Go,[["__scopeId","data-v-724b3799"]]),Fo={class:"mb-2"},zo=["data","onClick","onContextmenu"],Po={key:1,class:"text-xl text-white"},Bo={key:3,class:"text-xl text-white"},Ho={class:"col-span-3 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},qo={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},Oo={key:1,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},Ko={class:"font-thin text-xs flex"},Jo={key:0},Wo={key:0,class:"flex"},Qo={key:1,class:"flex"},Zo={key:1,class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"},Xo={class:"col-span-2 h-12 w-20 -ml-2"},Yo={class:"font-thin text-xs"},es={class:"font-thin text-xs"},ts={class:"col-span-3 mr-2 flex relative"},ls={key:0,class:"absolute -top-5 w-20","aria-label":"Close",style:{right:"-1.2rem"}},os={class:"flex items-center text-amber-500"},ss={class:"text-xs"},ns={key:1},as={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},is={class:"flex"},rs={key:0},cs={key:1},us={class:"dialog-footer"},ds={key:0},ps={key:1},fs=Be({__name:"allContantList",props:{currentAccId:{},contantList:{},loading:{type:Boolean},isCurAcc:{type:Boolean},errMsg:{},loginError:{},currentComponent:{}},emits:["contactId","groupId","latestMsg","refreshContacts","allMsgCount","userMsgCount","groupMsgCount"],setup(p,{emit:h}){const i=p,o=h;je(()=>i.isCurAcc,()=>{i.isCurAcc==!0&&(ve(),Z(),le(),E(),v.value=void 0,y.value=-1)});const m=Ne(),y=n(-1),v=n();function j(I,g){y.value=I,v.value=g,o("contactId",v.value),v.value&&(v.value.groupId!=null?m.updateLineMessageGroupCount({currentAccId:i.currentAccId,groupId:v.value.groupId,count:0}):m.updateLineMessageCount({currentAccId:i.currentAccId,userId:v.value.userId,count:0}),ve(),Z(),le())}function E(){i.contantList.map(g=>({currentAccId:i.currentAccId,userId:g.tgAccountDialog.userId?g.tgAccountDialog.userId:0,groupId:g.tgAccountDialog.groupId?g.tgAccountDialog.groupId:0,gMessage:"",status:g.tgAccountDialog.isOnline?g.tgAccountDialog.isOnline:!1,message:g.lastMsg?g.lastMsg.message:"",filePath:g.lastMsg?g.lastMsg.filePath:"",msgDate:g.lastMsg?g.lastMsg.date:"",count:0,label:"",remark:""})).forEach(g=>{m.addlineState(g)})}const x=Ue(()=>m.accountsIdMap);function M(I,g){const ne=I.find(Y=>Y.accountId!=null?Y.accountId===g:"");return ne?ne.id:null}const L=I=>{const g=JSON.parse(I);if(g.type===Oe.NewGroupMessage||g.type===Oe.NewClannelMessage){const{accountId:ne,chatId:Y}=g,we=M(x.value,ne);ve(),le(),we===i.currentAccId&&o("latestMsg",0,Y)}if(g.type===Oe.NewUserMessage){const{accountId:ne,formUserId:Y}=g;M(x.value,ne)===i.currentAccId&&o("latestMsg",Y,0),ve(),Z()}},te=I=>m.getLineStatusById(i.currentAccId,I),ce=I=>m.getNewMsgById(i.currentAccId,I),ie=I=>m.getNewMsgByGroupId(i.currentAccId,I),H=(I,g)=>{let ne="";return g=="con"?ne=m.getNewMsgDateById(i.currentAccId,I):ne=m.getNewMsgDateByGroupId(i.currentAccId,I),ne.split(" ")[0]},q=(I,g)=>{let ne="";g=="con"?ne=m.getNewMsgDateById(i.currentAccId,I):ne=m.getNewMsgDateByGroupId(i.currentAccId,I);const Y=ne.split(" ")[1];if(Y!=null){const we=Y.split(":")[0];return Number(we)>=12?`${Y} p.m.`:`${Y} a.m.`}},W=(I,g)=>{let ne=0;return g=="con"?ne=m.getCountById(i.currentAccId,I):ne=m.getCountBygroupId(i.currentAccId,I),ne},b=I=>m.getLabelById(i.currentAccId,I),ue=n(0),Q=n(0),ae=n(0),ve=()=>{ue.value=m.getTotalUnreadCount(i.currentAccId),o("allMsgCount",ue.value)},Z=()=>{Q.value=m.getTotalUnreadCountByUserId(i.currentAccId),o("userMsgCount",Q.value)},le=()=>{ae.value=m.getTotalUnreadCountByGroupId(i.currentAccId),o("groupMsgCount",ae.value)};et.on("updateNotice",L),pt(()=>{et.off("updateNotice",L)});function Ae(I){if(I){const g=I.lastIndexOf(".");if(g!==-1){const ne=I.substring(g+1).toLowerCase();return["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(ne)?"image":"file"}}}const ye=n(""),he=n();function oe(I,g){I.preventDefault(),rt.showContextMenu({x:I.x,y:I.y,theme:"mac",items:[{label:"退出群组",svgIcon:"#mdi--location-exit",onClick:()=>{C.value=!0,he.value=g.tgAccountDialog.groupId,ye.value="group"}}]})}const C=n(!1),k=()=>{C.value=!1;const I={id:i.currentAccId,chatId:he.value,isDelete:!1};Et(I).then(g=>{o("refreshContacts")}).catch(g=>{})},se=n();function J(I,g){I.preventDefault(),rt.showContextMenu({x:I.x,y:I.y,theme:"mac",items:[{label:"删除联系人",svgIcon:"#mdi--location-exit",onClick:()=>{C.value=!0,se.value=g.tgAccountDialog.userId,ye.value="contact"}}]})}const P=()=>{C.value=!1;const I={id:i.currentAccId,userId:se.value};Ft(I).then(g=>{o("refreshContacts")}).catch(g=>{})},X=n([]),re=n([]),$=n(!1);function U(){return X.value.map(I=>JSON.parse(I))}function T(){$.value=!0,re.value=U().map(I=>({groupId:I.tgAccountDialog.groupId?I.tgAccountDialog.groupId:0,userId:I.tgAccountDialog.userId?I.tgAccountDialog.userId:0}))}function N(){X.value=[],re.value=[]}return ot(()=>{ve(),Z(),le()}),(I,g)=>{const ne=Ut,Y=Ke,we=Bt,Me=Fl,be=vt,He=ht,Te=tt,Ge=Xe,Re=ct;return a(),u(Ie,null,[ze((a(),fe(Te,{"element-loading-text":I.$t("im.allContant.accLoging"),class:"w-full overflow-hidden -mt-3",style:{height:"64vh"}},{default:r(()=>[I.contantList.length===0?(a(),fe(ne,{key:0,description:I.loginError?I.loginError:I.errMsg===""?I.$t("im.allContant.notContactAndGroup"):I.errMsg},null,8,["description"])):me("",!0),l(Nt,{name:"fade"},{default:r(()=>[ze(e("div",Fo,[l(Y,{class:"w-full",type:"primary",onClick:T},{default:r(()=>g[5]||(g[5]=[B(" 一键群发 ")])),_:1})],512),[[dt,X.value.length!==0]])]),_:1}),(a(!0),u(Ie,null,$e(I.contantList,(F,A)=>{var R,K;return a(),u("div",{key:A,class:"grid grid-cols-12 gap-4"},[e("div",{class:ge(["col-span-1 ml-1 mr-1 flex justify-between items-center",{"h-16":y.value===F.tgAccountDialog.id,"h-12":y.value!==F.tgAccountDialog.id}])},[l(Me,{modelValue:X.value,"onUpdate:modelValue":g[0]||(g[0]=w=>X.value=w)},{default:r(()=>[l(we,{value:JSON.stringify(F)},null,8,["value"])]),_:2},1032,["modelValue"])],2),e("div",{data:F.tgAccountDialog.id,class:ge(["col-span-11 grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-90 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":y.value===F.tgAccountDialog.id,"h-12":y.value!==F.tgAccountDialog.id}]),style:{"border-bottom":"1px solid #ccc"},onClick:w=>j(F.tgAccountDialog.id,F.tgAccountDialog),onContextmenu:w=>F.tgAccountDialog.groupId?oe(w,F):J(w,F)},[e("div",{class:"col-span-4 w-10 h-10 flex rounded-full ml-2 items-center justify-center",style:Je({backgroundColor:F.color})},[W(F.tgAccountDialog.userId,"con")!==0?(a(),fe(be,{key:0,value:Number(W(F.tgAccountDialog.userId,"con")),class:"item",offset:[-12,-12]},{default:r(()=>g[6]||(g[6]=[e("div",{class:"h-1 w-1"},null,-1)])),_:2},1032,["value"])):me("",!0),F.tgAccountDialog.avatar?(a(),u("span",Po,_(F.tgAccountDialog.avatar),1)):W(F.tgAccountDialog.groupId??0,"gro")!==0?(a(),fe(be,{key:2,type:"primary",value:Number(W(F.tgAccountDialog.groupId??0,"gro")),class:"item",offset:[-12,-12]},{default:r(()=>g[7]||(g[7]=[e("div",{class:"h-1 w-1"},null,-1)])),_:2},1032,["value"])):me("",!0),F.tgAccountDialog.avatarG?(a(),u("span",Bo,_(F.tgAccountDialog.avatarG),1)):me("",!0)],4),l(He,{class:"box-item",effect:"dark",content:(R=F.tgAccountDialog)!=null&&R.userName?(K=F.tgAccountDialog)==null?void 0:K.userName:F.tgAccountDialog.groupTitle?F.tgAccountDialog.groupTitle:"未识别命名",placement:"right"},{default:r(()=>{var w,f;return[e("div",Ho,[F.tgAccountDialog.userName?(a(),u("div",qo,_(F.tgAccountDialog.userName),1)):me("",!0),F.tgAccountDialog.groupTitle?(a(),u("div",Oo,_(F.tgAccountDialog.groupTitle),1)):me("",!0),e("div",Ko,[e("span",null,[l(t(S),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),((w=F.lastMsg)==null?void 0:w.filePath)!=null?(a(),u("div",Jo,[Ae(F.lastMsg.filePath)==="image"?(a(),u("div",Wo,[g[8]||(g[8]=B(" : ")),l(t(S),{icon:"lets-icons:img-box",class:"ml-2",style:{"font-size":"16px"}}),B(" "+_(F.lastMsg.message),1)])):Ae(F.lastMsg.filePath)==="file"?(a(),u("div",Qo,[g[9]||(g[9]=B(" : ")),l(t(S),{icon:"mi:document",class:"ml-2",style:{"font-size":"16px"}}),B(" "+_(F.lastMsg.message),1)])):me("",!0)])):(a(),u("div",Zo," : "+_(F.tgAccountDialog.groupId?ie((f=F.tgAccountDialog)==null?void 0:f.groupId):ce(F.tgAccountDialog.userId)),1))])])]}),_:2},1032,["content"]),e("div",Xo,[e("div",null,[e("span",Yo,_(F.tgAccountDialog.groupId?H(F.tgAccountDialog.groupId,"gro"):H(F.tgAccountDialog.userId,"con")),1)]),e("div",null,[e("span",es,_(F.tgAccountDialog.groupId?q(F.tgAccountDialog.groupId,"gro"):q(F.tgAccountDialog.userId,"con")),1)])]),e("div",ts,[(b(F.tgAccountDialog.userId)?b(F.tgAccountDialog.userId):F.tgAccountDialog.label)?(a(),u("div",ls,[e("div",os,[l(t(S),{icon:"fluent-emoji:label",style:{"font-size":"18px"}}),e("span",ss,_(b(F.tgAccountDialog.userId)?b(F.tgAccountDialog.userId):F.tgAccountDialog.label),1)])])):me("",!0),F.tgAccountDialog.groupId?me("",!0):(a(),u("div",ns,[e("div",{class:ge(["text-with-ellipsis font-thin text-xs absolute top-1",te(F.tgAccountDialog.userId)?"text-emerald-300":"text-red-500"]),style:{right:"0.4rem"}},_(te(F.tgAccountDialog.userId)?"在线":"离线"),3),l(t(S),{class:ge(["absolute top-1",te(F.tgAccountDialog.userId)?"text-emerald-300":"text-red-500"]),icon:"icon-park-outline:dot",style:{"font-size":"20px",right:"-0.7rem"}},null,8,["class"])]))])],42,zo)])}),128))]),_:1},8,["element-loading-text"])),[[Re,I.loading]]),(a(),u("svg",as,g[10]||(g[10]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1)]))),l(Ge,{modelValue:C.value,"onUpdate:modelValue":g[3]||(g[3]=F=>C.value=F),title:`${ye.value=="group"?"群组":"联系人"}`,width:"500"},{footer:r(()=>[e("div",us,[ye.value=="group"?(a(),u("div",ds,[l(Y,{onClick:g[1]||(g[1]=F=>C.value=!1)},{default:r(()=>g[11]||(g[11]=[B("Cancel")])),_:1}),l(Y,{type:"danger",onClick:k},{default:r(()=>g[12]||(g[12]=[B("退出")])),_:1})])):(a(),u("data",ps,[l(Y,{onClick:g[2]||(g[2]=F=>C.value=!1)},{default:r(()=>g[13]||(g[13]=[B("Cancel")])),_:1}),l(Y,{type:"danger",onClick:P},{default:r(()=>g[14]||(g[14]=[B("删除")])),_:1})]))])]),default:r(()=>[e("div",is,[l(t(S),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),ye.value=="group"?(a(),u("span",rs,"是否确认退出群组？退出群组聊天数据将会丢失！")):(a(),u("span",cs,"是否确认删除联系人？删除该联系人聊天数据将会丢失！"))])]),_:1},8,["modelValue","title"]),l(zl,{currentAccId:i.currentAccId,show:$.value,oneClickGList:re.value,"onUp:show":g[4]||(g[4]=F=>$.value=F),"onUp:success":N},null,8,["currentAccId","show","oneClickGList"])],64)}}}),It=We(fs,[["__scopeId","data-v-cde9a68a"]]),ms=["onClick","onContextmenu"],gs={class:"text-xl text-white"},vs={class:"col-span-4 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},hs={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},ys={class:"font-thin text-xs flex"},_s={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Is={class:"flex"},bs={class:"dialog-footer"},xs=Be({__name:"myContacts",props:{currentAccId:{}},emits:["myConId","refreshCon"],setup(p,{emit:h}){const i=p,o=h,m=n(!1),y=n(-1);function v(H,q){y.value=H,o("myConId",q)}const j=n(),E=n();function x(H,q){H.preventDefault(),rt.showContextMenu({x:H.x,y:H.y,theme:"mac",items:[{label:"删除联系人",svgIcon:"#mdi--location-exit",onClick:()=>{M.value=!0,E.value=q.tgAccountDialog.userId,j.value=q.tgAccountDialog.firstName}}]})}const M=n(!1),L=()=>{M.value=!1;const H={id:i.currentAccId,userId:E.value};Ft(H).then(q=>{o("refreshCon")}).catch(q=>{}),te()};function te(){M.value=!1,j.value=""}const ce=n([]);function ie(){m.value=!0;const H={id:i.currentAccId};wt(H).then(q=>{try{q.data.data,Array.isArray(q.data.data)&&(ce.value=q.data.data.map(W=>({...W,avatarC:W.firstName?W.firstName.charAt(0).toUpperCase():void 0,color:yt()})))}catch{}}).catch(q=>{}).finally(()=>{m.value=!1})}return ot(()=>{ie()}),(H,q)=>{const W=tt,b=Ke,ue=Xe,Q=ct;return a(),u(Ie,null,[ze((a(),fe(W,{class:"w-full overflow-hidden",style:{height:"70.7vh"}},{default:r(()=>[(a(!0),u(Ie,null,$e(ce.value,(ae,ve)=>(a(),u("div",{key:ve,class:ge(["grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-110 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":y.value===ae.id,"h-12":y.value!==ae.id}]),style:{"border-bottom":"1px solid #ccc"},onClick:Z=>v(ae.id,ae),onContextmenu:Z=>x(Z,ae)},[e("div",{class:"col-span-3 w-10 h-10 flex rounded-full ml-4 items-center justify-center",style:Je({backgroundColor:ae.color})},[e("span",gs,_(ae.avatarC),1)],4),e("div",vs,[ae.firstName?(a(),u("div",hs,_(ae.firstName),1)):me("",!0),e("div",ys,[e("span",null,[l(t(S),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),q[1]||(q[1]=e("div",{class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"}," : 文字内容 ",-1))])]),q[2]||(q[2]=e("div",{class:"mr-2"},null,-1))],42,ms))),128))]),_:1})),[[Q,m.value]]),(a(),u("svg",_s,q[3]||(q[3]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1)]))),l(ue,{modelValue:M.value,"onUpdate:modelValue":q[0]||(q[0]=ae=>M.value=ae),title:`是否删除联系人：${j.value}`,width:"500"},{footer:r(()=>[e("div",bs,[l(b,{onClick:te},{default:r(()=>q[5]||(q[5]=[B("Cancel")])),_:1}),l(b,{type:"danger",onClick:L},{default:r(()=>q[6]||(q[6]=[B("删除")])),_:1})])]),default:r(()=>[e("div",Is,[l(t(S),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),q[4]||(q[4]=e("span",null,_("删除该联系人，聊天数据将会丢失！"),-1))])]),_:1},8,["modelValue","title"])],64)}}}),ws=We(xs,[["__scopeId","data-v-9bc87f18"]]),Cs=["onClick","onContextmenu"],ks={class:"text-xl text-white"},As={class:"col-span-4 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},Ms={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},$s={class:"font-thin text-xs flex"},js={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Ss={class:"flex"},Ds={class:"dialog-footer"},Ls=Be({__name:"myGroups",props:{currentAccId:{}},emits:["myGroupId","refreshGroup"],setup(p,{emit:h}){const i=p,o=h,m=Ne(),y=n(!1),v=n(-1);function j(W,b){v.value=W,o("myGroupId",b.id)}const E=n(),x=n(!1),M=n();function L(W,b){W.preventDefault(),rt.showContextMenu({x:W.x,y:W.y,theme:"mac",items:[{label:"退出群组",svgIcon:"#mdi--location-exit",onClick:()=>{te.value=!0,M.value=b.id,E.value=b.title,x.value=!1}},{label:"解散群组",svgIcon:"#fluent-mdl2--leave-user",onClick:()=>{m.getAccountIdById(b.adminId),te.value=!0,M.value=b.id,E.value=b.title,i.currentAccId==m.getAccountIdById(b.adminId)&&(x.value=!0)}}]})}const te=n(!1),ce=()=>{te.value=!1;const W={id:i.currentAccId,chatId:M.value,isDelete:x.value};Et(W).then(b=>{b.data,o("refreshGroup")}).catch(b=>{}),ie()};function ie(){te.value=!1,x.value=!1,E.value="",M.value=""}const H=n([]);function q(){y.value=!0;const W={id:i.currentAccId};Il(W).then(b=>{try{b.data.data,Array.isArray(b.data.data)&&(H.value=b.data.data.map(ue=>({...ue,avatarG:ue.title?ue.title.charAt(0).toUpperCase():void 0,color:yt()})))}catch{}}).catch(b=>{}).finally(()=>{y.value=!1})}return ot(()=>{q()}),(W,b)=>{const ue=tt,Q=Ke,ae=Xe,ve=ct;return a(),u(Ie,null,[ze((a(),fe(ue,{class:"w-full overflow-hidden",style:{height:"70.7vh"}},{default:r(()=>[(a(!0),u(Ie,null,$e(H.value,(Z,le)=>(a(),u("div",{key:le,class:ge(["grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-110 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":v.value===le,"h-12":v.value!==le}]),style:{"border-bottom":"1px solid #ccc"},onClick:Ae=>j(le,Z),onContextmenu:Ae=>L(Ae,Z)},[e("div",{class:"col-span-3 w-10 h-10 flex rounded-full ml-4 items-center justify-center",style:Je({backgroundColor:Z.color})},[e("span",ks,_(Z.avatarG),1)],4),e("div",As,[Z.title?(a(),u("div",Ms,_(Z.title),1)):me("",!0),e("div",$s,[e("span",null,[l(t(S),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),b[1]||(b[1]=e("div",{class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"}," : 文字内容 ",-1))])]),b[2]||(b[2]=e("div",{class:"mr-2"},null,-1))],42,Cs))),128))]),_:1})),[[ve,y.value]]),(a(),u("svg",js,b[3]||(b[3]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1),e("symbol",{id:"fluent-mdl2--leave-user",viewBox:"0 0 2048 2048"},[e("path",{fill:"#ff0a0a",d:"M2048 1536v128h-646l211 211l-90 90l-365-365l365-365l90 90l-211 211zm-756-433l-88 93q-89-84-201-128t-235-44q-88 0-170 23t-153 64t-129 100t-100 130t-65 153t-23 170H0q0-117 35-229t101-207t157-169t203-113q-56-36-100-83t-76-103t-47-118t-17-130q0-106 40-199t109-163T568 40T768 0t199 40t163 109t110 163t40 200q0 137-63 248t-177 186q70 26 133 66t119 91M384 512q0 80 30 149t82 122t122 83t150 30q79 0 149-30t122-82t83-122t30-150q0-79-30-149t-82-122t-123-83t-149-30q-80 0-149 30t-122 82t-83 123t-30 149"})],-1)]))),l(ae,{modelValue:te.value,"onUpdate:modelValue":b[0]||(b[0]=Z=>te.value=Z),title:`是否${x.value?"解散":"退出"}群组：${E.value}`,width:"500"},{footer:r(()=>[e("div",Ds,[l(Q,{onClick:ie},{default:r(()=>b[4]||(b[4]=[B("Cancel")])),_:1}),l(Q,{type:"danger",onClick:ce},{default:r(()=>[B(_(x.value?"解散":"退出"),1)]),_:1})])]),default:r(()=>[e("div",Ss,[l(t(S),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),e("span",null,_(`${x.value?"解散":"退出"} 群组聊天数据将会丢失！`),1)])]),_:1},8,["modelValue","title"])],64)}}}),Ts=We(Ls,[["__scopeId","data-v-78c9e3a5"]]),Ns={key:0},Vs={key:1},Us={key:2},Rs={key:0,class:"mt-4"},Gs={class:"mb-2"},Es={class:"flex justify-center items-center"},Fs={class:"w-full"},zs={class:"mb-2"},Ps={class:"w-full"},Bs={class:"w-full"},Hs={class:"w-full mr-2"},qs={class:"flex justify-center items-center mt-4"},Os={key:1,class:"mt-4"},Ks={class:"flex justify-center items-center mt-4"},Js={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},Ws=["onClick"],Qs={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},Zs=["onClick"],Xs={key:0},Ys={key:1,class:"h-full w-full mt-1",style:{height:"21%"}},en={class:"h-1/4 w-full text-gray-400 flex items-center"},tn={for:"file-input"},ln={class:"flex mr-2 hover:text-sky-500 cursor-pointer"},on={key:0,class:"mt-4",style:{border:"1px solid #ccc"}},sn=["src"],nn=["onClick"],an={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},rn={class:"message-input-container"},cn=["placeholder"],un={class:"h-3/4 w-full flex justify-between items-center",style:{border:"1px solid #ccc"}},dn={class:"message-input-container"},pn=["placeholder"],fn=Be({__name:"addContant",props:["show","currentAccId"],emits:["update:show","anewGet"],setup(p,{emit:h}){const i=p,o=h,m=n("phone");je(()=>m.value,()=>{m.value=="group"&&(ie(),q())});const y=n(""),v=n(),j=()=>{v.value&&(v.value.style.height="auto",v.value.style.height=`${v.value.scrollHeight}px`)},E=n({phone:""});function x(){o("update:show",!1);let w=null;if(E.value.phone&&(w=String(E.value.phone).trimStart().replace(/^\+/,"")),!w||w.trim()===""){console.warn("无效的电话号码");return}const f=new FormData;Z.value.length>0&&Z.value.forEach(O=>{O instanceof File&&f.append("files.FormFiles",O)}),J.value&&J.value.forEach(O=>{f.append("files.UrlFiles",O)}),P.value&&P.value.forEach(O=>{f.append("files.UrlFileTypes",O)}),f.append("Phone",w),f.append("Id",i.currentAccId),y.value&&f.append("Text",y.value),bl(f).then(O=>{o("anewGet"),E.value.phone="",y.value=""}).catch(O=>{E.value.phone="",y.value=""}),he(),te()}const M=n({username:""});function L(){if(o("update:show",!1),U.value){Fe.error(Ye.global.t("im.addContant.emptyFile"));return}let w=null;if(M.value.username&&(w="@"+M.value.username.substring(M.value.username.lastIndexOf("/")+1)),!w||w.trim()===""){console.warn("无效的电话号码");return}const f=new FormData;Z.value.length>0&&Z.value.forEach(O=>{O instanceof File&&f.append("files.FormFiles",O)}),J.value&&J.value.forEach(O=>{f.append("files.UrlFiles",O)}),P.value&&P.value.forEach(O=>{f.append("files.UrlFileTypes",O)}),f.append("UserName",w),f.append("Id",i.currentAccId),y.value&&f.append("Text",y.value),xl(f).then(O=>{o("anewGet"),M.value.username="",y.value=""}).catch(O=>{M.value.username="",y.value=""}),te(),he()}const te=()=>{C.value=null,Z.value=[],J.value=[],P.value=[],y.value="",M.value.username="",E.value.phone=""},ce=n([]);function ie(){const w={id:i.currentAccId};wt(w).then(f=>{try{ce.value=f.data.data}catch{}}).catch(f=>{})}const H=n([]);function q(){Ot({GroupId:0}).then(f=>{try{f.data.data,H.value=f.data.data.data}catch{}}).catch(f=>{})}const W=n(),b=n([]),ue=w=>{b.value=w},Q=w=>{b.value.some(O=>O===w)?W.value.toggleRowSelection(w,!1):W.value.toggleRowSelection(w,!0)},ae=n([]),ve=n(!1),Z=n([]),le=n(),Ae=n(""),ye=w=>{const f=w.target.files;if(f.length>0)for(let O=0;O<f.length;O++){const _e=f[O];Z.value.push(_e),Ae.value="isImg";const c=new FileReader;c.onloadend=()=>{typeof c.result=="string"&&ae.value.push(c.result),O===f.length-1&&(ve.value=!0)},c.readAsDataURL(_e)}};function he(){ve.value=!1,Z.value=[],ae.value=[],y.value="",le.value.value="",Ae.value="",M.value.username="",E.value.phone=""}const oe=w=>{ae.value.splice(w,1),Z.value.splice(w,1)},C=n(),k=n(!1);function se(){k.value=!0}const J=n([]),P=n([]),X=n([]);function re(w,f,O,_e){k.value=w,f.length>0&&(X.value=[...X.value,...f],Z.value=[...Z.value,...f]),O.length>0&&_e.length>0&&(Array.isArray(J.value)||(J.value=[]),Array.isArray(P.value)||(P.value=[]),J.value=[...J.value,...O],P.value=[...P.value,..._e])}function $(w){J.value&&P.value&&(J.value.splice(w,1),P.value.splice(w,1))}const U=Ue(()=>C.value&&C.value.size===0),T=n({title:"",phone:""}),N=n("conSend"),I=n(),g=n(0),ne=n([]),Y=n([]),we=n(!0),Me=n(!0);let be=[],He=[];const Te=n([]),Ge=w=>{Te.value=w},Re=w=>{Te.value.some(O=>O===w)?I.value.toggleRowSelection(w,!1):I.value.toggleRowSelection(w,!0)};je([()=>T.value,()=>b.value,()=>Te.value,()=>Y.value],()=>{T.value.title!=""&&(T.value.phone!=""||b.value.length>0||Te.value.length>0)?we.value=!1:we.value=!0,Y.value.length>0?Me.value=!1:Me.value=!0},{deep:!0});function F(){g.value++,T.value.phone.split(/\r?\n/).forEach(f=>{const O=f.trim();if(O!==""){let _e={phone:O,filterPhone:O,firstName:"",userId:"",userHash:""};ne.value.push(_e)}}),b.value.map(f=>{let O={phone:String(f.phone),filterPhone:String(f.phone),firstName:"",userId:"",userHash:""};ne.value.push(O)}),Te.value.forEach(f=>{let O={phone:"",filterPhone:f.phone,firstName:f.firstName,userId:f.userId,userHash:f.accessHash};ne.value.push(O)}),ne.value=Array.from(new Map(ne.value.map(f=>[f.filterPhone,f])).values())}function A(){g.value--,Y.value=[],ne.value=[],T.value.phone="",b.value=[],Te.value=[]}function R(){const w=T.value.phone.split(/\r?\n/),f=[];w.forEach(c=>{const s=c.trim();s!==""&&f.push(s)}),b.value.map(c=>{f.push(String(c.phone))});const O=Te.value.map(c=>({userId:c.userId,userHash:c.accessHash}));Y.value.forEach(c=>{let s=JSON.parse(c);s.phone==""?be.push({userId:s.userId,userHash:s.userHash}):He.push(s.phone)});const _e={id:i.currentAccId,title:T.value.title,phones:f,values:O,adminUsers:be,adminPhones:He};wl(_e).then(c=>{c.data,Fe.success("新增群组成功"),o("anewGet")}).catch(c=>{}),K()}function K(){o("update:show",!1),T.value.title="",T.value.phone="",Te.value=[],I.value.clearSelection(),m.value="phone",g.value=0}return(w,f)=>{const O=Ke,_e=xt,c=ut,s=Ct,G=kt,xe=Bl,Ce=Hl,De=Ht,Pe=qt,z=ft,D=mt,pe=ht,d=tt,Se=Xe;return a(),fe(Se,{modelValue:i.show,"onUpdate:modelValue":f[16]||(f[16]=V=>i.show=V),title:w.$t("im.addContant.addContact"),width:"700"},{footer:r(()=>[m.value==="group"?(a(),u("div",Xs)):(a(),u("div",Ys,[e("div",en,[e("div",null,[e("label",tn,[e("div",ln,[l(t(S),{icon:"lets-icons:img-box",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(w.$t("im.addContant.image")),1)])]),e("input",{ref_key:"imgInputRef",ref:le,id:"file-input",type:"file",accept:"image/*",multiple:"",onChange:ye,style:{display:"none"}},null,544),l(Se,{modelValue:ve.value,"onUpdate:modelValue":f[13]||(f[13]=V=>ve.value=V),title:"Send an Image",width:"500"},{default:r(()=>[ae.value.length>0?(a(),u("div",on,[(a(!0),u(Ie,null,$e(ae.value,(V,Le)=>(a(),u("div",{key:Le,class:"mb-2 relative"},[e("img",{src:V,alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,sn),e("button",{onClick:ke=>oe(Le),class:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded"},"X",8,nn)]))),128))])):me("",!0),e("div",an,[e("div",rn,[l(d,{class:"scrollbar",height:100},{default:r(()=>[ze(e("textarea",{"onUpdate:modelValue":f[11]||(f[11]=V=>y.value=V),onInput:j,onKeydown:f[12]||(f[12]=it(Ze(V=>m.value==="phone"?x:L,["prevent"]),["enter"])),placeholder:w.$t("im.addContant.inputSearch"),ref_key:"messageInput",ref:v,class:"message-input"},null,40,cn),[[at,y.value]])]),_:1})]),m.value==="phone"?(a(),u("div",{key:0,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:x},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])):(a(),u("div",{key:1,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:L},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})]))])]),_:1},8,["modelValue"])]),e("div",null,[e("div",{class:"flex hover:text-sky-500 cursor-pointer",onClick:se},[l(t(S),{icon:"mi:document",style:{"font-size":"22px"}}),e("span",null,_(w.$t("im.addContant.file")),1)]),l(Pl,{show:k.value,isLocal:!0,onDeliver:re},null,8,["show"])])]),e("div",un,[e("div",dn,[l(d,{class:"scrollbar",height:100},{default:r(()=>[ze(e("textarea",{"onUpdate:modelValue":f[14]||(f[14]=V=>y.value=V),onInput:j,onKeydown:f[15]||(f[15]=it(Ze(V=>m.value==="phone"?x:L,["prevent"]),["enter"])),placeholder:w.$t("btn.inputSearch"),ref_key:"messageInput",ref:v,class:"message-input"},null,40,pn),[[at,y.value]])]),_:1})]),m.value==="phone"?(a(),u("div",{key:0,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:x},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])):(a(),u("div",{key:1,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:L},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})]))])]))]),default:r(()=>[l(_e,{class:"w-full mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:r(()=>[l(O,{class:ge(["w-1/3",{active:m.value==="phone"}]),type:"primary",plain:"",onClick:f[0]||(f[0]=V=>m.value="phone")},{default:r(()=>[l(t(S),{icon:"line-md:phone-add-filled",style:{"font-size":"22px"}}),B(" "+_(w.$t("im.addContant.sendMsgToPhone")),1)]),_:1},8,["class"]),l(O,{class:ge(["w-1/3",{active:m.value==="users"}]),type:"primary",plain:"",onClick:f[1]||(f[1]=V=>m.value="users")},{default:r(()=>[l(t(S),{icon:"mdi:user-add",style:{"font-size":"22px"}}),B(" "+_(w.$t("im.addContant.sendMsgToUser")),1)]),_:1},8,["class"]),l(O,{class:ge(["w-1/3",{active:m.value==="group"}]),type:"primary",plain:"",onClick:f[2]||(f[2]=V=>m.value="group")},{default:r(()=>[l(t(S),{icon:"material-symbols:group",style:{"font-size":"22px"}}),f[17]||(f[17]=B(" 新增群组 "))]),_:1},8,["class"])]),_:1}),m.value==="phone"?(a(),u("div",Ns,[l(G,{ref:"phoneFormRef",style:{"max-width":"600px"},model:E.value,"status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:r(()=>[l(s,{label:"phone",prop:"phone"},{default:r(()=>[l(c,{modelValue:E.value.phone,"onUpdate:modelValue":f[3]||(f[3]=V=>E.value.phone=V),modelModifiers:{number:!0},type:"number",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):m.value==="users"?(a(),u("div",Vs,[l(G,{ref:"userFormRef",style:{"max-width":"600px"},model:M.value,"status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:r(()=>[l(s,{label:"username",prop:"username"},{default:r(()=>[l(c,{modelValue:M.value.username,"onUpdate:modelValue":f[4]||(f[4]=V=>M.value.username=V),type:"text",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):m.value==="group"?(a(),u("div",Us,[l(Ce,{class:"flex items-center justify-center",style:{"max-width":"400px"},active:g.value,"finish-status":"success"},{default:r(()=>[l(xe,{title:"添加联系人"}),l(xe,{title:"设置群管理"})]),_:1},8,["active"]),g.value===0?(a(),u("div",Rs,[e("div",Gs,[f[18]||(f[18]=e("div",{class:"font-bold mb-2"},"群名称",-1)),l(c,{modelValue:T.value.title,"onUpdate:modelValue":f[5]||(f[5]=V=>T.value.title=V),type:"text",autocomplete:"off"},null,8,["modelValue"])]),e("div",Es,[l(_e,{class:"w-3/5 mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:r(()=>[l(O,{class:ge(["w-1/3",{active:N.value==="conSend"}]),type:"primary",plain:"",onClick:f[6]||(f[6]=V=>N.value="conSend")},{default:r(()=>f[19]||(f[19]=[B(" 手动输入 ")])),_:1},8,["class"]),l(O,{class:ge(["w-1/3",{active:N.value==="conList"}]),type:"primary",plain:"",onClick:f[7]||(f[7]=V=>N.value="conList")},{default:r(()=>f[20]||(f[20]=[B(" 联系人素材 ")])),_:1},8,["class"]),l(O,{class:ge(["w-1/3",{active:N.value==="conMaterial"}]),type:"primary",plain:"",onClick:f[8]||(f[8]=V=>N.value="conMaterial")},{default:r(()=>f[21]||(f[21]=[B(" 联系人列表 ")])),_:1},8,["class"])]),_:1})]),ze(e("div",Fs,[e("div",zs,[f[22]||(f[22]=e("div",{class:"font-bold mb-2"},"邀请联系人",-1)),l(c,{modelValue:T.value.phone,"onUpdate:modelValue":f[9]||(f[9]=V=>T.value.phone=V),rows:7,type:"textarea",placeholder:"注：每行一个联系人信息",autocomplete:"off"},null,8,["modelValue"])])],512),[[dt,N.value==="conSend"]]),ze(e("div",Ps,[e("div",null,[f[24]||(f[24]=e("div",{class:"font-bold mb-2"},"联系人素材",-1)),l(Pe,{ref_key:"conMaterialRef",ref:W,"show-header":!1,data:H.value,style:{width:"100%",height:"353px",border:"1px solid #ddd"},onSelectionChange:ue,onRowClick:Q},{default:r(()=>[l(De,{type:"selection",width:"55"}),l(De,null,{default:r(V=>[B(" 昵称："+_(V.row.userName)+" ",1),f[23]||(f[23]=e("br",null,null,-1)),B(" 号码："+_(V.row.phone),1)]),_:1})]),_:1},8,["data"])])],512),[[dt,N.value==="conList"]]),ze(e("div",Bs,[e("div",Hs,[f[26]||(f[26]=e("div",{class:"font-bold mb-2"},"联系人列表",-1)),l(Pe,{ref_key:"conListRef",ref:I,"show-header":!1,data:ce.value,style:{width:"100%",height:"353px",border:"1px solid #ddd"},onSelectionChange:Ge,onRowClick:Re},{default:r(()=>[l(De,{type:"selection",width:"55"}),l(De,null,{default:r(V=>[B(" 昵称："+_(V.row.userName?V.row.userName:V.row.firstName??""+V.row.lastName??"")+" ",1),f[25]||(f[25]=e("br",null,null,-1)),B(" 号码："+_(V.row.phone),1)]),_:1})]),_:1},8,["data"])])],512),[[dt,N.value==="conMaterial"]]),e("div",qs,[l(O,{type:"primary",disabled:we.value,onClick:F},{default:r(()=>f[27]||(f[27]=[B("下一步")])),_:1},8,["disabled"])])])):me("",!0),g.value===1?(a(),u("div",Os,[e("div",null,[f[28]||(f[28]=e("div",{class:"font-bold mb-2"},"选择设置的管理员",-1)),e("div",null,[l(D,{modelValue:Y.value,"onUpdate:modelValue":f[10]||(f[10]=V=>Y.value=V),multiple:"",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择设置的管理员",style:{width:"100%"}},{default:r(()=>[(a(!0),u(Ie,null,$e(ne.value,(V,Le)=>(a(),fe(z,{key:Le,label:V.phone==null||V.phone==""?V.firstName:V.phone,value:JSON.stringify(V)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),e("div",Ks,[l(O,{type:"primary",onClick:A},{default:r(()=>f[29]||(f[29]=[B("上一步")])),_:1}),l(O,{type:"primary",disabled:Me.value,onClick:R},{default:r(()=>f[30]||(f[30]=[B("完成")])),_:1},8,["disabled"]),l(O,{onClick:K},{default:r(()=>f[31]||(f[31]=[B("取消")])),_:1})])])):me("",!0)])):me("",!0),(a(!0),u(Ie,null,$e(J.value,(V,Le)=>(a(),u("div",{key:Le,class:"flex items-center justify-between w-4/5 text-cyan-500",style:{border:"1px dashed #ccc"}},[l(t(S),{icon:"bxs:file",style:{"font-size":"22px"}}),l(pe,{class:"box-item",effect:"dark",content:V,placement:"bottom"},{default:r(()=>[e("span",Js,_(V),1)]),_:2},1032,["content"]),e("span",{type:"danger",plain:"",onClick:ke=>$(Le)},[l(t(S),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,Ws)]))),128)),(a(!0),u(Ie,null,$e(X.value,(V,Le)=>(a(),u("div",{key:Le,class:"flex items-center justify-between w-4/5 text-cyan-500",style:{border:"1px dashed #ccc"}},[l(t(S),{icon:"bxs:file",style:{"font-size":"22px"}}),e("span",Qs,_(V.name),1),e("span",{type:"danger",plain:"",onClick:ke=>$(Le)},[l(t(S),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,Zs)]))),128))]),_:1},8,["modelValue","title"])}}}),mn=We(fn,[["__scopeId","data-v-7805ead3"]]),gn={class:"col-span-2 mt-1 bg-white rounded-md p-4"},vn={class:"flex justify-between items-center pb-2"},hn={class:"w-1/5"},yn={class:"mb-4 pb-2 h14 w-full",style:{"border-bottom":"1px solid #ccc"}},_n={key:0},In={key:0},bn={key:1},xn={key:2},wn={key:1},Cn={key:2},kn={key:0,class:"flex justify-between items-center mt-4 pt-4 w-full",style:{"border-top":"1px solid #ccc"}},An=Be({__name:"index",props:{currentAccId:{type:Number,required:!0},loginError:{type:String,required:!0}},emits:["contactId","groupId","currCom","currSelectTab"],setup(p,{expose:h,emit:i}){const o=p,m=i;h({getAllContantList:ue});const y=Ne(),v=n("AllContantList"),j=n("dialog"),E=n(!1),x=n(!1);je(()=>v.value,()=>{m("currCom",v.value)}),je(()=>j.value,()=>{m("currSelectTab",j.value)}),je(()=>o.currentAccId,()=>{x.value=!1,o.currentAccId!=-1&&ue()});function M($){$.dialogType==1?(m("contactId",$.userId,$.userName),m("groupId",-1,void 0)):$.dialogType==2&&(m("groupId",$.groupId,$.groupTitle),m("contactId",-1,void 0))}function L(){ue()}function te($){m("groupId",$),m("contactId",-1,void 0)}function ce($){m("groupId",-1),m("contactId",$.userId,$.userName)}const ie=n(!1),H=n([]),q=n([]),W=n([]),b=n("");function ue(){j.value="dialog",zt(),setTimeout(()=>{ie.value=!0;const $={id:o.currentAccId};Pt($).then(U=>{try{U.data.code==201&&(b.value=U.data.message),W.value=[],q.value=[],Array.isArray(U.data.data)?(H.value=U.data.data,H.value.forEach(T=>{T&&T.tgAccountDialog&&(T.tgAccountDialog.userName&&(T.tgAccountDialog.avatar=T.tgAccountDialog.userName.charAt(0).toUpperCase()),T.tgAccountDialog.groupTitle&&(T.tgAccountDialog.avatarG=T.tgAccountDialog.groupTitle.charAt(0).toUpperCase()),T.conMsgDate=Q(o.currentAccId,T.tgAccountDialog.userId,T.tgAccountDialog.groupId),T.color=ye(),T.tgAccountDialog.dialogType===1?W.value.push(T):q.value.push(T))}),H.value.sort((T,N)=>{const I=Me=>Me&&Me.date?new Date(Me.date).getTime():0,g=I(T.lastMsg),ne=I(N.lastMsg),Y=I({date:T.conMsgDate}),we=I({date:N.conMsgDate});return Y>0&&we===0?-1:Y===0&&we>0?1:Y>0&&we>0?we-Y:ne-g})):H.value=[],x.value=!0}catch{}}).catch(U=>{var T;try{H.value=[],(T=U.response.data)!=null&&T.errorCode&&(b.value=U.response.data.errorMessage)}catch{}}).finally(()=>{ie.value=!1})},200)}function Q($,U,T){return y.getNewMsgDateIntactById($,U,T)}function ae($,U){let T=0;if($!=0?T=H.value.findIndex(N=>N.tgAccountDialog.userId===$):U!=0&&(T=H.value.findIndex(N=>N.tgAccountDialog.groupId===U)),T!==-1){const[N]=H.value.splice(T,1);N&&H.value.unshift(N)}}const ve=n([]),Z=n([]),le=n("");function Ae(){le.value?(H.value.forEach($=>{var U,T,N,I;$.tgAccountDialog&&((U=$.tgAccountDialog)!=null&&U.groupTitle&&(T=$.tgAccountDialog)!=null&&T.groupTitle.includes(le.value)&&ve.value.push($),(N=$.tgAccountDialog)!=null&&N.userName&&(I=$.tgAccountDialog)!=null&&I.userName.includes(le.value)&&ve.value.push($))}),Z.value=H.value,H.value=ve.value):(ve.value=[],Z.value.length<=0?ue():H.value=Z.value)}function ye(){let N,I,g;do N=Math.floor(Math.random()*360),I=Math.floor(Math.random()*51)+50,g=Math.floor(Math.random()*41)+30;while(I<50||g>70);return`hsl(${N}, ${I}%, ${g}%)`}const he=n(!1);function oe(){o.currentAccId!==-1&&(he.value=!0)}function C(){j.value="dialog",H.value.length<=0&&ue()}const k=n(0),se=n(0),J=n(0);function P($){k.value=$}function X($){se.value=$}function re($){J.value=$}return($,U)=>{const T=Ke,N=xt,I=vt;return a(),u(Ie,null,[e("div",gn,[e("div",vn,[e("div",{class:ge(["flex w-4/5 mr-2 border-gray-300 rounded-lg transition-all duration-300 cursor-pointer",{"border-color":E.value}]),style:{border:"1px solid #ccc"},onClick:U[3]||(U[3]=g=>E.value=!0)},[ze(e("input",{type:"text",class:"w-4/5 py-1 pl-4 pr-10 bg-transparent focus:outline-none focus:ring-0 focus:shadow-none",placeholder:"Search...","onUpdate:modelValue":U[0]||(U[0]=g=>le.value=g),onBlur:U[1]||(U[1]=g=>E.value=!1)},null,544),[[at,le.value]]),l(T,{plain:"",size:"default",class:"w-1/5 pl-2 flex items-center bg-transparent",onClick:Ae,onBlur:U[2]||(U[2]=g=>E.value=!1)},{default:r(()=>[l(t(S),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})],2),e("div",hn,[l(T,{type:"primary",plain:"",size:"default",disabled:p.currentAccId===-1,onClick:oe},{default:r(()=>[l(t(S),{icon:"mingcute:add-fill",style:{"font-size":"22px"}})]),_:1},8,["disabled"])])]),e("div",yn,[l(N,{class:"w-full"},{default:r(()=>[l(T,{class:ge(["w-1/2",{active:j.value==="dialog"}]),type:"primary",plain:"",onClick:C},{default:r(()=>[l(t(S),{icon:"ant-design:message-filled",style:{"font-size":"22px"}}),B(" "+_($.$t("im.contact.dialogue")),1)]),_:1},8,["class"]),v.value==="GroupList"?(a(),fe(T,{key:0,class:ge(["w-1/2",{active:j.value==="groups"}]),type:"primary",plain:"",onClick:U[4]||(U[4]=g=>j.value="groups")},{default:r(()=>[l(t(S),{icon:"dashicons:groups",style:{"font-size":"22px"}}),U[11]||(U[11]=B(" 我管理的群组 "))]),_:1},8,["class"])):(a(),fe(T,{key:1,class:ge(["w-1/2",{active:j.value==="contacts"}]),type:"primary",plain:"",onClick:U[5]||(U[5]=g=>j.value="contacts")},{default:r(()=>[l(t(S),{icon:"mdi:contact",style:{"font-size":"22px"}}),B(" "+_($.$t("im.contact.contacts")),1)]),_:1},8,["class"]))]),_:1})]),e("div",null,[j.value==="dialog"?(a(),u("div",_n,[v.value==="AllContantList"?(a(),u("div",In,[l(It,{currentAccId:o.currentAccId,contantList:H.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:o.loginError,currentComponent:v.value,onContactId:M,onAllMsgCount:P,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae,onRefreshContacts:ue},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])])):v.value==="GroupList"?(a(),u("div",bn,[l(It,{currentAccId:o.currentAccId,contantList:q.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:o.loginError,currentComponent:v.value,onContactId:M,onAllMsgCount:P,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae,onRefreshContacts:ue},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])])):(a(),u("div",xn,[l(It,{currentAccId:o.currentAccId,contantList:W.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:o.loginError,currentComponent:v.value,onContactId:M,onAllMsgCount:P,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])]))])):j.value==="contacts"?(a(),u("div",wn,[l(ws,{currentAccId:o.currentAccId,onMyConId:ce,onRefreshCon:L},null,8,["currentAccId"])])):j.value==="groups"?(a(),u("div",Cn,[l(Ts,{currentAccId:o.currentAccId,onMyGroupId:te,onRefreshGroup:L},null,8,["currentAccId"])])):me("",!0)]),j.value==="dialog"?(a(),u("div",kn,[l(T,{class:ge(["w-2/6",{"is-active":v.value==="AllContantList"}]),type:"primary",plain:"",onClick:U[6]||(U[6]=g=>v.value="AllContantList")},{default:r(()=>[k.value!=0?(a(),fe(I,{key:0,value:k.value,class:"item",offset:[35,-9]},{default:r(()=>U[12]||(U[12]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):me("",!0),e("div",null,_($.$t("im.contact.all")),1)]),_:1},8,["class"]),l(T,{class:ge(["w-2/6",{"is-active":v.value==="ContantList"}]),type:"primary",plain:"",onClick:U[7]||(U[7]=g=>v.value="ContantList")},{default:r(()=>[se.value!=0?(a(),fe(I,{key:0,value:se.value,class:"item",offset:[75,-9]},{default:r(()=>U[13]||(U[13]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):me("",!0),e("div",null,_($.$t("im.contact.contactList")),1)]),_:1},8,["class"]),l(T,{class:ge(["w-2/6",{"is-active":v.value==="GroupList"}]),type:"primary",plain:"",onClick:U[8]||(U[8]=g=>v.value="GroupList")},{default:r(()=>[J.value!=0?(a(),fe(I,{key:0,value:J.value,class:"item",offset:[60,-9]},{default:r(()=>U[14]||(U[14]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):me("",!0),e("div",null,_($.$t("im.contact.gropupList")),1)]),_:1},8,["class"])])):me("",!0)]),l(mn,{show:he.value,currentAccId:o.currentAccId,onClose:U[9]||(U[9]=g=>he.value=!1),"onUpdate:show":U[10]||(U[10]=g=>he.value=!1),onAnewGet:L},null,8,["show","currentAccId"])],64)}}}),Mn=We(An,[["__scopeId","data-v-6708f64c"]]),$n=[{type:"😀",desc:"笑脸",emoji:[{emoji:"😀",title:"嘿嘿"},{emoji:"😃",title:"哈哈"},{emoji:"😄",title:"大笑"},{emoji:"😁",title:"嘻嘻"},{emoji:"😆",title:"斜眼笑"},{emoji:"😅",title:"苦笑"},{emoji:"🤣",title:"笑的满地打滚"},{emoji:"😂",title:"笑哭了"},{emoji:"🙂",title:"呵呵"},{emoji:"🙃",title:"倒脸"},{emoji:"😉",title:"眨眼"},{emoji:"😊",title:"羞涩微笑"},{emoji:"😇",title:"微笑天使"},{emoji:"🥰",title:"喜笑颜开"},{emoji:"😍",title:"花痴"},{emoji:"🤩",title:"崇拜"},{emoji:"😘",title:"飞吻"},{emoji:"😋",title:"好吃"},{emoji:"😛",title:"吐舌"},{emoji:"😜",title:"单眼吐舌"},{emoji:"🤪",title:"滑稽"},{emoji:"😝",title:"滑稽眯眼吐舌"},{emoji:"🤗",title:"抱抱"},{emoji:"🤭",title:"不说"},{emoji:"🤔",title:"想一想"},{emoji:"🤐",title:"闭嘴"},{emoji:"🤨",title:"挑眉"},{emoji:"😐",title:"冷漠"},{emoji:"😑",title:"无语"},{emoji:"😶",title:"沉默"},{emoji:"😏",title:"得意"},{emoji:"😒",title:"不高兴"},{emoji:"🙄",title:"翻白眼"},{emoji:"😬",title:"龇牙咧嘴"},{emoji:"🤥",title:"说谎"},{emoji:"😔",title:"沉默"},{emoji:"😪",title:"困"},{emoji:"🤤",title:"流口水"},{emoji:"😴",title:"睡着了"},{emoji:"😷",title:"感冒"},{emoji:"🤒",title:"发烧"},{emoji:"🤕",title:"受伤"},{emoji:"🤢",title:"恶心"},{emoji:"🤮",title:"呕吐"},{emoji:"🤧",title:"打喷嚏"},{emoji:"🥵",title:"脸发烫"},{emoji:"😵",title:"晕头转向"},{emoji:"🤯",title:"爆炸头"},{emoji:"🤠",title:"牛仔帽"},{emoji:"🥳",title:"聚会笑脸"},{emoji:"😎",title:"墨镜笑脸"},{emoji:"🧐",title:"单片眼睛脸"},{emoji:"😕",title:"困扰"},{emoji:"😟",title:"担心"},{emoji:"🙁",title:"微微不满"},{emoji:"☹",title:"不满"},{emoji:"😮",title:"吃惊"},{emoji:"😲",title:"震惊"},{emoji:"😳",title:"脸红"},{emoji:"🥺",title:"恳求的脸"},{emoji:"😨",title:"害怕"},{emoji:"😰",title:"冷汗"},{emoji:"😥",title:"失望"},{emoji:"😭",title:"哭泣"},{emoji:"😱",title:"吓死了"},{emoji:"😓",title:"汗"},{emoji:"🥱",title:"打哈欠"},{emoji:"😤",title:"傲慢"},{emoji:"😡",title:"怒火中烧"},{emoji:"🤬",title:"嘴上符号"},{emoji:"💩",title:"大便"},{emoji:"🤡",title:"小丑"},{emoji:"👻",title:"鬼"},{emoji:"👽",title:"外星人"}]},{type:"👍",desc:"手势",emoji:[{emoji:"👍",title:"赞同"},{emoji:"👎",title:"反对"},{emoji:"👏",title:"鼓掌"},{emoji:"🙏",title:"祈祷"},{emoji:"👋",title:"挥手"},{emoji:"👍",title:"赞同"},{emoji:"👎",title:"反对"},{emoji:"👏",title:"鼓掌"},{emoji:"🙏",title:"祈祷"},{emoji:"👋",title:"挥手"},{emoji:"👌",title:"ok"},{emoji:"🤏",title:"拿捏"},{emoji:"✌",title:"胜利"},{emoji:"🤞",title:"交叉"},{emoji:"🤙",title:"给我打电话"},{emoji:"👊",title:"出拳"}]},{type:"👨‍👩‍👧‍👦",desc:"家庭",emoji:[{emoji:"👨‍👩‍👧‍👦",title:"家庭"},{emoji:"👨‍👩‍👧",title:"家庭"},{emoji:"👨‍👩‍👦",title:"家庭"},{emoji:"👨‍👩‍👧‍👧",title:"家庭"},{emoji:"👨‍👩‍👦‍👦",title:"家庭"}]},{type:"🍺",desc:"饮料",emoji:[{emoji:"🥤",title:"果汁"},{emoji:"🥢",title:"沙拉"},{emoji:"🍹",title:"鸡尾酒"},{emoji:"🍺",title:"啤酒"},{emoji:"🍻",title:"干杯"}]},{type:"🍎",desc:"食物",emoji:[{emoji:"🍎",title:"苹果"},{emoji:"🍊",title:"橘子"},{emoji:"🍇",title:"葡萄"},{emoji:"🍉",title:"西瓜"},{emoji:"🍓",title:"草莓"},{emoji:"🍒",title:"樱桃"},{emoji:"🍑",title:"桃子"},{emoji:"🍍",title:"菠萝"},{emoji:"🥭",title:"香蕉"},{emoji:"🍏",title:"苹果"},{emoji:"🍆",title:"茄子"},{emoji:"🥦",title:"胡萝卜"},{emoji:"🥬",title:"生菜"},{emoji:"🥕",title:"胡萝卜"},{emoji:"🌽",title:"玉米"},{emoji:"🍄",title:"蘑菇"},{emoji:"🥐",title:"羊角面包"},{emoji:"🥖",title:"法式面包"},{emoji:"🥞",title:"煎饼"},{emoji:"🍳",title:"烤炉"},{emoji:"🍔",title:"汉堡包"},{emoji:"🍟",title:"薯条"},{emoji:"🍕",title:"披萨"},{emoji:"🍝",title:"意大利面"},{emoji:"🍜",title:"面条"},{emoji:"🍲",title:"餐盘"},{emoji:"🍱",title:"便当"},{emoji:"🍣",title:"寿司"},{emoji:"🍤",title:"天妇罗"},{emoji:"🍥",title:"鱼板"},{emoji:"🍦",title:"冰淇淋"},{emoji:"🍨",title:"雪糕"},{emoji:"🍧",title:"冰激凌"}]},{type:"🎁",desc:"装饰",emoji:[{emoji:"🎉",title:"庆祝"},{emoji:"🎊",title:"庆祝"},{emoji:"🎈",title:"气球"},{emoji:"🎁",title:"礼物"},{emoji:"🎄",title:"圣诞树"},{emoji:"🎆",title:"烟花"},{emoji:"🎇",title:"烟花"},{emoji:"🎌",title:"旗帜"},{emoji:"🎓",title:"毕业帽"},{emoji:"🎖",title:"勋章"},{emoji:"🏆",title:"奖杯"},{emoji:"🎲",title:"骰子"},{emoji:"🎯",title:"靶心"},{emoji:"🎰",title:"老虎机"},{emoji:"🎳",title:"保龄球"},{emoji:"🎱",title:"台球"},{emoji:"🎾",title:"网球"}]},{type:"🌛",desc:"地点",emoji:[{emoji:"🌍",title:"地球"},{emoji:"🌎",title:"地球"},{emoji:"🌏",title:"地球"},{emoji:"🌐",title:"地球"},{emoji:"🌛",title:"月亮"},{emoji:"🌙",title:"月亮"},{emoji:"🌟",title:"星星"},{emoji:"🌠",title:"星星"},{emoji:"🌌",title:"银河"},{emoji:"🌅",title:"日出"},{emoji:"🌆",title:"日落"},{emoji:"🌇",title:"黄昏"},{emoji:"🌉",title:"桥梁"},{emoji:"🌊",title:"波浪"},{emoji:"🌴",title:"棕榈树"},{emoji:"🌵",title:"仙人掌"},{emoji:"🌲",title:"树"}]},{type:"🐶",desc:"动物",emoji:[{emoji:"🐶",title:"狗"},{emoji:"🐱",title:"猫"},{emoji:"🐭",title:"老鼠"},{emoji:"🐹",title:"仓鼠"},{emoji:"🐰",title:"兔子"},{emoji:"🦊",title:"狐狸"},{emoji:"🐻",title:"熊"},{emoji:"🐼",title:"熊猫"},{emoji:"🐨",title:"考拉"},{emoji:"🐯",title:"老虎"},{emoji:"🦁",title:"狮子"},{emoji:"🐮",title:"牛"},{emoji:"🐷",title:"猪"},{emoji:"🐸",title:"青蛙"},{emoji:"🐵",title:"猴子"},{emoji:"🐔",title:"鸡"},{emoji:"🐧",title:"企鹅"},{emoji:"🐦",title:"鸟"},{emoji:"🐣",title:"小鸡"},{emoji:"🐥",title:"小鸡"},{emoji:"🐸",title:"青蛙"}]},{type:"🎨",desc:"艺术",emoji:[{emoji:"🎨",title:"调色板"},{emoji:"🎩",title:"帽子"},{emoji:"🎓",title:"毕业帽"},{emoji:"🎭",title:"戏剧"},{emoji:"🎬",title:"电影"},{emoji:"🎤",title:"麦克风"},{emoji:"🎧",title:"耳机"},{emoji:"🎼",title:"小提琴"},{emoji:"🎹",title:"钢琴"},{emoji:"🎵",title:"音乐"},{emoji:"🎶",title:"音乐"},{emoji:"🎧",title:"耳机"},{emoji:"🎤",title:"麦克风"},{emoji:"🎭",title:"戏剧"},{emoji:"🎬",title:"电影"}]},{type:"🔠",desc:"符号",emoji:[{emoji:"📶",title:"信号"},{emoji:"🚮",title:"倒垃圾"},{emoji:"🚰",title:"饮用水"},{emoji:"♿",title:"轮椅"},{emoji:"🚹",title:"男厕"},{emoji:"🚺",title:"女厕"},{emoji:"🚺",title:"女厕"},{emoji:"⚠",title:"危险"},{emoji:"🚫",title:"禁止"},{emoji:"⛔",title:"禁止通行"},{emoji:"🔞",title:"18禁止"},{emoji:"♀",title:"女性"},{emoji:"♂",title:"男性"},{emoji:"♂",title:"男性"}]}],jn={class:"h-full w-full mt-1",style:{border:"1px solid #ccc",height:"21%"}},Sn={class:"h-1/4 w-full text-gray-400 flex items-center",style:{"border-bottom":"1px solid #ccc"}},Dn={for:"file-input"},Ln={key:1,class:"flex mr-2 hover:text-sky-500 cursor-pointer"},Tn=["disabled"],Nn={key:0,class:"mt-4",style:{border:"1px solid #ccc"}},Vn=["src"],Un=["onClick"],Rn={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},Gn={class:"message-input-container"},En=["onKeydown","placeholder"],Fn={key:0},zn={key:1},Pn={class:"mt-4"},Bn={class:"h-6 w-72 overflow-hidden whitespace-nowrap truncate"},Hn={class:"flex mt-4",style:{width:"100%"}},qn={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},On={class:"message-input-container"},Kn=["onKeydown"],Jn={key:1,class:"flex hover:text-sky-500 cursor-pointer"},Wn={class:"flex items-center space-x-4 overflow-x-auto h-10 rounded-lg scrollbar-flex-content",style:{"border-bottom":"1px solid red"}},Qn=["onClick"],Zn={class:"grid grid-cols-12 gap-2 mt-2 ml-2"},Xn=["onClick"],Yn={class:"hover:bg-sky-500 rounded-lg shadow-md p-2"},ea={class:"h-3/4 w-full flex justify-between items-center"},ta={class:"message-input-container"},la=["placeholder","disabled"],oa=Be({__name:"sendMsg",props:{currentAccId:{type:Number,required:!0},currentConId:{type:Number,required:!0},replyId:{type:Number,required:!0},editId:{type:Number,required:!0},editContent:{type:String,required:!0},sendType:{type:String,required:!0},currentGroId:{type:Number,required:!0}},emits:["sendRecordMsg","fakeM","fakeM2","update:msg","vacant","resetScroll"],setup(p,{expose:h,emit:i}){h({sendQueickMsg:M});const o=p,m=i;je(()=>o.editContent,()=>{x.value=o.editContent});const y=n(),v=()=>{y.value&&(y.value.style.height="auto",y.value.style.height=`${y.value.scrollHeight}px`,E())},j=n(),E=()=>{nt(()=>{var D;const z=(D=j.value)==null?void 0:D.$el.querySelector(".el-scrollbar__wrap");z&&(z.scrollTop=z.scrollHeight-z.clientHeight,j.value.setScrollTop(z.scrollTop))})},x=n("");function M(z){x.value=z,L()}function L(){ue.value=!1,ye.value=!1,Ne().setReplyFalse();let z="";ve.value?z=ve.value:C.value&&(z=C.value);const D={currentAccId:o.currentAccId,userId:o.currentConId!==-1?o.currentConId:0,message:x.value+" ",filePath:z!=""?z=="isImg"?".jpg":".txt":"",msgDate:$t(new Date().toString()),groupId:o.currentGroId!==-1?o.currentGroId:0,gMessage:o.currentGroId!==-1?x.value+" ":""};Ne().sendLineMsg(D);const pe={currentAccId:o.currentAccId,groupId:o.currentGroId!==-1?o.currentGroId:0,gMessage:o.currentGroId!==-1?x.value+" ":"",msgDate:$t(new Date().toString())};if(Ne().updateLineGroupMessage(pe),te.value){Fe.error(i18n.global.t("im.addContant.emptyFile"));return}const d=new FormData;Q.value.forEach((V,Le)=>{V instanceof File?d.append("files.FormFiles",V):console.error(`Invalid file object at index ${Le}:`,V)}),Y.value.forEach(V=>{d.append("files.UrlFiles",V)}),we.value.forEach(V=>{d.append("files.UrlFileTypes",V)}),o.currentGroId!=-1?d.append("ChatId",String(o.currentGroId)):d.append("UserId",String(o.currentConId)),d.append("Id",String(o.currentAccId)),x.value&&d.append("Text",x.value),o.sendType=="reply"&&d.append("ReplyMsgId",String(o.replyId)),o.sendType=="edit"&&d.append("EditMsgId",String(o.editId));const Se={massage:x.value,date:new Date().toISOString(),filePath:ve.value==="isImg"?b.value:null,file:C.value==="isFile"?he.value:null};Y.value.length>0&&(Se.filePath=Y.value),m("fakeM",Se),m("resetScroll"),o.currentGroId!=-1?Cl(d).then(V=>{try{m("update:msg",Se.date,V.data.data.id,1)}catch{}}).catch(V=>{Fe.error("消息发送失败")}):kl(d).then(V=>{try{m("update:msg",Se.date,V.data.data.id,1)}catch{}}).catch(V=>{V.errorCode&&(m("fakeM2"),vl.error(V.errorCode)),Fe.error("消息发送失败")}),le(),re(),R(),m("vacant")}const te=Ue(()=>he.value&&he.value.size===0),ce=Ue(()=>o.currentConId==null||o.currentConId==null||o.currentConId==-1),ie=Ue(()=>o.currentGroId==null||o.currentGroId==null||o.currentGroId==-1),H=Ue(()=>ce.value&&ie.value);function q(){H.value||x.value!=""&&L()}const W=z=>{z.key==="Enter"&&(z.shiftKey?(z.preventDefault(),x.value+=`
`):!H.value&&x.value.trim()!==""&&L())},b=n([]),ue=n(!1),Q=n([]),ae=n(),ve=n(""),Z=z=>{const D=z.target.files;if(D.length>0)for(let pe=0;pe<D.length;pe++){const d=D[pe];Q.value.push(d),ve.value="isImg";const Se=new FileReader;Se.onloadend=()=>{typeof Se.result=="string"&&b.value.push(Se.result),pe===D.length-1&&(ue.value=!0)},Se.readAsDataURL(d)}};function le(){ue.value=!1,Q.value=[],b.value=[],x.value="",ae.value.value="",ve.value=""}const Ae=z=>{b.value.splice(z,1),Q.value.splice(z,1)},ye=n(!1),he=n(),oe=n(),C=n(""),k=n("storage");function se(){ye.value=!0}function J(z,D){Q.value=[],he.value=[];for(const pe of D)if(pe.raw){const d=pe.raw;Q.value.push(d),he.value.push(d)}C.value="isFile"}function P(z,D){oe.value.clearFiles(),Q.value=[],he.value=null,C.value=""}const X=z=>{},re=()=>{ye.value=!1,he.value=null,Q.value=[],x.value="",C.value="",U.value="",g.value=""};je(()=>ye.value,()=>{ye.value===!0&&(R(),N(),ne())});const $=n([]),U=n("");function T(z){return z.substring(z.lastIndexOf("/")+1)}function N(){ql().then(z=>{try{$.value=z.data.data.data.map(D=>({value:D.fileName,label:T(D.fileName)}))}catch{}}).catch(z=>{})}const I=n([]),g=n("");function ne(){Kt({GroupId:0}).then(D=>{try{I.value=D.data.data.data.map(pe=>({value:pe.filePath,label:pe.name}))}catch{}}).catch(D=>{}).finally(()=>{})}const Y=n([]),we=n([]),Me=n(Y.value.map(()=>"file"));je(()=>Y.value,()=>{Me.value=Y.value.map((z,D)=>D<Me.value.length?Me.value[D]:"file")},{deep:!0});const be=n(""),He=n([{value:"file",label:"文件"},{value:"image",label:"图片"}]);function Te(z){let D="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/"+z;Y.value.push(D),we.value.push("file")}function Ge(z){let D="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/"+z;Y.value.push(D),we.value.push("file")}function Re(z,D){we.value.forEach((pe,d)=>{d===D&&we.value.splice(d,1,z)})}function F(z){we.value.splice(z,1),Y.value.splice(z,1)}function A(){if(be.value.startsWith("http://")||be.value.startsWith("https://")){Y.value.push(be.value),we.value.push(be.value),be.value="";return}Fe.warning("请输入正确的URL地址"),be.value=""}function R(){Y.value=[],we.value=[],be.value="",U.value="",g.value="",Me.value=[]}function K(){ye.value=!1}function w(){L()}const f=n(!0);function O(){f.value=!f.value}function _e(){f.value=!0}function c(z){z.target.closest("#emoji-input")||z.target.closest('label[for="emoji-label"]')||_e()}const s=n($n),G=n(0),xe=n(!1),Ce=Ue(()=>{const z=s.value[G.value];return z||{emoji:[]}});function De(z){G.value=z}function Pe(z){x.value=x.value?`${x.value} ${z}`:z,_e(),y.value.focus()}return ot(()=>{o.editContent!==""&&(x.value=o.editContent),document.addEventListener("click",c)}),pt(()=>{document.removeEventListener("click",c)}),(z,D)=>{const pe=ht,d=tt,Se=Xe,V=Ke,Le=xt,ke=Jt,Qe=ft,st=mt,_t=Wt,ee=ut;return a(),u("div",jn,[e("div",Sn,[e("div",null,[e("label",Dn,[t(H)?(a(),fe(pe,{key:0,content:"请选择群组或联系人",placement:"top"},{default:r(()=>[e("div",{class:ge(["flex mr-2",{"cursor-not-allowed opacity-50":t(H)}])},[l(t(S),{icon:"line-md:image-filled",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(z.$t("im.addContant.image")),1)],2)]),_:1})):(a(),u("div",Ln,[l(t(S),{icon:"line-md:image-filled",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(z.$t("im.addContant.image")),1)]))]),e("input",{ref_key:"imgInputRef",ref:ae,id:"file-input",type:"file",accept:"image/*",multiple:"",onChange:Z,style:{display:"none"},disabled:t(H)},null,40,Tn),l(Se,{modelValue:t(ue),"onUpdate:modelValue":D[1]||(D[1]=de=>Ve(ue)?ue.value=de:null),title:"Send an Image",width:"500"},{default:r(()=>[t(b).length>0?(a(),u("div",Nn,[(a(!0),u(Ie,null,$e(t(b),(de,Ee)=>(a(),u("div",{key:Ee,class:"mb-2 relative"},[e("img",{src:de,alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,Vn),e("button",{onClick:qe=>Ae(Ee),class:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded"},"X",8,Un)]))),128))])):me("",!0),e("div",Rn,[e("div",Gn,[l(d,{class:"scrollbar",height:100},{default:r(()=>[ze(e("textarea",{ref_key:"messageInput",ref:y,"onUpdate:modelValue":D[0]||(D[0]=de=>Ve(x)?x.value=de:null),onInput:v,onKeydown:it(Ze(L,["prevent"]),["enter"]),placeholder:z.$t("btn.inputSearch"),class:"message-input"},null,40,En),[[at,t(x)]])]),_:1})]),e("div",{class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:L},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])])]),_:1},8,["modelValue"])]),e("div",null,[t(H)?(a(),fe(pe,{key:0,content:"请选择群组或联系人",placement:"top"},{default:r(()=>[e("div",{class:ge(["flex",{"cursor-not-allowed opacity-50":t(H)}])},[l(t(S),{icon:"mingcute:file-fill",style:{"font-size":"22px"}}),e("span",null,_(z.$t("im.addContant.file")),1)],2)]),_:1})):(a(),u("div",{key:1,class:"flex hover:text-sky-500 cursor-pointer",onClick:se},[l(t(S),{icon:"mingcute:file-fill",style:{"font-size":"22px"}}),e("span",null,_(z.$t("im.addContant.file")),1)])),l(Se,{modelValue:t(ye),"onUpdate:modelValue":D[8]||(D[8]=de=>Ve(ye)?ye.value=de:null),title:"发送文件",width:"600",onClose:K},{default:r(()=>[l(Le,{class:"w-full mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:r(()=>[l(V,{class:ge(["w-1/2",{active:t(k)==="local"}]),type:"primary",plain:"",onClick:D[2]||(D[2]=de=>k.value="local")},{default:r(()=>[l(t(S),{icon:"mdi:local-area-network",style:{"font-size":"22px"}}),D[13]||(D[13]=B(" 从本地发送图片 "))]),_:1},8,["class"]),l(V,{class:ge(["w-1/2",{active:t(k)==="storage"}]),type:"primary",plain:"",onClick:D[3]||(D[3]=de=>k.value="storage")},{default:r(()=>[l(t(S),{icon:"material-symbols:storage-rounded",style:{"font-size":"22px"}}),D[14]||(D[14]=B(" 从存储资源发送图片 "))]),_:1},8,["class"])]),_:1}),t(k)==="local"?(a(),u("div",Fn,[l(ke,{ref_key:"uploadRef",ref:oe,class:"upload-demo w-full","file-list":t(Q),"auto-upload":!1,"on-preview":X,"on-remove":P,"on-change":J,multiple:!0,limit:10,drag:""},{default:r(()=>[l(t(S),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),D[15]||(D[15]=e("div",{class:"el-upload__text"},[B(" 请"),e("em",null,"点击或拖拽"),B("上传文件 ")],-1))]),_:1},8,["file-list"])])):me("",!0),t(k)==="storage"?(a(),u("div",zn,[l(st,{modelValue:t(U),"onUpdate:modelValue":D[4]||(D[4]=de=>Ve(U)?U.value=de:null),clearable:"",placeholder:"从聊天记录文件中选择",style:{width:"50%"},filterable:"",onChange:Te},{default:r(()=>[(a(!0),u(Ie,null,$e(t($),de=>(a(),fe(Qe,{key:de.value,label:de.label,value:de.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(st,{"element-loading-text":"正在获取资料库...",modelValue:t(g),"onUpdate:modelValue":D[5]||(D[5]=de=>Ve(g)?g.value=de:null),clearable:"",placeholder:"从素材库中选择",style:{width:"50%"},filterable:"",onChange:Ge},{default:r(()=>[(a(!0),u(Ie,null,$e(t(I),de=>(a(),fe(Qe,{key:de.value,label:de.label,value:de.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e("div",Pn,[(a(!0),u(Ie,null,$e(t(Y),(de,Ee)=>(a(),u("div",{key:Ee,class:"flex items-center justify-between mt-0.5 p-0.5",style:{border:"1px dashed #ccc"}},[l(_t,{type:"primary",size:"large"},{default:r(()=>D[16]||(D[16]=[B("文件")])),_:1}),l(pe,{class:"box-item",effect:"dark",content:de,placement:"bottom"},{default:r(()=>[e("span",Bn,_(de),1)]),_:2},1032,["content"]),e("div",null,[l(st,{modelValue:t(Me)[Ee],"onUpdate:modelValue":qe=>t(Me)[Ee]=qe,clearable:"",placeholder:"选择类型",style:{width:"100px"},filterable:""},{default:r(()=>[(a(!0),u(Ie,null,$e(t(He),qe=>(a(),fe(Qe,{key:qe.value,label:qe.label,value:qe.value,onClick:ic=>Re(qe.value,Ee)},null,8,["label","value","onClick"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(V,{type:"danger",class:"ml-2",onClick:qe=>F(Ee)},{default:r(()=>[l(t(S),{icon:"ic:baseline-delete",style:{"font-size":"22px"}})]),_:2},1032,["onClick"])])]))),128))]),e("div",Hn,[l(ee,{modelValue:t(be),"onUpdate:modelValue":D[6]||(D[6]=de=>Ve(be)?be.value=de:null),placeholder:"手动添加一条图片URL (需要以http/https开头)",clearable:"",style:{width:"88%"}},null,8,["modelValue"]),l(V,{type:"primary",class:"ml-2",onClick:A},{default:r(()=>[l(t(S),{icon:"mingcute:add-fill",style:{"font-size":"22px"}})]),_:1})])])):me("",!0),e("div",qn,[e("div",On,[l(d,{class:"scrollbar",height:100},{default:r(()=>[ze(e("textarea",{"onUpdate:modelValue":D[7]||(D[7]=de=>Ve(x)?x.value=de:null),onInput:v,onKeydown:it(Ze(w,["prevent"]),["enter"]),placeholder:"请输入发送信息",ref_key:"messageInput",ref:y,class:"message-input"},null,40,Kn),[[at,t(x)]])]),_:1})]),e("div",{class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:w},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])])]),_:1},8,["modelValue"])]),e("div",{class:"ml-2 relative",onClick:c},[e("label",{for:"emoji-label",onClick:Ze(O,["stop"])},[t(H)?(a(),fe(pe,{key:0,content:"请选择群组或联系人",placement:"top"},{default:r(()=>[e("div",{class:ge(["flex",{"cursor-not-allowed opacity-50":t(H)}])},[l(t(S),{icon:"mingcute:emoji-fill",style:{"font-size":"22px"}}),D[17]||(D[17]=e("span",null,"表情",-1))],2)]),_:1})):(a(),u("div",Jn,[l(t(S),{icon:"mingcute:emoji-fill",style:{"font-size":"22px"}}),D[18]||(D[18]=e("span",null,"表情",-1))]))]),!t(H)&&!t(f)?(a(),u("div",{key:0,id:"emoji-input",class:"absolute bottom-10 -left-32 h-64 bg-white border border-gray-300 rounded-lg shadow-lg z-10",style:{width:"580px"},onClick:D[11]||(D[11]=Ze(()=>{},["stop"]))},[e("div",Wn,[(a(!0),u(Ie,null,$e(t(s),(de,Ee)=>(a(),u("div",{key:Ee,class:ge(["flex-shrink-0 rounded-lg px-2 py-1 ml-2",{"bg-sky-500 text-white":t(G)===Ee}]),onClick:qe=>De(Ee),onMouseover:D[9]||(D[9]=qe=>xe.value=!0),onMouseleave:D[10]||(D[10]=qe=>xe.value=!1),style:Je({cursor:t(xe)?"pointer":"default"})},_(de.type),47,Qn))),128))]),l(d,{style:{height:"calc(100% - 40px)"}},{default:r(()=>[e("div",Zn,[(a(!0),u(Ie,null,$e(t(Ce).emoji,(de,Ee)=>(a(),u("div",{key:Ee,class:"flex items-center justify-center cursor-pointer",onClick:qe=>Pe(de.emoji)},[l(pe,{class:"box-item",effect:"dark",content:de.title,placement:"top"},{default:r(()=>[e("div",Yn,_(de.emoji),1)]),_:2},1032,["content"])],8,Xn))),128))])]),_:1})])):me("",!0)])]),e("div",ea,[e("div",ta,[l(d,{ref_key:"scrollTextRef",ref:j,class:"scrollbar",height:100},{default:r(()=>[ze(e("textarea",{"onUpdate:modelValue":D[12]||(D[12]=de=>Ve(x)?x.value=de:null),onInput:v,onKeydown:W,placeholder:z.$t("btn.inputSearch"),ref_key:"messageInput",ref:y,class:ge(["message-input",{"cursor-not-allowed opacity-50":t(H)}]),disabled:t(H)},null,42,la),[[at,t(x)]])]),_:1},512)]),e("div",{class:ge(["flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",{"cursor-not-allowed opacity-50":t(H)}]),style:{"border-left":"1px solid #ccc"},onClick:q},[l(t(S),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})],2)])])}}}),sa=We(oa,[["__scopeId","data-v-029be767"]]),na="/assets/tgChat-C3m2x06y.png",aa={key:0,class:"flex flex-row-reverse mb-4"},ia={class:"relative"},ra={class:"w-8 h-8 rounded-full bg-cyan-200 mr-2 mb-1"},ca={class:"text-xl text-white w-full h-full flex justify-center items-center"},ua={class:"flex items-end justify-end mb-3 absolute left-0 bottom-0"},da={key:0},pa={key:1},fa={class:"flex flex-row"},ma={class:"w-full flex flex-col items-end mr-2"},ga=["id","onContextmenu"],va={class:"whitespace-normal"},ha={key:0},ya={key:0},_a=["data"],Ia=["data"],ba={key:1},xa=["innerHTML"],wa={key:2,class:"flex items-center"},Ca={class:"flex w-full"},ka={key:1},Aa={key:0},Ma={key:0,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},$a={class:"rounded-full p-2 mx-4 bg-sky-500"},ja={key:1},Sa=["src","onClick"],Da={key:1},La={key:0},Ta=["src","onClick"],Na={key:1},Va=["src","onClick"],Ua={key:2},Ra={key:3,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},Ga=["href"],Ea={class:"rounded-full p-2 mx-4 bg-sky-500"},Fa=["innerHTML"],za={key:2,class:"flex items-center",style:{height:"20px"}},Pa={class:"flex w-full"},Ba={class:"flex justify-between w-full"},Ha={class:"text-sky-500 font-bold text-xs"},qa={class:"text-gray-500 font-bold text-xs ml-3 mr-2"},Oa={key:1,class:"flex mt-4"},Ka={class:"relative"},Ja={class:"w-8 h-8 rounded-full bg-cyan-200 ml-4 -mt-1"},Wa={class:"text-xl text-white flex justify-center items-center"},Qa={key:0,class:"flex items-end justify-end -ml-4 mb-3 w-12 absolute right-0 bottom-0"},Za={class:"flex flex-row"},Xa={class:"w-full flex flex-col items-start ml-2"},Ya=["id","onContextmenu"],ei={class:"whitespace-normal"},ti={key:0},li=["innerHTML"],oi={key:0,class:"flex items-center"},si={class:"flex w-full"},ni={key:1},ai={key:0},ii={key:0,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},ri=["href"],ci={class:"rounded-full p-2 mx-4 bg-sky-500"},ui={key:1},di=["src","onClick"],pi=["innerHTML"],fi={key:1},mi={key:0},gi=["src","onClick"],vi={key:1},hi=["src","onClick"],yi={key:2},_i={key:3,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},Ii=["href"],bi={class:"rounded-full p-2 mx-4 bg-sky-500"},xi=["innerHTML"],wi={class:"flex justify-between w-full"},Ci={class:"text-gray-500 font-bold text-xs ml-3 mr-2"},ki={class:"text-sky-500 font-bold text-xs"},Ai={key:0,class:"bg-gray-100 relative h-screen",style:{height:"7vh"}},Mi={class:"absolute -bottom-1 left-0 w-full h-16 bg-white",style:{border:"1px solid #ccc"}},$i={class:"flex items-center justify-center h-full",style:{border:"1px solid red"}},ji={class:"w-1/12 ml-4 flex items-center justify-center"},Si={class:"w-10/12 items-center justify-center"},Di={class:"text-sky-500"},Li={key:0},Ti={key:1},Ni={key:0},Vi={class:"rounded-full py-1 px-2 mx-10 bg-sky-500 flex items-center"},Ui={class:"w-full truncate cursor-pointer hover:text-sky-500"},Ri={class:"rounded-full py-1 px-2 mx-10 flex items-center"},Gi=["src"],Ei={class:"w-full truncate cursor-pointer hover:text-sky-500"},Fi={key:1},zi={class:"rounded-full py-1 px-2 mx-10 flex items-center"},Pi={class:"flex items-center"},Bi=["src"],Hi={class:"w-full truncate cursor-pointer hover:text-sky-500"},qi={class:"rounded-full py-1 px-2 mx-10 h-8 bg-sky-500 flex items-center"},Oi={class:"truncate"},Ki={class:"w-full truncate cursor-pointer hover:text-sky-500"},Ji={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Wi={class:"mx-auto max-w-full"},Qi=["src"],Zi={class:"dialog-footer"},Xi={style:{float:"left"}},Yi={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},er={class:"dialog-footer"},tr={class:"dialog-footer"},lr=Be({__name:"contantChat",props:["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName","isHistory"],emits:["messageId","editMessage","lazyLoad","translate","delMessage","historyLazyLoad"],setup(p,{expose:h,emit:i}){const o=p,m=i;h({resetScrollPosition:Me}),je(()=>[o.currentConId,o.currentGroId],()=>{g.value=1,ne(),Me()});const y=n([]),v=n([]);je(()=>o.conChatList,()=>{o.conChatList.length>0&&(y.value=o.conChatList,o.conChatList.forEach(c=>{v.value.push(c.msgId)}))}),je([()=>o.currentAccId,()=>o.currentConId,()=>o.currentGroId],()=>{y.value=[],v.value=[]});const j="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/",E=n(""),x=n(""),M=n(""),L=n(""),te=n(""),ce=n(!1),ie=n(!1),H=n(""),q=n(""),W=n(!1),b=n();function ue(c,s){c.preventDefault();const G=[{label:Ye.global.t("im.chat.replyMessage"),svgIcon:"#charm--reply",onClick:()=>{c.target instanceof HTMLElement&&"dataset"in c.target&&c.target.dataset.id,L.value=s.filePath,te.value=s.file,ce.value=s.isRead,ie.value=s.sender,s.filePath===null&&s.file===null?(E.value=s.message,x.value="",M.value=""):E.value=s.message,s.filePath&&(x.value=s.filePath,M.value=""),s.file&&(M.value=s.file.name,x.value=""),Ne().setReplyIndex(s.id),Ne().setReplyTrue(),m("messageId","right",s.msgId,s.filePath,s.file,s.isRead)}},{label:Ye.global.t("im.chat.editMessage"),svgIcon:"#iconamoon--edit-fill",onClick:()=>{m("editMessage",s.msgId,s.message)}},{label:Ye.global.t("im.chat.deleteMessage"),svgIcon:"#icon-multiply",onClick:()=>{Q.value=s.msgId,le.value=!0}},{label:"消息转发",svgIcon:"#basil--forward-solid",onClick:()=>{W.value=!0,b.value=s,$()}}];s.translateText||G.push({label:Ye.global.t("im.chat.translationMessage"),svgIcon:"#dashicons--translation",onClick:()=>{H.value=s.msgId,q.value=s.message,oe.value=!0}}),rt.showContextMenu({x:c.x,y:c.y,theme:"mac",items:G})}const Q=n("");function ae(c,s){c.preventDefault();const G=[{label:Ye.global.t("im.chat.replyMessage"),svgIcon:"#charm--reply",onClick:()=>{L.value=s.filePath,te.value=s.file,ce.value=s.isRead,ie.value=s.sender,s.filePath===null&&s.file===null?(E.value=s.message,x.value="",M.value=""):E.value=s.message,s.filePath&&(x.value=s.filePath,M.value=""),s.file&&(M.value=s.file,x.value=""),Ne().setReplyIndex(s.id),Ne().setReplyTrue(),m("messageId","left",s.msgId,s.filePath)}},{label:Ye.global.t("im.chat.deleteMessage"),svgIcon:"#icon-multiply",onClick:()=>{Q.value=s.msgId,le.value=!0}},{label:"消息转发",svgIcon:"#basil--forward-solid",onClick:()=>{W.value=!0,b.value=s,$()}}];s.translateText||G.push({label:Ye.global.t("im.chat.translationMessage"),svgIcon:"#dashicons--translation",onClick:()=>{H.value=s.msgId,q.value=s.message,oe.value=!0}}),rt.showContextMenu({x:c.x,y:c.y,theme:"mac",items:G})}function ve(){Ne().setReplyFalse()}function Z(){const c=Ne().index;nt(()=>{const s=`${c}`,G=document.getElementById(s);G&&G.scrollIntoView({behavior:"smooth",block:"center"})})}const le=n(!1),Ae=n(!0);function ye(){le.value=!1;const c={id:o.currentAccId,userId:o.currentConId,msgId:Q.value,revoke:Ae.value};Al(c).then(s=>{m("delMessage",Q.value),Fe({type:"success",message:"Delete successfully"})}).catch(s=>{}),he()}function he(){le.value=!1,Ae.value=!1}const oe=n(!1),C=n("zh"),k=n(Qt);function se(){oe.value=!1;const c={id:o.currentAccId,user_id:o.currentConId,msg_id:H.value,msg:q.value,to_lang:C.value};Ml(c).then(s=>{try{m("translate",H.value,s.data.data.newMsg)}catch{}}).catch(s=>{}),J()}function J(){oe.value=!1}const P=n(""),X=n(),re=n([]);function $(){const c={id:o.currentAccId};Pt(c).then(s=>{if(re.value=s.data.data.map(G=>({...G,label:G.tgAccountDialog.groupId!=null?G.tgAccountDialog.groupTitle:G.tgAccountDialog.userName})),b.value){const G=s.data.data.find(xe=>{var Ce;return xe.tgAccountDialog.userId==((Ce=b.value)==null?void 0:Ce.toUserId)});X.value=G.tgAccountDialog.userHash}}).catch(s=>{})}function U(){var s,G,xe,Ce,De,Pe,z,D;const c=JSON.parse(P.value);if(b.value){const pe=new FormData;pe.append("Id",String(o.currentAccId)),pe.append("MsgIds",String((s=b.value)==null?void 0:s.msgId)),(G=b.value)!=null&&G.formChatId&&pe.append("FormChatId",String((xe=b.value)==null?void 0:xe.formChatId)),(Ce=b.value)!=null&&Ce.toUserId&&(pe.append("FromPeerId",String((De=b.value)==null?void 0:De.toUserId)),pe.append("FromPeerHash",String(X.value))),c.tgAccountDialog.groupId!=null?pe.append("ToChatId",String(c.tgAccountDialog.groupId)):(pe.append("ToPeerId",String(c.tgAccountDialog.userId)),pe.append("ToPeerHash",String(c.tgAccountDialog.userHash))),pe.append("Msg",(Pe=b.value)==null?void 0:Pe.message),pe.append("FilePath",(z=b.value)==null?void 0:z.filePath),pe.append("TranslateMsg",(D=b.value)==null?void 0:D.translateText),$l(pe).then(d=>{Fe.success("消息发送成功")}).catch(d=>{Fe.error("消息发送失败")}),T()}}function T(){W.value=!1,P.value=""}const N=n(null),I=n(!1),g=n(1),ne=()=>{nt(()=>{if(N.value){const c=N.value.$el.querySelector(".el-scrollbar__wrap");if(c)try{c.scrollTop=c.scrollHeight-c.clientHeight,N.value.setScrollTop(c.scrollTop)}catch{}}})};je([()=>o.conChatList],([])=>{I.value?(I.value=!1,nt(()=>{if(N.value){const c=N.value.$el.querySelector(".el-scrollbar__wrap");c&&(Y.value=c.scrollHeight-c.scrollTop-c.clientHeight,c.scrollTop=c.scrollHeight-Y.value)}})):ne()},{deep:!0}),je(()=>Ne().showReply,c=>{c||ne()});const Y=n(0),we=()=>{nt(()=>{if(N.value){const c=N.value.$el.querySelector(".el-scrollbar__wrap");c&&c.scrollTop===0&&(c.scrollTop,o.conChatList.length<o.totalPages&&(I.value=!0,g.value++,o.isHistory?(o.conChatList.length<o.totalPages,m("historyLazyLoad",g.value)):(o.conChatList.length<o.totalPages,m("lazyLoad",g.value))))}})};function Me(){Y.value=0}je(()=>o.currentConId,()=>{Me()});function be(c,s){if(c){if(c.startsWith("http://")||c.startsWith("https://"))return"networkImg";if(c=="账号异常，文件保存失败！")return"error";const G=c.lastIndexOf(".");if(G!==-1){const Ce=c.substring(G+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(Ce))return"image"}let xe=-1;return s===!0?xe=c.lastIndexOf("-"):xe=c.lastIndexOf("/"),xe!==-1?c.substring(xe+1):""}}function He(c){if(c){if(c=="账号异常，文件保存失败！")return"error";const s=c.lastIndexOf(".");if(s!==-1){const G=c.substring(s+1).toLowerCase();return["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(G)?"image":"file"}}}function Te(c){const s=o.conChatList;for(let G of s)if(G.msgId===c)return G.filePath;return null}function Ge(c){const s=o.conChatList;for(let G of s)if(G.msgId===c)return G.message;return null}const Re=n(!1),F=n(""),A=c=>{F.value=c,Re.value=!0},R=()=>{Re.value=!1},K=c=>{if(c){const s=URL.createObjectURL(c),G=document.createElement("a");G.href=s,G.download=c.name,G.click(),URL.revokeObjectURL(s)}};function w(c){if(c)return c.startsWith(j)?c:j+c}function f(c){if(c)return c.replace(/\r\n|\r|\n/g,"<br>")}const O=n(""),_e=c=>{const s=JSON.parse(c);s.type===Oe.TranslationSuccessful&&(O.value=s.TranslateText,y.value.forEach(G=>{G.msgId===s.msg_id&&G.accountId===s.accountId&&(G.toUserId===s.formUserId||G.formUserId===s.formUserId)&&(G.translateText=s.TranslateText)}))};return et.on("updateNotice",_e),pt(()=>{et.off("updateNotice",_e)}),ot(()=>{ne()}),(c,s)=>{const G=el,xe=Yt,Ce=Bt,De=Ke,Pe=Xe,z=ft,D=mt,pe=ct;return a(),u(Ie,null,[e("div",{class:"bg-gray-100 h-screen",style:Je({height:("useImStore"in c?c.useImStore:t(Ne))().showReply?"55vh":"63vh"})},[ze((a(),fe(t(tt),{ref_key:"scrollRef",ref:N,"element-loading-background":"rgba(122, 122, 122, 0.1)","element-loading-text":"消息内容加载状态...",onScroll:we,style:Je({height:("useImStore"in c?c.useImStore:t(Ne))().showReply?"55vh":"63vh","background-image":`url(${t(na)})`,"background-size":"cover","background-repeat":"no-repeat"})},{default:r(()=>[(a(!0),u(Ie,null,$e(t(y),(d,Se)=>{var V,Le;return a(),u("div",{key:d.id},[d.sender===!0?(a(),u("div",aa,[e("div",ia,[e("div",ra,[e("div",ca,[e("span",null,_(o.currentAccName.charAt(0)),1)])]),e("div",ua,[d.sendFailed?(a(),u("div",da,[l(t(S),{icon:"material-symbols:error-outline",class:"text-red-500",style:{"font-size":"22px"}})])):(a(),u("div",pa,[d.status===3?(a(),fe(t(S),{key:0,icon:"ion:checkmark-done-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):d.status===0?(a(),fe(t(S),{key:1,icon:"ion:ellipsis-horizontal-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):(a(),fe(t(S),{key:2,icon:"ion:checkmark-sharp",style:{"font-size":"22px"}}))]))])]),e("div",fa,[e("div",ma,[e("div",{id:`${d.id}`,class:"max-w-md bg-white p-3 border border-gray-300 rounded-lg",onContextmenu:ke=>ue(ke,d)},[e("div",va,[d.filePath===null&&(d.file===null||d.file===void 0)?(a(),u("div",ha,[d.isRead===!1?(a(),u("span",ya,[d.replyToMsgId!=null&&String(d.existFilePath)=="image"?(a(),u("div",{key:0,class:"h-7 w-full pl-2 mb-2",data:`${d.existFile}`,style:{"border-left":"4px solid #ccc"},onClick:Z}," [图片] ",8,_a)):d.replyToMsgId!=null&&String(d.existFile)=="file"?(a(),u("div",{key:1,class:"h-7 w-full pl-2 mb-2",data:`${d.existFilePath}`,style:{"border-left":"4px solid #ccc"},onClick:Z}," [文件] ",8,Ia)):d.replyToMsgId!=null?(a(),u("div",{key:2,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z},_(Ge(d.replyToMsgId)),1)):me("",!0)])):(a(),u("span",ba,[d.replyToMsgId!=null&&He(Te(d.replyToMsgId))==="image"?(a(),u("div",{key:0,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z}," [图片] ")):d.replyToMsgId!=null&&He(Te(d.replyToMsgId))==="file"?(a(),u("div",{key:1,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z}," [文件] ")):d.replyToMsgId!=null&&d.filePath==null?(a(),u("div",{key:2,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z},_(Ge(d.replyToMsgId)),1)):me("",!0)])),e("p",{innerHTML:f(d.message)},null,8,xa),d.translateText?(a(),u("div",wa,[e("div",Ca,[l(xe,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:r(()=>[l(G,{name:d.msgId,icon:"null"},{title:r(()=>[l(t(S),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:r(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):me("",!0)])):(a(),u("div",ka,[d.isRead===!1?(a(),u("span",Aa,[d.file?(a(),u("div",Ma,[e("div",$a,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl",onClick:ke=>K(d.file)},null,8,["onClick"])]),e("p",null,_(d.file.name),1)])):(a(),u("div",ja,[(a(!0),u(Ie,null,$e(d.filePath,(ke,Qe)=>(a(),u("div",{key:Qe,class:"mb-2 relative"},[e("img",{src:ke,onClick:st=>A(ke),alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,Sa)]))),128))]))])):(a(),u("span",Da,[be(d.filePath,d.sender)==="image"?(a(),u("div",La,[e("img",{"data-id":23333,src:w(d.filePath),onClick:ke=>A(w(d.filePath)),class:"h-48 w-full object-contain"},null,8,Ta)])):be(d.filePath,d.sender)==="networkImg"?(a(),u("div",Na,[e("img",{src:`${d.filePath}`,onClick:ke=>A(d.filePath),class:"h-48 w-full object-contain"},null,8,Va)])):be(d.filePath,d.sender)==="error"?(a(),u("div",Ua)):(a(),u("div",Ra,[e("div",null,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",Ea,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(be(d.filePath,d.sender)),1)],8,Ga)])]))])),e("p",{innerHTML:f(d.message)},null,8,Fa),d.translateText?(a(),u("div",za,[e("div",Pa,[l(xe,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:r(()=>[l(G,{name:d.msgId,icon:"null"},{title:r(()=>[l(t(S),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:r(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):me("",!0)]))])],40,ga),e("div",Ba,[e("div",Ha,_((V=d.date)==null?void 0:V.replace("T","")),1),e("div",qa,_(o.currentName),1)])])])])):(a(),u("div",Oa,[e("div",Ka,[e("div",Ja,[e("div",Wa,_(o.currentName.charAt(0)),1)]),p.currentGroId==-1?(a(),u("div",Qa,[d.status===3?(a(),fe(t(S),{key:0,icon:"ion:checkmark-done-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):d.status===0?(a(),fe(t(S),{key:1,icon:"ion:ellipsis-horizontal-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):(a(),fe(t(S),{key:2,icon:"ion:checkmark-sharp",style:{"font-size":"22px"}}))])):me("",!0)]),e("div",Za,[e("div",Xa,[e("div",{id:`${d.id}`,class:"max-w-md bg-white p-4 border border-gray-300 rounded-lg",onContextmenu:ke=>ae(ke,d)},[e("div",ei,[d.filePath===null&&(d.file===null||d.file===void 0)?(a(),u("div",ti,[e("p",{innerHTML:f(d.message)},null,8,li),d.translateText?(a(),u("div",oi,[e("div",si,[l(xe,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:r(()=>[l(G,{name:d.msgId,icon:"null"},{title:r(()=>[l(t(S),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:r(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):me("",!0)])):(a(),u("div",ni,[d.isRead===!1?(a(),u("span",ai,[d.file?(a(),u("div",ii,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",ci,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(d.file.includes(".ogg")?"语音":d.file),1)],8,ri)])):(a(),u("div",ui,[e("img",{class:"h-48 w-full object-contain",src:w(d.filePath),onClick:ke=>A(w(d.filePath))},null,8,di)])),e("p",{innerHTML:f(d.message)},null,8,pi)])):(a(),u("span",fi,[be(d.filePath,d.sender)==="image"?(a(),u("div",mi,[e("img",{class:"h-48 w-full object-contain",src:w(d.filePath),onClick:ke=>A(w(d.filePath))},null,8,gi)])):be(d.filePath,d.sender)==="networkImg"?(a(),u("div",vi,[e("img",{src:`${d.filePath}`,onClick:ke=>A(w(d.filePath))},null,8,hi)])):be(d.filePath,d.sender)==="error"?(a(),u("div",yi)):(a(),u("div",_i,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",bi,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(be(d.filePath,d.sender).includes(".ogg")?"语音":be(d.filePath,d.sender)),1)],8,Ii)])),e("p",{innerHTML:f(d.message),class:"whitespace-normal break-words"},null,8,xi)]))]))])],40,Ya),e("div",wi,[e("div",Ci,_(o.currentAccName),1),e("div",ki,_((Le=d.date)==null?void 0:Le.replace("T","")),1)])])])]))])}),128))]),_:1},8,["style"])),[[pe,o.loading]])],4),("useImStore"in c?c.useImStore:t(Ne))().showReply?(a(),u("div",Ai,[e("div",Mi,[e("div",$i,[e("div",ji,[l(t(S),{icon:"ic:baseline-reply",class:"mr-4 text-sky-500",style:{"font-size":"22px"}})]),e("div",Si,[e("div",Di,"Reply to "+_(o.currentName??""),1),t(L)===null&&t(te)===null?(a(),u("div",Li,[e("div",{class:"w-full truncate cursor-pointer hover:text-sky-500",onClick:Z},_(t(E)),1)])):(a(),u("div",Ti,[t(ce)===!1?(a(),u("div",Ni,[t(te)?(a(),u("div",{key:0,class:"flex items-center -ml-10",onClick:Z},[e("div",Vi,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-xl"}),e("p",null,_(t(M)),1)]),e("div",Ui,_(t(E)),1)])):(a(),u("div",{key:1,class:"flex items-center -ml-10",onClick:Z},[e("div",Ri,[e("img",{class:"h-8 w-16",src:t(x)},null,8,Gi)]),e("div",Ei,_(t(E)),1)]))])):(a(),u("div",Fi,[be(t(x),t(ie))==="image"?(a(),u("div",{key:0,class:"flex items-center -ml-10",onClick:Z},[e("div",zi,[e("div",Pi,[e("img",{class:"h-8 w-16",src:`${t(j)}${t(x)}`},null,8,Bi)])]),e("div",Hi,_(t(E)),1)])):(a(),u("div",{key:1,class:"flex items-center -ml-10",onClick:Z},[e("div",qi,[l(t(S),{icon:"basil:document-solid",class:"text-white cursor-pointer text-xl"}),e("div",Oi,_(be(t(x),t(ie))),1)]),e("div",Ki,_(t(E)),1)]))]))]))]),e("div",{class:"w-1/12 items-center justify-center cursor-pointer",onClick:ve},[l(t(S),{icon:"icon-park-twotone:error",class:"mr-4 text-sky-500",style:{"font-size":"22px"}})])])])])):me("",!0),(a(),u("svg",Ji,s[6]||(s[6]=[hl('<symbol id="charm--reply" viewBox="0 0 16 16" data-v-5f370528><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.25 13.25c-.5-6-5.5-7.5-8-7v-3.5L1.75 8l4.5 5.25v-3.5c2.5-.5 6.5.5 8 3.5" data-v-5f370528></path></symbol><symbol id="iconamoon--edit-fill" viewBox="0 0 24 24" data-v-5f370528><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 16l-1 4l4-1L19.586 7.414a2 2 0 0 0 0-2.828l-.172-.172a2 2 0 0 0-2.828 0z" data-v-5f370528></path><path fill="currentColor" d="m5 16l-1 4l4-1L18 9l-3-3z" data-v-5f370528></path><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 6l3 3m-5 11h8" data-v-5f370528></path></symbol><symbol id="icon-multiply" viewBox="0 0 1024 1024" data-v-5f370528><path d="M512 64C264.608 64 64 264.608 64 512c0 247.36 200.608 448 448 448 247.36 0 448-200.64 448-448 0-247.392-200.64-448-448-448z m158.4 651.552L512 557.312l-158.4 158.24-45.312-45.248L466.688 512l-158.304-158.4 45.312-45.312L512 466.688l158.4-158.4 45.28 45.312L557.312 512l158.368 158.4-45.28 45.152z" fill="#F74A21" data-v-5f370528></path></symbol><symbol id="dashicons--translation" viewBox="0 0 20 20" data-v-5f370528><path fill="currentColor" d="M11 7H9.49c-.63 0-1.25.3-1.59.7L7 5H4.13l-2.39 7h1.69l.74-2H7v4H2c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h7c1.1 0 2 .9 2 2zM6.51 9H4.49l1-2.93zM10 8h7c1.1 0 2 .9 2 2v7c0 1.1-.9 2-2 2h-7c-1.1 0-2-.9-2-2v-7c0-1.1.9-2 2-2m7.25 5v-1.08h-3.17V9.75h-1.16v2.17H9.75V13h1.28c.11.85.56 1.85 1.28 2.62c-.87.36-1.89.62-2.31.62c-.01.02.22.97.2 1.46c.84 0 2.21-.5 3.28-1.15c1.09.65 2.48 1.15 3.34 1.15c-.02-.49.2-1.44.2-1.46c-.43 0-1.49-.27-2.38-.63c.7-.77 1.14-1.77 1.25-2.61zm-3.81 1.93c-.5-.46-.85-1.13-1.01-1.93h2.09c-.17.8-.51 1.47-1 1.93l-.04.03s-.03-.02-.04-.03" data-v-5f370528></path></symbol><symbol id="basil--forward-solid" viewBox="0 0 24 24" data-v-5f370528><path fill="currentColor" d="M2.554 16.06a.5.5 0 0 0 .656.68l2.499-1.153c2.1-.97 4.393-1.413 6.681-1.309q.041 1.103.121 2.204l.069.938a.754.754 0 0 0 1.158.581a19.6 19.6 0 0 0 5.351-5.068l.46-.64a.5.5 0 0 0 0-.584l-.46-.64A19.6 19.6 0 0 0 13.738 6a.754.754 0 0 0-1.158.58l-.069.94a62 62 0 0 0-.108 1.89h-.644a9.5 9.5 0 0 0-8.475 5.209z" data-v-5f370528></path></symbol>',5)]))),l(Nt,{name:"zoom-fade",mode:"out-in"},{default:r(()=>[t(Re)?(a(),u("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{"z-index":"100"},onClick:R},[e("div",Wi,[e("img",{src:t(F),class:"object-cover w-full"},null,8,Qi)])])):me("",!0)]),_:1}),l(Pe,{modelValue:t(le),"onUpdate:modelValue":s[1]||(s[1]=d=>Ve(le)?le.value=d:null),title:c.$t("im.chat.confirmDelMessage"),width:"500"},{footer:r(()=>[e("div",Zi,[l(De,{onClick:he},{default:r(()=>[B(_(c.$t("btn.cancel")),1)]),_:1}),l(De,{type:"primary",onClick:ye},{default:r(()=>[B(_(c.$t("btn.delete")),1)]),_:1})])]),default:r(()=>[e("div",null,[l(Ce,{modelValue:t(Ae),"onUpdate:modelValue":s[0]||(s[0]=d=>Ve(Ae)?Ae.value=d:null),label:c.$t("im.chat.isDelBothSides"),size:"large"},null,8,["modelValue","label"])])]),_:1},8,["modelValue","title"]),l(Pe,{modelValue:t(oe),"onUpdate:modelValue":s[3]||(s[3]=d=>Ve(oe)?oe.value=d:null),title:c.$t("im.chat.selectLanguage"),width:"500"},{footer:r(()=>[e("div",er,[l(De,{onClick:J},{default:r(()=>[B(_(c.$t("btn.cancel")),1)]),_:1}),l(De,{type:"primary",onClick:se},{default:r(()=>[B(_(c.$t("im.chat.translation")),1)]),_:1})])]),default:r(()=>[l(D,{modelValue:t(C),"onUpdate:modelValue":s[2]||(s[2]=d=>Ve(C)?C.value=d:null),placeholder:"Select",style:{width:"240px"},filterable:""},{default:r(()=>[(a(!0),u(Ie,null,$e(t(k),d=>(a(),fe(z,{key:d.language,label:d.country,value:d.language},{default:r(()=>[e("span",Xi,_(d.country),1),e("span",Yi,_(d.language),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),l(Pe,{modelValue:t(W),"onUpdate:modelValue":s[5]||(s[5]=d=>Ve(W)?W.value=d:null),title:"选择转发对象",width:"500",onClose:T},{footer:r(()=>[e("div",tr,[l(De,{onClick:T},{default:r(()=>s[7]||(s[7]=[B("Cancel")])),_:1}),l(De,{type:"primary",onClick:U},{default:r(()=>s[8]||(s[8]=[B("Confirm")])),_:1})])]),default:r(()=>[l(D,{modelValue:t(P),"onUpdate:modelValue":s[4]||(s[4]=d=>Ve(P)?P.value=d:null),placeholder:"Select",size:"large",style:{width:"240px"},filterable:""},{default:r(()=>[(a(!0),u(Ie,null,$e(t(re),d=>(a(),fe(z,{style:{width:"240px"},key:d.tgAccountDialog.id,label:d.label,value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}}),St=We(lr,[["__scopeId","data-v-5f370528"]]),or={class:"col-span-4 mt-1 bg-white rounded-md p-4 relative"},sr={class:"mb-1",style:{"border-bottom":"1px solid #ccc",height:"5%"}},nr={class:"flex justify-between items-center h-full ml-4"},ar={key:0,class:"flex items-center justify-between w-full"},ir={class:"flex"},rr={class:"font-black"},cr={key:0},ur={key:1,class:"flex items-center justify-between w-full"},dr={class:"font-black"},pr={key:0,class:"absolute top-20 left-72 z-10"},fr={class:"flex justify-between items-center mb-4 pb-4",style:{"border-bottom":"1px solid #ccc"}},mr=Be({__name:"chatRoom",props:{currentAccId:{type:Number,required:!0},currentConId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},currentUsername:{type:String,required:!1},currentTitle:{type:String,required:!1},currentAccName:{type:String,required:!1},currComs:{type:String,required:!0},currSelTab:{type:String,required:!0}},emits:["clearContactId","clearGroupId"],setup(p,{expose:h,emit:i}){const o=p,m=i,y=Ne(),v=n(-1),j=n(-1),E=n(-1);je(()=>[o.currentAccId,o.currentConId,o.currentGroId],([A],[R])=>{A!=R?x():(v.value=o.currentAccId,j.value=o.currentConId,E.value=o.currentGroId,M(),Ae()),le.value=!1}),je(()=>o.currComs,()=>{x()}),je(()=>o.currSelTab,()=>{x()});function x(){m("clearContactId"),m("clearGroupId"),j.value=-1,E.value=-1,M()}function M(){ae.value=1,Q.value=[],Z.value=0,le.value=!1,Ne().setReplyFalse()}let L=n();const te=n(),ce=n(),ie=n();function H(A,R,K,w,f){A=="left"?(ce.value=Me(K),ie.value=Me(K)):A=="right"&&(f?(ce.value=Me(K),ie.value=Me(K)):(ce.value=K?"image":null,ie.value=w?"file":null)),te.value=R,L.value="reply"}const q=n(),W=n();function b(A,R){q.value=A,W.value=R,L.value="edit"}function ue(){L.value=void 0,te.value=void 0,ce.value=void 0,ie.value=void 0,q.value=void 0,W.value=void 0}const Q=n([]),ae=n(1),ve=n(20),Z=n(0),le=n(!1);async function Ae(){zt(),setTimeout(async()=>{le.value=!0;let A={id:v.value,to_user_id:0,isGroup:!1,pageNum:ae.value,pageSize:ve.value};if(o.currentConId!=-1?A.to_user_id=j.value:o.currentGroId!=-1&&(A.to_user_id=E.value,A.isGroup=!0),j.value!=-1||E.value!=-1)try{const R=await jl(A);R.data.data.data.forEach(K=>{K.isRead=!0,K.file=null}),Q.value=[...R.data.data.data.slice().reverse(),...Q.value],Z.value=R.data.data.totalCount}catch{}finally{le.value=!1}},200)}const ye=n(!1),he=n([]),oe=n(""),C=n(!1),k=Vt({pageSizes:[1,10,20,50],pageSize:10,pageNum:1,total:400});function se(A){C.value=!1,k.pageNum=A,J()}function J(){if(ye.value=!0,C.value=!0,le.value=!0,o.currentConId!=-1){const A={Id:o.currentAccId,UserId:o.currentConId,Like:oe.value,pageNum:k.pageNum,pageSize:k.pageSize};oe.value!=""&&(A.pageNum=1),Sl(A).then(R=>{R.data.data.data.map(K=>({...K})),oe.value!=""?he.value=R.data.data.data.slice().reverse():he.value=[...R.data.data.data.slice().reverse(),...he.value]}).catch(R=>{}).finally(()=>{le.value=!1})}else if(o.currentGroId!=-1){const A={GroupId:o.currentGroId,Like:oe.value,pageNum:k.pageNum,pageSize:k.pageSize};oe.value!=""&&(A.pageNum=1),Dl(A).then(R=>{R.data.data.data.map(K=>({...K})),oe.value!=""?he.value=R.data.data.data.slice().reverse():he.value=[...R.data.data.data.slice().reverse(),...he.value]}).catch(R=>{}).finally(()=>{le.value=!1})}}function P(){ye.value=!1,he.value=[],k.pageNum=1}function X(A){return Ae(),Q.value=Q.value.filter(R=>R.msgId!==A),Q.value}function re(A){le.value=!0,ae.value=A,k.pageNum=A,Ae()}function $(A,R){const K=Q.value.find(w=>w.msgId===A);K&&(K.translateText=R)}h({quickMsg:T});const U=n();function T(A){U.value.sendQueickMsg(A)}function N(){const A=new Date,R=A.getFullYear(),K=String(A.getMonth()+1).padStart(2,"0"),w=String(A.getDate()).padStart(2,"0"),f=String(A.getHours()).padStart(2,"0"),O=String(A.getMinutes()).padStart(2,"0"),_e=String(A.getSeconds()).padStart(2,"0");return`${R}-${K}-${w}T${f}:${O}:${_e}`}const I=n(!1);function g(){I.value=!0}function ne(A){let R=null;if(Q.value.length==0?R={id:0,date:N(),msgId:0,sender:!0,message:A.massage,status:0,file:A.file,filePath:A.filePath,isRead:!1}:R=Q.value[Q.value.length-1],R){const K={...R};K.sender=!0,K.message=A.massage,K.id=(R.id??0)+1,K.msgId=A.date,K.status=0,K.filePath=A.filePath,K.existFilePath=ce.value,K.isRead=!1,K.file=A.file,K.existFile=ie.value,K.replyToMsgId=te.value,K.sendFailed=I.value,K.translateText="",Q.value.push(K)}}function Y(A,R,K){const w=Q.value.find(f=>f.msgId===A);w&&(w.msgId=R,w.status=K)}function we(A){if(A){const R=A.lastIndexOf(".");if(R!==-1){const w=A.substring(R+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(w))return null}const K=A.lastIndexOf("/");return K!==-1?A.substring(K+1):null}return null}function Me(A){if(A){const R=A.lastIndexOf(".");if(R!==-1){const K=A.substring(R+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(K))return"image"}return"file"}return null}const be=Ue(()=>y.accountsIdMap);function He(A,R){const K=A.find(w=>w.accountId!=null?w.accountId===R:"");return K?K.id:null}const Te=A=>{const R=JSON.parse(A);if(R.Type===Oe.MessageRead&&(Q.value=Q.value.map(K=>({...K,status:3}))),R.type===Oe.NewUserMessage){const{accountId:K,formUserId:w}=R,f=He(be.value,K);if(w===o.currentConId&&f===o.currentAccId){const O=Q.value[Q.value.length-1];if(O){const _e={...O};_e.sender=!1,_e.message=R.message,_e.msgId=R.msg_id,_e.id=(O.id??0)+1,_e.status=3,_e.filePath=R.filePath,_e.isRead=!1,_e.file=we(R.filePath),_e.translateText=R.TranslateText,Q.value.push(_e)}}}};et.on("updateNotice",Te),pt(()=>{et.off("updateNotice",Te)});const Ge=A=>y.getLabelById(o.currentAccId,A),Re=n();function F(){nt(()=>{Re.value.resetScrollPosition()})}return(A,R)=>{const K=Ke,w=ut,f=Xe;return a(),u(Ie,null,[e("div",or,[e("div",sr,[e("div",nr,[o.currentUsername!=null?(a(),u("div",ar,[e("div",ir,[Ge(p.currentConId)?(a(),fe(t(S),{key:0,icon:"fluent-emoji:label",style:{"font-size":"18px"}})):me("",!0),e("span",null,_(Ge(p.currentConId)?Ge(p.currentConId):""),1)]),e("div",null,[e("span",rr,[B(_(o.currentUsername)+" ",1),t(y).getRemarkById(o.currentAccId,o.currentConId)!==""?(a(),u("span",cr,_(`(${t(y).getRemarkById(o.currentAccId,o.currentConId)})`),1)):me("",!0)])]),e("div",{onClick:J},[l(K,{type:"primary"},{default:r(()=>R[2]||(R[2]=[B("历史消息")])),_:1})])])):me("",!0),o.currentTitle?(a(),u("div",ur,[e("span",dr,_(o.currentTitle),1),e("div",{onClick:J},[l(K,{type:"primary"},{default:r(()=>R[3]||(R[3]=[B("历史消息")])),_:1})])])):me("",!0)])]),t(le)?(a(),u("div",pr,[l(t(S),{icon:"eos-icons:loading",class:"text-sky-500",style:{"font-size":"32px"}})])):me("",!0),l(St,{ref_key:"contantChatRef",ref:Re,conChatList:t(Q),currentAccId:t(v),currentConId:t(j),currentGroId:t(E),pageNum:t(ae),totalPages:t(Z),loading:t(le),currentName:p.currentUsername?p.currentUsername??"":p.currentTitle??"",currentAccName:p.currentAccName??"",onMessageId:H,onEditMessage:b,onLazyLoad:re,onTranslate:$,onDelMessage:X},null,8,["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName"]),l(sa,{ref_key:"sendMsgRef",ref:U,currentAccId:o.currentAccId,currentConId:o.currentConId,replyId:t(te),editId:t(q),editContent:t(W),sendType:t(L),currentGroId:o.currentGroId,onSendRecordMsg:Ae,onFakeM:ne,onFakeM2:g,"onUpdate:msg":Y,onVacant:ue,onResetScroll:F},null,8,["currentAccId","currentConId","replyId","editId","editContent","sendType","currentGroId"])]),l(f,{draggable:"",modelValue:t(ye),"onUpdate:modelValue":R[1]||(R[1]=O=>Ve(ye)?ye.value=O:null),title:"历史记录",width:"800",onClose:P},{default:r(()=>[e("div",fr,[l(w,{modelValue:t(oe),"onUpdate:modelValue":R[0]||(R[0]=O=>Ve(oe)?oe.value=O:null),class:ge(["w-full","input-with-select"]),placeholder:A.$t("btn.inputSearch")},{append:r(()=>[l(K,{type:"primary",plain:"",onClick:J},{default:r(()=>[l(t(S),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue","placeholder"])]),l(St,{ref_key:"contantChatRef",ref:Re,conChatList:t(he),currentAccId:t(v),currentConId:t(j),currentGroId:t(E),pageNum:t(ae),totalPages:t(Z),loading:t(le),currentName:p.currentUsername?p.currentUsername??"":p.currentTitle??"",currentAccName:p.currentAccName??"",isHistory:t(C),onHistoryLazyLoad:se},null,8,["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName","isHistory"])]),_:1},8,["modelValue"])],64)}}});class gr{constructor(h,i,o,m){lt(this,"id");lt(this,"useNum");lt(this,"msg");lt(this,"color");this.id=h,this.useNum=i,this.msg=o,m?this.color=m:this.color=yt()}}class vr{constructor(h,i){lt(this,"name");lt(this,"color");this.name=h,i?this.color=i:this.color=yt()}}const hr={class:"dialog-footer"},yr=Be({__name:"autoReply",props:{show:{type:Boolean,required:!0},autoReply:{type:Boolean,required:!0},currentAccId:{type:Number,required:!0}},emits:["update:show"],setup(p,{emit:h}){const i=p,o=h;je(()=>i.show,()=>{y()}),je(()=>i.autoReply,()=>{i.autoReply==!1&&(v.value.AutomaticReply="否",v.value.AutomaticReplyAll="否",j())});const m=n([]);function y(){Kt({GroupId:0}).then(M=>{try{m.value=M.data.data.data.map(L=>({value:L.filePath,label:L.name}))}catch{}}).catch(M=>{})}const v=n({AutomaticReply:"是",AutomaticReplyAll:"是",AutomaticReplyText:"",AutomaticReplyMaterialId:"",AutomaticReplyType:"",AutomaticReplyTimeout:"",Id:""});function j(){const x=new FormData;x.append("AutomaticReply",v.value.AutomaticReply==="是"?"true":"false"),x.append("AutomaticReplyAll",v.value.AutomaticReplyAll==="是"?"true":"false"),x.append("AutomaticReplyText",v.value.AutomaticReplyText),x.append("AutomaticReplyMaterialId",String(v.value.AutomaticReplyMaterialId)),x.append("AutomaticReplyType",String(v.value.AutomaticReplyType)),x.append("AutomaticReplyTimeout",String(v.value.AutomaticReplyTimeout)),x.append("Id",String(i.currentAccId)),Ll(x).then(M=>{M.data.data}).catch(M=>{}),E()}function E(){o("update:show",!1),v.value={AutomaticReply:"是",AutomaticReplyAll:"是",AutomaticReplyText:"",AutomaticReplyMaterialId:"",AutomaticReplyType:"",AutomaticReplyTimeout:"",Id:""}}return(x,M)=>{const L=ft,te=mt,ce=Ct,ie=ut,H=kt,q=Ke,W=Xe;return a(),u("div",null,[l(W,{modelValue:i.show,"onUpdate:modelValue":M[5]||(M[5]=b=>i.show=b),title:"自动回复设置",width:"500",onClose:E},{footer:r(()=>[e("div",hr,[l(q,{onClick:E},{default:r(()=>M[6]||(M[6]=[B("Cancel")])),_:1}),l(q,{type:"primary",onClick:j},{default:r(()=>M[7]||(M[7]=[B("Confirm")])),_:1})])]),default:r(()=>[l(H,{"label-width":"auto",model:t(v),style:{"max-width":"600px"}},{default:r(()=>[l(ce,{label:"账号自动回复","label-position":"right"},{default:r(()=>[l(te,{modelValue:t(v).AutomaticReply,"onUpdate:modelValue":M[0]||(M[0]=b=>t(v).AutomaticReply=b),filterable:""},{default:r(()=>[l(L,{label:"是",value:"true"}),l(L,{label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(ce,{label:"每条消息自动回复","label-position":"right"},{default:r(()=>[l(te,{modelValue:t(v).AutomaticReplyAll,"onUpdate:modelValue":M[1]||(M[1]=b=>t(v).AutomaticReplyAll=b),filterable:""},{default:r(()=>[l(L,{label:"是",value:"true"}),l(L,{label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(ce,{label:"回复文本","label-position":"right"},{default:r(()=>[l(ie,{modelValue:t(v).AutomaticReplyText,"onUpdate:modelValue":M[2]||(M[2]=b=>t(v).AutomaticReplyText=b)},null,8,["modelValue"])]),_:1}),l(ce,{label:"回复素材Id","label-position":"right"},{default:r(()=>[l(te,{modelValue:t(v).AutomaticReplyMaterialId,"onUpdate:modelValue":M[3]||(M[3]=b=>t(v).AutomaticReplyMaterialId=b),filterable:""},{default:r(()=>[(a(!0),u(Ie,null,$e(t(m),(b,ue)=>(a(),fe(L,{key:ue,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ce,{label:"回复延时","label-position":"right"},{default:r(()=>[l(ie,{modelValue:t(v).AutomaticReplyTimeout,"onUpdate:modelValue":M[4]||(M[4]=b=>t(v).AutomaticReplyTimeout=b),placeholder:"请输入延时时间，单位为秒"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),_r={class:"col-span-2 mt-5 rounded-md p-0 h-full"},Ir={style:{height:"50.6vh"}},br={class:"bg-white -mt-6 px-3 rounded-md",style:{height:"10.5vh"}},xr={class:"pb-2 mb-2 mt-2 items-center flex justify-between",style:{"border-bottom":"1px solid red"}},wr={class:"flex items-center"},Cr={class:"mt-1"},kr={style:{float:"left"}},Ar={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Mr={class:"mt-2 relative"},$r={key:0,class:"overlay"},jr={class:"-mt-8"},Sr={key:1,class:"p-3 bg-white rounded-md",style:{height:"38.5vh"}},Dr={class:"mb-2 pb-2 flex justify-between",style:{"border-bottom":"1px solid red"}},Lr={class:"flex items-center"},Tr={class:"flex"},Nr={class:"flex-1 flex items-center"},Vr={class:"text-with-ellipsis ml-2 mr-0 w-24"},Ur={class:"cursor-pointer"},Rr={class:"flex"},Gr={key:2,class:"mt-2 rounded-md",style:{height:"38.5vh"}},Er={class:"bg-white p-3",style:{height:"10.5vh"}},Fr={class:"pb-2 flex items-center",style:{"border-bottom":"1px solid red"}},zr={class:"bg-white mt-2 p-3 rounded-md",style:{height:"28vh"}},Pr={class:"mb-2 pb-2 flex items-center",style:{"border-bottom":"1px solid red"}},Br={style:{"word-wrap":"break-word"}},Hr=["onClick"],qr={class:"bg-white mt-4 p-3 rounded-md",style:{height:"38.5vh","user-select":"none"}},Or={class:"mb-2 pb-2 flex items-center justify-between",style:{"border-bottom":"1px solid red"}},Kr={class:"flex items-center"},Jr={style:{"word-wrap":"break-word"}},Wr=["onDblclick"],Qr={class:"mb-2"},Zr={class:"flex"},Xr={class:"w-1/2 mr-2",style:{"border-right":"1px solid #ccc"}},Yr={class:"w-1/2"},ec={class:"flex"},tc={class:"dialog-footer"},lc={class:"dialog-footer"},oc=Be({__name:"quickMess",props:{activeAcc:{type:Number,required:!0},currentConId:{type:Number,required:!0},currentAccId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},currentAcc:{type:Object,required:!0},autoReply:{type:Boolean,required:!1}},emits:["quickMsg","updateGroupName","up:autoReply"],setup(p,{emit:h}){const i=p,o=h,m=Ne(),y=Ue(()=>[i.currentConId,i.currentGroId].every(c=>c==-1));je(()=>i.currentGroId,()=>{oe()});const v=n(!1);je(()=>v.value,()=>{v.value===!0&&(k(),J())}),je(()=>i.currentAccId,()=>{x.value=i.currentAcc.language,i.autoReply===!0?L.value=!0:L.value=!1});const j=n(!1),E=n(Qt),x=n();function M(){const c={id:i.currentAccId,language:x.value};Wl(c).then(s=>{Fe.success("设置账号翻译语言成功")}).catch(s=>{})}const L=n(!1),te=n(!1);function ce(){L.value===!0?(te.value=!0,o("up:autoReply",!0),L.value):(te.value=!1,o("up:autoReply",!1),L.value)}const ie=n({nickname:""});function H(){const c=new FormData;c.append("id",String(i.currentAccId)),c.append("userId",String(i.currentConId)),c.append("note",ie.value.nickname),Tl(c).then(s=>{Fe.success("设置用户备注成功"),m.updateRemark({currentAccId:i.currentAccId,userId:i.currentConId,remark:ie.value.nickname})}).catch(s=>{})}const q=n(!1),W=n("");function b(c){q.value=!0,W.value=c,Q()}const ue=n([{value:0,label:"快捷消息分组"}]);function Q(){Ol({type:2}).then(s=>{try{ue.value=s.data.data.data.map(G=>({value:G.id,label:G.name})),ue.value.unshift({value:0,label:"快捷消息分组"})}catch{}}).catch(s=>{})}const ae=n();function ve(){j.value=!0,Kl({GroupId:0,pageNum:1,pageSize:1e3}).then(s=>{try{ae.value=s.data.data.data.map(G=>new gr(G.id,G.useNum,G.msg))}catch{}}).catch(s=>{}).finally(()=>{j.value=!1})}function Z(c,s){var xe;o("quickMsg",c),Ql({id:s}).then(Ce=>{Ce.data}).catch(Ce=>{}),(xe=ae.value)==null||xe.forEach(Ce=>{Ce.id===s&&Ce.useNum++})}const le=n();function Ae(){Jl().then(c=>{try{le.value=c.data.data.data.map(s=>new vr(s.name))}catch{}}).catch(c=>{})}function ye(c){const s={currentAccId:i.currentAccId,userId:i.currentConId,label:c};m.updateLineMessageLabel(s);const G={Id:i.currentAccId,UserId:i.currentConId,Label:c};Zl(G).then(xe=>{Fe.success("打标签成功")}).catch(xe=>{})}const he=n([]);function oe(){const c={id:i.currentAccId,chat_id:i.currentGroId};Nl(c).then(s=>{try{he.value=s.data.data}catch{}}).catch(s=>{})}const C=n([]);function k(){const c={id:i.currentAccId};wt(c).then(s=>{try{C.value=s.data.data}catch{}}).catch(s=>{})}const se=n([]);function J(){Ot({GroupId:0}).then(s=>{try{se.value=s.data.data.data}catch{}}).catch(s=>{})}const P=n([]),X=c=>{P.value=c},re=Vt({phone:""}),$=n(),U=n([]),T=c=>{U.value=c};function N(){v.value=!0}function I(){const c=re.phone.split(/\r?\n/),s=[];c.forEach(Ce=>{const De=Ce.trim();De!==""&&s.push(De)});const G=U.value.map(Ce=>({userId:Ce.userId,userHash:Ce.accessHash})),xe={id:i.currentAccId,chat_id:i.currentGroId,phones:s,values:G};Vl(xe).then(Ce=>{Ce.data,Fe.success("新增群成员成功"),oe()}).catch(Ce=>{}),g()}function g(){re.phone="",v.value=!1,U.value=[],$.value.clearSelection()}const ne=n(!1),Y=n(),we=n(),Me=n();function be(c){ne.value=!0,Y.value=c.userId,we.value=c.userHash,Me.value=c.userName}function He(){const c={id:i.currentAccId,chatId:i.currentGroId,userId:Y.value,userHash:we.value};Ul(c).then(s=>{s.data,Fe.success("踢人成功"),oe()}).catch(s=>{}),Te()}function Te(){ne.value=!1}const Ge=n(!1),Re=n({title:""}),F=n(),A=n([]);function R(c,s){F.value.clearFiles(),A.value=[]}const K=c=>{},w=(c,s)=>{const G=c.raw;["image/jpeg","image/png","image/gif","image/bmp","image/tiff","image/webp"].includes(G.type)||(Fe({message:"文件类型错误,请上传图片文件",type:"error"}),F.value.clearFiles()),A.value.push(G)};function f(){Ge.value=!0}function O(){const c=new FormData;A.value.forEach(s=>{s instanceof File&&c.append("photo",s)}),c.append("id",String(i.currentAccId)),c.append("chatId",String(i.currentGroId)),c.append("title",String(Re.value.title)),Rl(c).then(s=>{s.data,Fe.success("修改成功"),o("updateGroupName")}).catch(s=>{Fe.error("修改失败")}),_e()}function _e(){Ge.value=!1,Re.value.title="",A.value=[]}return ot(()=>{ve(),Ae()}),(c,s)=>{const G=Xl,xe=mt,Ce=ht,De=ft,Pe=Ct,z=kt,D=Wt,pe=tt,d=ut,Se=vt,V=Ht,Le=qt,ke=Ke,Qe=Xe,st=Jt,_t=ct;return a(),u(Ie,null,[e("div",_r,[e("div",Ir,[e("div",br,[e("div",xr,[e("div",wr,[l(t(S),{icon:"icon-park:setting",class:"mr-2",style:{"font-size":"18px"}}),s[15]||(s[15]=e("span",null,"账号设置",-1))]),e("div",Cr,[s[16]||(s[16]=e("span",{class:"text-slate-700 text-sm"},"自动回复",-1)),l(G,{modelValue:t(L),"onUpdate:modelValue":s[0]||(s[0]=ee=>Ve(L)?L.value=ee:null),disabled:i.activeAcc==-1,class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"是","inactive-text":"否",onChange:ce},null,8,["modelValue","disabled"])])]),e("div",null,[i.activeAcc==-1?(a(),fe(Ce,{key:0,class:"box-item",effect:"dark",content:"请先选择账户",placement:"left"},{default:r(()=>[l(xe,{placeholder:"翻译语言",size:"large",disabled:i.activeAcc==-1,filterable:""},null,8,["disabled"])]),_:1})):(a(),fe(z,{key:1,ref:"ruleFormRef",model:t(ie),"status-icon":"","label-width":"auto",class:"demo-ruleForm w-11/12 mt-2 mx-2"},{default:r(()=>[l(Pe,{label:"设置翻译",prop:"translate"},{default:r(()=>[l(xe,{modelValue:t(x),"onUpdate:modelValue":s[1]||(s[1]=ee=>Ve(x)?x.value=ee:null),placeholder:"翻译语言",filterable:"",onChange:M},{default:r(()=>[(a(!0),u(Ie,null,$e(t(E),ee=>(a(),fe(De,{key:ee.language,label:ee.country,value:ee.language},{default:r(()=>[e("span",kr,_(ee.country),1),e("span",Ar,_(ee.language),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]))])]),e("div",Mr,[t(y)?(a(),u("div",$r,[e("div",jr,[l(D,{type:"warning",effect:"dark"},{default:r(()=>s[17]||(s[17]=[B("请先选择联系人 / 群组")])),_:1})])])):me("",!0),p.currentGroId!=-1?(a(),u("div",Sr,[e("div",Dr,[e("div",Lr,[l(t(S),{class:"mr-2",icon:"ic:round-group",style:{"font-size":"24px"}}),s[18]||(s[18]=e("span",null,"群成员管理",-1))]),e("div",Tr,[e("div",{class:"w-8 px-1 ml-2 rounded-md",onClick:f},[l(t(S),{icon:"ep:tools",class:"text-sky-500 cursor-pointer",style:{"font-size":"22px"}})]),e("div",{class:"w-8 px-1 rounded-md",onClick:N},[l(t(S),{icon:"icon-park-solid:add-one",class:"mr-2 text-sky-500 cursor-pointer",style:{"font-size":"22px"}})])])]),l(pe,{always:"",style:{height:"32vh"}},{default:r(()=>[(a(!0),u(Ie,null,$e(t(he),(ee,de)=>(a(),u("div",{key:de,class:ge(["h-10 w-full mb-2 rounded-md flex items-center",{"bg-border":ee.adminRights}]),style:{"border-bottom":"1px solid #388df8"}},[e("div",Nr,[e("div",Vr,_(ee.userName),1),e("div",Ur,[l(D,{effect:"dark",type:"primary"},{default:r(()=>[B(_(ee.phone),1)]),_:2},1024)])]),e("div",Rr,[l(t(S),{icon:"icon-park:delete-two",class:"mr-2 cursor-pointer",style:{"font-size":"22px"},onClick:Ee=>be(ee)},null,8,["onClick"])])],2))),128))]),_:1})])):(a(),u("div",Gr,[e("div",Er,[e("div",Fr,[l(t(S),{icon:"fluent-mdl2:contact-card-settings",class:"mr-2",style:{"font-size":"18px"}}),s[19]||(s[19]=B("联系人设置 "))]),e("div",null,[l(z,{ref:"ruleFormRef",model:t(ie),"status-icon":"","label-width":"auto",class:"demo-ruleForm w-11/12 mt-2 mx-2",onSubmit:s[4]||(s[4]=Ze(()=>{},["prevent"]))},{default:r(()=>[l(Pe,{label:"设置备注",prop:"types"},{default:r(()=>[l(d,{modelValue:t(ie).nickname,"onUpdate:modelValue":s[2]||(s[2]=ee=>t(ie).nickname=ee),type:"text",autocomplete:"off",onBlur:H,onKeydown:s[3]||(s[3]=it(Ze(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),e("div",zr,[e("div",Pr,[l(t(S),{icon:"fluent-emoji:label",class:"mr-2",style:{"font-size":"18px"}}),s[20]||(s[20]=B("联系人标签 "))]),l(pe,{always:"",style:{height:"22vh"}},{default:r(()=>[e("div",Br,[(a(!0),u(Ie,null,$e(t(le),(ee,de)=>(a(),u("div",{key:de,class:"inline-block text-white text-xs mx-1 px-2 py-1 my-1 rounded-md shadow-md hover:bg-sky-500 transition-colors duration-300 cursor-pointer",style:Je([{border:"1px solid #ccc",display:"inline-block"},{backgroundColor:ee.color}]),onClick:Ee=>ye(ee.name)},_(ee.name),13,Hr))),128))])]),_:1})])])),e("div",qr,[e("div",Or,[e("div",Kr,[l(t(S),{icon:"icon-park:text-message",class:"mr-2",style:{"font-size":"18px"}}),s[21]||(s[21]=B(" 快捷消息 ")),s[22]||(s[22]=e("span",{class:"ml-1 text-red-400",style:{"font-size":"10px"}},"(双击发送消息)",-1))]),e("div",{onClick:s[5]||(s[5]=ee=>b("add"))},[l(t(S),{icon:"icon-park-solid:add-one",class:"text-sky-500 cursor-pointer",style:{"font-size":"26px"}})])]),ze((a(),fe(pe,{always:"",style:{height:"22vh"}},{default:r(()=>[e("div",Jr,[(a(!0),u(Ie,null,$e(t(ae),(ee,de)=>(a(),u("div",{key:de,class:"inline-block text-white text-xs mx-1 px-2 py-1 my-1 rounded-md shadow-md hover:bg-sky-500 transition-colors duration-300 cursor-pointer hover:scale-95 relative",style:Je([{border:"1px solid #ccc",display:"inline-block"},{backgroundColor:ee.color}]),onDblclick:Ee=>Z(ee.msg,ee.id)},[l(Se,{value:ee.useNum,offset:[3,-1]},{default:r(()=>[B(_(ee.msg),1)]),_:2},1032,["value"])],44,Wr))),128))])]),_:1})),[[_t,t(j)]])])])])]),l(Qe,{modelValue:t(v),"onUpdate:modelValue":s[7]||(s[7]=ee=>Ve(v)?v.value=ee:null),title:c.$t("im.addContant.addContact"),width:"700"},{footer:r(()=>[l(ke,{onClick:g},{default:r(()=>[B(_(c.$t("btn.cancel")),1)]),_:1}),l(ke,{type:"primary",onClick:I},{default:r(()=>[B(_(c.$t("btn.confirm")),1)]),_:1})]),default:r(()=>[e("div",null,[e("div",Qr,[s[23]||(s[23]=e("div",{class:"font-bold mb-2"},"邀请联系人",-1)),l(d,{modelValue:t(re).phone,"onUpdate:modelValue":s[6]||(s[6]=ee=>t(re).phone=ee),rows:7,type:"textarea",placeholder:"注：每行一个联系人信息",autocomplete:"off"},null,8,["modelValue"])]),e("div",Zr,[e("div",Xr,[s[25]||(s[25]=e("div",{class:"font-bold mb-2"},"联系人列表",-1)),l(Le,{"show-header":!1,ref_key:"conListRef",ref:$,data:t(C),style:{width:"100%",height:"300px"},onSelectionChange:T},{default:r(()=>[l(V,{type:"selection",width:"55"}),l(V,null,{default:r(ee=>[B(" 昵称："+_(ee.row.firstName)+" ",1),s[24]||(s[24]=e("br",null,null,-1)),B(" 号码："+_(ee.row.phone),1)]),_:1})]),_:1},8,["data"])]),e("div",Yr,[s[27]||(s[27]=e("div",{class:"font-bold mb-2"},"联系人素材",-1)),l(Le,{"show-header":!1,data:t(se),style:{width:"100%",height:"300px"},onSelectionChange:X},{default:r(()=>[l(V,{type:"selection",width:"55"}),l(V,null,{default:r(ee=>[B(" 昵称："+_(ee.row.userName)+" ",1),s[26]||(s[26]=e("br",null,null,-1)),B(" 号码："+_(ee.row.phone),1)]),_:1})]),_:1},8,["data"])])])])]),_:1},8,["modelValue","title"]),l(Qe,{modelValue:t(ne),"onUpdate:modelValue":s[8]||(s[8]=ee=>Ve(ne)?ne.value=ee:null),title:"移除群成员",width:"500"},{footer:r(()=>[e("div",tc,[l(ke,{onClick:Te},{default:r(()=>s[28]||(s[28]=[B("Cancel")])),_:1}),l(ke,{type:"danger",onClick:He},{default:r(()=>s[29]||(s[29]=[B("确认移除")])),_:1})])]),default:r(()=>[e("div",ec,[l(t(S),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),e("span",null,_(`确认移除群成员：${t(Me)}`),1)])]),_:1},8,["modelValue"]),l(Qe,{modelValue:t(Ge),"onUpdate:modelValue":s[10]||(s[10]=ee=>Ve(Ge)?Ge.value=ee:null),title:"修改群信息",width:"500"},{footer:r(()=>[e("div",lc,[l(ke,{onClick:_e},{default:r(()=>s[31]||(s[31]=[B("Cancel")])),_:1}),l(ke,{type:"primary",onClick:O},{default:r(()=>s[32]||(s[32]=[B("确认修改")])),_:1})])]),default:r(()=>[l(z,{model:t(Re),"label-position":"right","label-width":"auto",style:{"max-width":"600px"}},{default:r(()=>[l(Pe,{label:"群标题","label-position":"right"},{default:r(()=>[l(d,{modelValue:t(Re).title,"onUpdate:modelValue":s[9]||(s[9]=ee=>t(Re).title=ee)},null,8,["modelValue"])]),_:1}),l(Pe,{label:"群头像","label-position":"right"},{default:r(()=>[l(st,{ref_key:"uploadRef",ref:F,class:"upload-demo","file-list":t(A),"auto-upload":!1,"on-preview":K,"on-remove":R,"on-change":w,multiple:!0,limit:10,drag:"",style:{width:"420px"}},{default:r(()=>[l(t(S),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),s[30]||(s[30]=e("div",{class:"el-upload__text"},[B(" 请"),e("em",null,"点击或拖拽"),B("上传图片 ")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Yl,{show:t(q),formType:t(W),groupOptions:t(ue),"onUp:show":s[11]||(s[11]=ee=>q.value=ee),"onUp:formType":s[12]||(s[12]=ee=>W.value=ee),"onUp:speech":ve,"onUp:loading":s[13]||(s[13]=ee=>j.value=ee)},null,8,["show","formType","groupOptions"]),l(yr,{show:t(te),autoReply:t(L),currentAccId:p.currentAccId,"onUpdate:show":s[14]||(s[14]=ee=>te.value=ee)},null,8,["show","autoReply","currentAccId"])],64)}}}),sc=We(oc,[["__scopeId","data-v-62c05b27"]]),nc={class:"grid grid-cols-10 gap-4"},ac=Be({__name:"im",setup(p){const h=n(-1),i=n(-1),o=n(),m=n(),y=n(!1),v=n(!1);function j(oe,C,k){h.value=oe,i.value=C,y.value=k.automaticReply,m.value=k.accountName,o.value=E.value.find(se=>se.id===h.value)}const E=n([]);function x(oe){E.value=oe}const M=n(-1),L=n();function te(oe,C){M.value=oe,L.value=C}const ce=n(-1),ie=n();function H(oe,C){ce.value=oe,ie.value=C}function q(){M.value=-1,L.value=void 0}function W(){ce.value=-1}const b=n("");function ue(oe){b.value=oe}const Q=n();function ae(oe){Q.value.quickMsg(oe)}const ve=n();function Z(){ve.value.getAllContantList()}const le=n("");function Ae(oe){le.value=oe}const ye=n("");function he(oe){ye.value=oe}return(oe,C)=>(a(),u("div",nc,[l(Eo,{currentConId:t(M),currentGroId:t(ce),upAutoReply:t(v),onAccountId:j,onLoginError:ue,onAccountList:x},null,8,["currentConId","currentGroId","upAutoReply"]),l(Mn,{ref_key:"contactAndGroupRef",ref:ve,currentAccId:t(h),loginError:t(b),onContactId:te,onGroupId:H,onCurrCom:Ae,onCurrSelectTab:he},null,8,["currentAccId","loginError"]),l(mr,{ref_key:"chatRoomRef",ref:Q,currentAccId:t(h),currentConId:t(M),currentGroId:t(ce),currentUsername:t(L),currentTitle:t(ie),currentAccName:t(m),currComs:t(le),currSelTab:t(ye),onClearContactId:q,onClearGroupId:W},null,8,["currentAccId","currentConId","currentGroId","currentUsername","currentTitle","currentAccName","currComs","currSelTab"]),l(sc,{activeAcc:t(i),currentAccId:t(h),currentConId:t(M),currentGroId:t(ce),currentAcc:t(o),autoReply:t(y),onQuickMsg:ae,onUpdateGroupName:Z,"onUp:autoReply":C[0]||(C[0]=k=>v.value=k)},null,8,["activeAcc","currentAccId","currentConId","currentGroId","currentAcc","autoReply"])]))}}),zc=We(ac,[["__scopeId","data-v-727d4f98"]]);export{zc as default};
