import{d as X,z as $,t as b,c as ee,b as w,Y as r,a4 as a,i as s,e as l,J as I,o as c,Z as _,h as S,a0 as le,a3 as A,$ as V,n as L,H as F,I as T,aa as C}from"./index-2a2bri-d.js";import{b as te,c as ae,e as ne}from"./el-select-Dz2KJnwc.js";import{E as oe,a as se}from"./el-form-item-DzHjpJCN.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ie}from"./el-scrollbar-CXPZY7Bs.js";/* empty css                        */import{E as re,a as de}from"./el-button-D_fjb_vJ.js";import{E as ue}from"./el-input-DOfSdrh_.js";import"./el-tag-BySgfF3p.js";import{I as x}from"./iconify-BO38E5Xh.js";import{b as pe}from"./account-BYfcswwO.js";import{_ as ce,s as me}from"./el-step-DN_0vMak.js";import{a as B}from"./account.StatusEnum-CqjSWtZY.js";import{g as fe,i as j}from"./utils-DaTdCYcK.js";const ve={style:{float:"left"}},ge={style:{float:"right"}},xe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},ye={class:"flex justify-between"},be={class:"flex justify-center items-center"},he={class:"w-full"},we={class:"w-full"},_e={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},ke=["onClick"],Ie={class:"w-full"},Se={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},Ve=["onClick"],Ce={class:"dialog-footer"},qe=X({__name:"oneClickG",props:{currentAccId:{type:Number,required:!1},show:{type:Boolean,required:!0},multipleSelect:{type:Array,required:!1},oneClickGList:{type:Array,required:!1}},emits:["up:show","up:success"],setup(q,{emit:O}){const d=q,z=O;$(()=>d.show,()=>{H();let u=0;d.multipleSelect&&(u=d.multipleSelect.length),d.oneClickGList&&(u=d.oneClickGList.length),o.value.maxSendNumber=u}),$(()=>d.currentAccId,()=>{d.currentAccId!==-1&&d.currentAccId!==void 0&&(o.value.id=d.currentAccId)});const M=b(!1),E=b([]);function H(){M.value=!0,pe().then(u=>{try{E.value=u.data.data.data.map(e=>({status:e.account.status,value:e.account.id,label:e.account.nickName,phone:e.account.phone})),console.log("账号列表",E.value)}catch(e){console.log(e)}}).catch(u=>{console.log("获取账号列表失败",u)}).finally(()=>{M.value=!1})}function J(u){console.log("校验",u),u.status!=B.Online&&(C.error("该账号未登录"),o.value.id=0)}const o=b({id:0,maxSendNumber:0,remark:`群发任务(${fe(new Date)})`,msg:"",minIntervalTime:5,maxIntervalTime:10}),P=ee(()=>!0);function Y(){if(o.value.id<=0){C.error("请选择账号");return}let u=[],e=[],v=[],g=[];d.multipleSelect&&(u=d.multipleSelect.filter(t=>t.phone!=null).map(t=>t.phone)),d.oneClickGList&&d.oneClickGList.forEach(t=>{t.groupId===0?e.push(String(t.userId)):v.push(String(t.groupId))}),d.multipleSelect&&(g=d.multipleSelect.filter(t=>t.mainName!=null).map(t=>t.mainName)),console.log("xxxx",g);const i=new FormData;u.length!=0&&u.forEach(t=>{i.append("phones",t)}),e.length!=0&&e.forEach(t=>{i.append("users",t)}),v.length!=0&&v.forEach(t=>{i.append("chats",t)}),g.length!=0&&g.forEach(t=>{i.append("userLinks",t)}),i.append("id",String(o.value.id)),i.append("maxSendNumber",String(o.value.maxSendNumber)),i.append("remark",o.value.remark),i.append("msg",o.value.msg),i.append("minIntervalTime",String(o.value.minIntervalTime)),i.append("maxIntervalTime",String(o.value.maxIntervalTime)),p.value&&p.value.forEach(t=>{i.append("files.UrlFiles",t)}),f.value&&f.value.forEach(t=>{i.append("files.UrlFileTypes",t)}),me(i).then(t=>{console.log("群发成功",t.data),C.success("群发成功")}).catch(t=>{console.log("群发失败",t),C.error("群发失败")}),N()}function N(){z("up:show",!1),z("up:success"),k.value=!1,o.value={id:0,maxSendNumber:0,remark:"",msg:"",minIntervalTime:5,maxIntervalTime:10},p.value=[],f.value=[],d.currentAccId!==-1&&d.currentAccId!=null&&(o.value.id=d.currentAccId)}const m=b("sendMsg"),k=b(!1);function U(){k.value=!0}const p=b([]),f=b([]);function Z(u,e,v,g){k.value=u,v.length>0&&g.length>0&&(Array.isArray(p.value)||(p.value=[]),Array.isArray(f.value)||(f.value=[]),p.value=[...p.value,...v],f.value=[...f.value,...g])}function G(u){p.value&&f.value&&(p.value.splice(u,1),f.value.splice(u,1))}return(u,e)=>{const v=ae,g=ne,i=oe,t=ue,y=re,K=de,D=ie,Q=se,R=te;return c(),w(I,null,[r("div",null,[a(R,{modelValue:d.show,"onUpdate:modelValue":e[10]||(e[10]=n=>d.show=n),title:"一键群发",width:"600",onClose:N},{footer:s(()=>[r("div",Ce,[a(y,{onClick:N},{default:s(()=>e[20]||(e[20]=[_("Cancel")])),_:1}),a(y,{type:"primary",onClick:Y},{default:s(()=>e[21]||(e[21]=[_("发送消息")])),_:1})])]),default:s(()=>[a(Q,{model:l(o),class:"demo-form-inline",style:{"max-width":"600px"}},{default:s(()=>[a(i,{label:"选择账号","label-width":"100px"},{default:s(()=>[a(g,{modelValue:l(o).id,"onUpdate:modelValue":e[0]||(e[0]=n=>l(o).id=n),placeholder:"选择账号",clearable:"",filterable:""},{default:s(()=>[l(P)?(c(),S(v,{key:0,label:"选择账号",value:0})):le("",!0),(c(!0),w(I,null,A(l(E),n=>(c(),S(v,{key:n.value,label:n.label,value:n.value,onClick:h=>J(n)},{default:s(()=>[r("span",ve,V(n.label),1),r("span",ge,[n.status===l(B).Online?(c(),S(l(x),{key:0,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-green-600"})):(c(),S(l(x),{key:1,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-red-600"}))]),r("span",xe,V(n.phone),1)]),_:2},1032,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"最大发送人数","label-width":"100px"},{default:s(()=>[a(t,{modelValue:l(o).maxSendNumber,"onUpdate:modelValue":e[1]||(e[1]=n=>l(o).maxSendNumber=n),placeholder:"请输入最大发送人数",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"消息间隔时间（随机）","label-width":"180px"},{default:s(()=>[r("div",ye,[a(t,{modelValue:l(o).minIntervalTime,"onUpdate:modelValue":e[2]||(e[2]=n=>l(o).minIntervalTime=n),placeholder:"请输入间隔最小时间",clearable:"",style:{width:"150px"}},null,8,["modelValue"]),e[11]||(e[11]=r("span",{class:"mx-2"}," 秒~",-1)),a(t,{modelValue:l(o).maxIntervalTime,"onUpdate:modelValue":e[3]||(e[3]=n=>l(o).maxIntervalTime=n),placeholder:"请输入间隔最大时间",clearable:"",style:{width:"150px"}},null,8,["modelValue"]),e[12]||(e[12]=r("span",{class:"mx-2"}," 秒",-1))])]),_:1}),a(i,{label:"任务备注","label-width":"100px"},{default:s(()=>[a(t,{modelValue:l(o).remark,"onUpdate:modelValue":e[4]||(e[4]=n=>l(o).remark=n),clearable:""},null,8,["modelValue"])]),_:1}),r("div",be,[a(K,{class:"w-3/5 mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:s(()=>[a(y,{class:L(["w-1/3",{active:l(m)==="sendMsg"}]),type:"primary",plain:"",onClick:e[5]||(e[5]=n=>m.value="sendMsg")},{default:s(()=>e[13]||(e[13]=[_(" 消息内容 ")])),_:1},8,["class"]),a(y,{class:L(["w-1/3",{active:l(m)==="sendFile"}]),type:"primary",plain:"",onClick:e[6]||(e[6]=n=>m.value="sendFile")},{default:s(()=>e[14]||(e[14]=[_(" 消息文件 ")])),_:1},8,["class"]),a(y,{class:L(["w-1/3",{active:l(m)==="sendFoM"}]),type:"primary",plain:"",onClick:e[7]||(e[7]=n=>m.value="sendFoM")},{default:s(()=>e[15]||(e[15]=[_(" 消息内容 + 文件 ")])),_:1},8,["class"])]),_:1})]),F(r("div",he,[a(i,{label:"消息内容","label-width":"100px"},{default:s(()=>[a(t,{modelValue:l(o).msg,"onUpdate:modelValue":e[8]||(e[8]=n=>l(o).msg=n),rows:4,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1})],512),[[T,l(m)==="sendMsg"]]),F(r("div",we,[a(i,{label:"选择文件","label-width":"100px"},{default:s(()=>[r("div",null,[a(y,{type:"primary",plain:"",onClick:U},{default:s(()=>[a(l(x),{icon:"line-md:file-import-filled",style:{"font-size":"22px"}}),e[16]||(e[16]=r("span",{class:"hidden lg:inline-block ml-2"},"选择文件",-1)),e[17]||(e[17]=r("span",{class:"hidden md:inline-block lg:hidden ml-2"},"选择文件",-1))]),_:1}),(c(!0),w(I,null,A(l(p),(n,h)=>(c(),w("div",{key:h,class:"flex items-center justify-between w-80",style:{border:"1px dashed #ccc"}},[a(l(x),{icon:"bxs:file",style:{"font-size":"22px"}}),a(D,{class:"box-item",effect:"dark",content:n,placement:"top"},{default:s(()=>[r("span",_e,V(l(j)(n)),1)]),_:2},1032,["content"]),r("span",{type:"danger",plain:"",onClick:W=>G(h)},[a(l(x),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,ke)]))),128))])]),_:1})],512),[[T,l(m)==="sendFile"]]),F(r("div",Ie,[a(i,{label:"消息内容","label-width":"100px"},{default:s(()=>[a(t,{modelValue:l(o).msg,"onUpdate:modelValue":e[9]||(e[9]=n=>l(o).msg=n),rows:4,type:"textarea",clearable:""},null,8,["modelValue"])]),_:1}),a(i,{label:"选择文件","label-width":"100px"},{default:s(()=>[r("div",null,[a(y,{type:"primary",plain:"",onClick:U},{default:s(()=>[a(l(x),{icon:"line-md:file-import-filled",style:{"font-size":"22px"}}),e[18]||(e[18]=r("span",{class:"hidden lg:inline-block ml-2"},"选择文件",-1)),e[19]||(e[19]=r("span",{class:"hidden md:inline-block lg:hidden ml-2"},"选择文件",-1))]),_:1}),(c(!0),w(I,null,A(l(p),(n,h)=>(c(),w("div",{key:h,class:"flex items-center justify-between w-80",style:{border:"1px dashed #ccc"}},[a(l(x),{icon:"bxs:file",style:{"font-size":"22px"}}),a(D,{class:"box-item",effect:"dark",content:n,placement:"top"},{default:s(()=>[r("span",Se,V(l(j)(n)),1)]),_:2},1032,["content"]),r("span",{type:"danger",plain:"",onClick:W=>G(h)},[a(l(x),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,Ve)]))),128))])]),_:1})],512),[[T,l(m)==="sendFoM"]])]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(ce,{show:l(k),isLocal:!1,onDeliver:Z},null,8,["show"])],64)}}});export{qe as _};
