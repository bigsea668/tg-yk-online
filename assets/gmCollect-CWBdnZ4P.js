import{d as ce,t as r,b as B,Y as i,a4 as a,i as n,e as t,Z as d,H as D,h as m,a9 as fe,J as M,o as p,a3 as R,$ as y,a0 as J,aa as _,D as H}from"./index-2a2bri-d.js";import{e as ve,v as ye,c as ge}from"./el-select-Dz2KJnwc.js";import{a as ke,E as be}from"./el-table-column-BN4sCq-k.js";import"./el-checkbox-CMe2Q5Jf.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-CXPZY7Bs.js";import{E as he}from"./el-link-BO8FGk0Q.js";import"./el-tag-BySgfF3p.js";import{a as _e,E as we}from"./el-form-item-DzHjpJCN.js";import{E as xe}from"./el-button-D_fjb_vJ.js";import{E as Ce}from"./el-switch-BmvWbz2I.js";import{E as Ne}from"./el-input-DOfSdrh_.js";import{I as f}from"./iconify-BO38E5Xh.js";import{g as Ee,b as ze,c as Le}from"./el-step-DN_0vMak.js";import{r as Te}from"./material-CaO01XEC.js";import{b as $e}from"./account-BYfcswwO.js";import{e as Q,c as Ve}from"./utils-DaTdCYcK.js";import{t as Se}from"./task.StatusEnum-DkKhLcsQ.js";import{a as P}from"./account.StatusEnum-CqjSWtZY.js";import{_ as Ue,a as Ie}from"./phoneSend.vue_vue_type_script_setup_true_lang-Dt25D4YH.js";import{_ as Ae}from"./oneClickG.vue_vue_type_script_setup_true_lang-C539e8t4.js";import{E as Be}from"./index-rGSOovlF.js";import"./refs-CTMQh0bL.js";import"./index-3_ES5SxW.js";import"./_Uint8Array-BA5rhpUc.js";import"./_initCloneObject-BSnmcygP.js";import"./validator-ngAJDs0Q.js";import"./el-upload-DvftR1ML.js";/* empty css                        */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./accountList.vue_vue_type_script_setup_true_lang-BLpQhr_P.js";import"./im-DDAOu1MQ.js";const De={class:"bg-white rounded-md p-4 mb-2 mt-1"},Me={style:{float:"left"}},je={style:{float:"right"}},Fe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Ge={class:"bg-white rounded-md p-4",style:{height:"81vh"}},Oe={class:"pb-2 flex justify-between",style:{"border-bottom":"1px dashed #ccc"}},Re={style:{float:"left"}},Je={class:"ml-6",style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},He={class:"mt-4"},Qe={class:"flex justify-center items-center mb-4 py-2"},Pe={class:"mr-4"},Ye={class:"mr-4"},Ze={class:"mr-4"},qe={class:""},$l=ce({__name:"gmCollect",setup(Ke){const b=r(!1),T=r(!1),$=r(!1),w="https://t.me/",j=r([]);function Y(){T.value=!0,$e().then(o=>{try{j.value=o.data.data.data.map(e=>({status:e.account.status,value:e.account.id,label:e.account.nickName,phone:e.account.phone}))}catch(e){console.log(e)}}).catch(o=>{console.log("获取账号列表失败",o)}).finally(()=>{T.value=!1})}const N=r([]),V=r(),x=r(),C=r(),c=r({accountId:"",groupLink:"https://t.me/demoTestOpen",join:!1});function Z(o){console.log("校验",o),o.status!=P.Online&&(_.error("该账号未登录"),c.value.accountId="")}const q=()=>{b.value=!0;const o={id:c.value.accountId,group_url:c.value.groupLink,join:c.value.join};ze(o).then(e=>{try{V.value=e.data.data.isChannel,x.value=e.data.data.mainUsername,C.value=e.data.data.title,N.value=e.data.data.taskGatherGroupMembers,_({message:H("p",{style:"line-height: 1; font-size: 14px"},[H("span",null,`${e.data.message}`)])})}catch(s){console.log(s)}}).catch(e=>{console.log("采集群成员失败",e),_.error("采集失败")}).finally(()=>{b.value=!1}),E.value=""},K=r(),h=r([]),W=o=>{h.value=o};function X(o){Ve(w,o)}const F=r([]),E=r();function ee(){$.value=!0;const o={taskType:Se.GatherGroupMembers};Ee(o).then(e=>{try{F.value=e.data.data.map(s=>({id:s.id,name:s.name,type:s.type,userId:s.userId,status:s.status,createTime:s.createTime,endTime:s.endTime,totalMumberTasks:s.totalMumberTask,completedQuantity:s.completedQuantity,task_data:s.task_data?JSON.parse(s.task_data):null,userNameURL:s.task_data?w+JSON.parse(s.task_data).MainUsername:null}))}catch(s){console.log(s)}}).catch(e=>{console.log("获取任务失败",e)}).finally(()=>{$.value=!1}),c.value.accountId=""}function le(o){V.value=o.task_data?o.task_data.IsChannel:"",x.value=o.task_data?o.task_data.MainUsername:"",C.value=o.task_data?o.task_data.Title:"",b.value=!0;const e={id:o.id};Le(e).then(s=>{try{_.success("获取任务详情成功"),N.value=s.data.data}catch(u){console.log(u)}}).catch(s=>{console.log("获取任务详情失败",s),_.error("获取任务详情失败")}).finally(()=>{b.value=!1})}function te(){const o=h.value.map(u=>({userName:u.userName,phone:u.phone,isActive:u.isActive,isBot:u.isBot,mainName:`${w}${u.mainName}`})),e={userName:"昵称",phone:"电话号",isActive:"是否活跃",isBot:"是否机器人",mainName:"用户链接"},s=`群采集数据-${C.value}-${x.value}`;Q(o,s,e)}function ae(){const o=N.value.map(u=>({userName:u.userName,phone:u.phone,isActive:u.isActive,isBot:u.isBot,mainName:`${w}${u.mainName}`})),e={userName:"昵称",phone:"电话号",isActive:"是否活跃",isBot:"是否机器人",mainName:"用户链接"},s=`群采集数据-${C.value}-${x.value}`;Q(o,s,e)}const S=r(!1);function oe(){S.value=!0}const U=r(!1);function se(){U.value=!0}const I=r(!1),G=r(""),O=r("");function ne(o){I.value=!0,o.phone?G.value=o.phone:O.value=`@${o.mainName}`}function ie(o){const e=new FormData;e.append("phones",o.phone),e.append("group_id",String(0)),e.append("remarks","从群采集添加的联系人素材"),Te(e).then(s=>{_.success("新增到素材成功")}).catch(s=>{console.log("新增到素材失败",s)}).finally(()=>{b.value=!1})}return(o,e)=>{const s=ge,u=ve,z=we,re=Ne,de=Ce,v=xe,ue=_e,g=Be,k=be,pe=he,me=ke,A=ye;return p(),B(M,null,[i("div",null,[i("div",De,[a(ue,{inline:!0,model:t(c),class:"demo-form-inline"},{default:n(()=>[a(z,{label:"选择账号"},{default:n(()=>[D((p(),m(u,{modelValue:t(c).accountId,"onUpdate:modelValue":e[0]||(e[0]=l=>t(c).accountId=l),placeholder:"选择账号",clearable:"",filterable:"",style:{width:"180px"},onClick:Y},{default:n(()=>[(p(!0),B(M,null,R(t(j),l=>(p(),m(s,{key:l.value,label:l.label,value:l.value,onClick:L=>Z(l)},{default:n(()=>[i("span",Me,y(l.label),1),i("span",je,[l.status===t(P).Online?(p(),m(t(f),{key:0,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-green-600"})):(p(),m(t(f),{key:1,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-red-600"}))]),i("span",Fe,y(l.phone),1)]),_:2},1032,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])),[[A,t(T)]])]),_:1}),a(z,{label:"群链接"},{default:n(()=>[a(re,{modelValue:t(c).groupLink,"onUpdate:modelValue":e[1]||(e[1]=l=>t(c).groupLink=l),placeholder:"请输入群链接",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(z,null,{default:n(()=>[a(de,{modelValue:t(c).join,"onUpdate:modelValue":e[2]||(e[2]=l=>t(c).join=l),size:"large","active-text":"加入群","inactive-text":"不加入群"},null,8,["modelValue"])]),_:1}),a(z,null,{default:n(()=>[a(v,{type:"primary",onClick:q},{default:n(()=>[a(t(f),{icon:"hugeicons:message-user-01",style:{"font-size":"22px"},class:"mr-2"}),e[7]||(e[7]=d(" 采集群成员 "))]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",Ge,[i("div",Oe,[i("div",null,[e[8]||(e[8]=d(" 查询历史采集任务数据 ")),D((p(),m(u,{modelValue:t(E),"onUpdate:modelValue":e[3]||(e[3]=l=>fe(E)?E.value=l:null),placeholder:"选择历史任务",clearable:"",filterable:"",style:{width:"180px"},class:"mr-2",onClick:ee},{default:n(()=>[(p(!0),B(M,null,R(t(F),l=>(p(),m(s,{key:l.id,label:l.name,value:l.id,onClick:L=>le(l)},{default:n(()=>[i("span",Re,y(l.name),1),i("span",Je,y(l==null?void 0:l.userNameURL),1)]),_:2},1032,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])),[[A,t($)]])]),i("div",null,[a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:oe,disabled:t(h).length===0},{default:n(()=>[a(t(f),{icon:"tabler:message-share",style:{"font-size":"22px"}}),e[9]||(e[9]=i("span",{class:"hidden lg:inline-block ml-2"},"一键群发",-1)),e[10]||(e[10]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"一键群发",-1))]),_:1},8,["disabled"]),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:se,disabled:t(h).length===0},{default:n(()=>[a(t(f),{icon:"fluent:contact-card-link-20-filled",style:{"font-size":"22px"}}),e[11]||(e[11]=i("span",{class:"hidden lg:inline-block ml-2"},"导入为联系人",-1)),e[12]||(e[12]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"导入为联系人",-1))]),_:1},8,["disabled"]),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:ae},{default:n(()=>[a(t(f),{icon:"material-symbols:file-export-rounded",style:{"font-size":"22px"}}),e[13]||(e[13]=i("span",{class:"hidden lg:inline-block ml-2"},"一键导出所有数据",-1)),e[14]||(e[14]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"一键导出所有数据",-1))]),_:1}),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:te},{default:n(()=>[a(t(f),{icon:"material-symbols:file-export-rounded",style:{"font-size":"22px"}}),e[15]||(e[15]=i("span",{class:"hidden lg:inline-block ml-2"},"导出选中数据",-1)),e[16]||(e[16]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"导出选中数据",-1))]),_:1})])]),i("div",He,[e[29]||(e[29]=i("div",{class:"mb-4 p-2 px-4 flex justify-between items-center",style:{"border-left":"5px solid #409eff"}},"群信息",-1)),i("div",Qe,[i("span",Pe,[e[17]||(e[17]=d("群标题 ")),a(g,{type:"primary",size:"large"},{default:n(()=>[d(y(t(C)),1)]),_:1})]),i("span",Ye,[e[18]||(e[18]=d("是否为频道 ")),a(g,{type:"primary",size:"large"},{default:n(()=>[d(y(t(V)),1)]),_:1})]),i("span",Ze,[e[19]||(e[19]=d("群名 ")),a(g,{type:"primary",size:"large"},{default:n(()=>[d(y(t(x)),1)]),_:1})])]),D((p(),m(me,{"element-loading-text":"正在采集群成员...",ref_key:"tableRef",ref:K,data:t(N),style:{width:"100%",height:"58vh"},border:"",onSelectionChange:W},{default:n(()=>[a(k,{type:"selection",width:"55"}),a(k,{prop:"userName",label:"名称"}),a(k,{prop:"phone",label:"手机号码"}),a(k,{prop:"isActive",label:"是否活跃",width:"100"},{default:n(l=>[l.row.isActive?(p(),m(g,{key:0,type:"success",size:"large"},{default:n(()=>e[20]||(e[20]=[d("活跃")])),_:1})):(p(),m(g,{key:1,type:"info",size:"large"},{default:n(()=>e[21]||(e[21]=[d("不活跃")])),_:1}))]),_:1}),a(k,{prop:"isBot",label:"是否为机器人",width:"120"},{default:n(l=>[l.row.isBot?(p(),m(g,{key:0,type:"success",size:"large"},{default:n(()=>e[22]||(e[22]=[d("是")])),_:1})):(p(),m(g,{key:1,type:"info",size:"large"},{default:n(()=>e[23]||(e[23]=[d("否")])),_:1}))]),_:1}),a(k,{prop:"mainName",label:"用户链接"},{default:n(l=>[i("div",qe,[a(pe,{type:"primary",href:`${t(w)}${l.row.mainName}`,target:"_blank"},{default:n(()=>[d(y(l.row.mainName),1)]),_:2},1032,["href"]),e[25]||(e[25]=i("br",null,null,-1)),a(v,{onClick:L=>X(l.row.mainName)},{default:n(()=>e[24]||(e[24]=[d("复制用户链接")])),_:2},1032,["onClick"])])]),_:1}),a(k,null,{header:n(()=>e[26]||(e[26]=[i("div",{class:"must"},[i("span",{class:"red"}),d("操作")],-1)])),default:n(l=>[l.row.phone||l.row.mainName?(p(),m(v,{key:0,size:"small",type:"primary",plain:"",onClick:L=>ne(l.row)},{default:n(()=>[a(t(f),{icon:"wpf:chat",style:{"font-size":"18px"},class:"mr-2"}),e[27]||(e[27]=d(" 私聊 "))]),_:2},1032,["onClick"])):J("",!0),l.row.phone?(p(),m(v,{key:1,size:"small",type:"success",plain:"",onClick:L=>ie(l.row)},{default:n(()=>[a(t(f),{icon:"wpf:chat",style:{"font-size":"18px"},class:"mr-2"}),e[28]||(e[28]=d(" 添到联系人素材 "))]),_:2},1032,["onClick"])):J("",!0)]),_:1})]),_:1},8,["data"])),[[A,t(b)]])])])]),a(Ae,{show:t(S),multipleSelect:t(h),"onUp:show":e[4]||(e[4]=l=>S.value=l)},null,8,["show","multipleSelect"]),a(Ue,{show:t(U),multipleSelect:t(h),"onUp:show":e[5]||(e[5]=l=>U.value=l)},null,8,["show","multipleSelect"]),a(Ie,{show:t(I),phone:t(G),mainName:t(O),"onUp:show":e[6]||(e[6]=l=>I.value=l)},null,8,["show","phone","mainName"])],64)}}});export{$l as default};
