var tl=Object.defineProperty;var ll=(p,h,i)=>h in p?tl(p,h,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[h]=i;var lt=(p,h,i)=>ll(p,typeof h!="symbol"?h+"":h,i);import{p as Dt,M as Lt,N as ol,ai as sl,F as nl,U as al,t as n,z as je,A as il,a as bt,c as Ue,d as Be,o as a,b as u,r as mt,n as me,e as t,_ as Tt,q as rl,x as cl,s as ul,Y as e,Z as q,$ as _,a4 as l,i as c,h as fe,a8 as dl,G as pl,au as it,ad as Ze,H as ze,I as dt,w as fl,g as gl,aD as ml,aE as et,aB as pt,B as ot,aF as Oe,J as be,a3 as $e,f as Je,a0 as ge,aG as vt,T as Nt,aH as rt,aI as at,aa as Fe,al as Ye,aJ as vl,a9 as Ve,V as nt,aK as hl,y as Vt}from"./index-2a2bri-d.js";import{v as ct,b as Xe,c as ft,e as gt}from"./el-select-Dz2KJnwc.js";import{E as Ut}from"./el-empty-CaAJ-98P.js";import{U as Rt,C as Gt,b as tt,E as ht}from"./el-scrollbar-CXPZY7Bs.js";import{E as ut}from"./el-input-DOfSdrh_.js";import{E as Ke,a as xt}from"./el-button-D_fjb_vJ.js";import{I as L}from"./iconify-BO38E5Xh.js";import{g as At}from"./account.StatusEnum-CqjSWtZY.js";import{g as yl,a as _l,d as Et,b as Ft,c as wt,e as Il,s as bl,f as xl,h as wl,i as zt,j as Pt,k as Cl,l as kl,m as Al,t as Ml,n as $l,o as jl,p as Sl,q as Dl,r as Ll,v as Tl,w as Nl,x as Vl,y as Ul,z as Rl}from"./im-DDAOu1MQ.js";import{c as Mt}from"./refs-CTMQh0bL.js";import{E as Gl}from"./index-pWt2P3Cb.js";import{f as El}from"./index-3_ES5SxW.js";import{_ as We}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css                        */import"./el-tooltip-l0sNRNKZ.js";import{E as Bt,a as Fl}from"./el-checkbox-CMe2Q5Jf.js";import{_ as zl}from"./oneClickG.vue_vue_type_script_setup_true_lang-C539e8t4.js";import{G as yt,f as $t}from"./utils-DaTdCYcK.js";import"./el-tag-BySgfF3p.js";import{E as Ht,a as qt}from"./el-table-column-BN4sCq-k.js";import{_ as Pl,E as Bl,a as Hl}from"./el-step-DN_0vMak.js";import{E as Ct,a as kt}from"./el-form-item-DzHjpJCN.js";import{a as Ot,b as ql,c as Kt,d as Ol,e as Kl,f as Jl,u as Wl,h as Ql,i as Zl}from"./material-CaO01XEC.js";import{E as Jt}from"./el-upload-DvftR1ML.js";import{E as Wt}from"./index-rGSOovlF.js";import{t as Qt}from"./translations-DaIsc1a6.js";import{E as Xl}from"./el-switch-BmvWbz2I.js";import{_ as Yl}from"./addSpeech.vue_vue_type_script_setup_true_lang-C-51sM3H.js";import"./_Uint8Array-BA5rhpUc.js";import"./account-BYfcswwO.js";import"./_initCloneObject-BSnmcygP.js";import"./validator-ngAJDs0Q.js";const jt=p=>sl(p)||nl(p)||al(p),eo=Dt({accordion:Boolean,modelValue:{type:Lt([Array,String,Number]),default:()=>ol([])}}),to={[Rt]:jt,[Gt]:jt},Zt=Symbol("collapseContextKey"),lo=(p,h)=>{const i=n(Mt(p.modelValue)),s=y=>{i.value=y;const v=p.accordion?i.value[0]:i.value;h(Rt,v),h(Gt,v)},g=y=>{if(p.accordion)s([i.value[0]===y?"":y]);else{const v=[...i.value],j=v.indexOf(y);j>-1?v.splice(j,1):v.push(y),s(v)}};return je(()=>p.modelValue,()=>i.value=Mt(p.modelValue),{deep:!0}),il(Zt,{activeNames:i,handleItemClick:g}),{activeNames:i,setActiveNames:s}},oo=()=>{const p=bt("collapse");return{rootKls:Ue(()=>p.b())}},so=Be({name:"ElCollapse"}),no=Be({...so,props:eo,emits:to,setup(p,{expose:h,emit:i}){const s=p,{activeNames:g,setActiveNames:y}=lo(s,i),{rootKls:v}=oo();return h({activeNames:g,setActiveNames:y}),(j,z)=>(a(),u("div",{class:me(t(v))},[mt(j.$slots,"default")],2))}});var ao=Tt(no,[["__file","collapse.vue"]]);const io=Dt({title:{type:String,default:""},name:{type:Lt([String,Number]),default:void 0},icon:{type:rl,default:cl},disabled:Boolean}),ro=p=>{const h=ul(Zt),{namespace:i}=bt("collapse"),s=n(!1),g=n(!1),y=El(),v=Ue(()=>y.current++),j=Ue(()=>{var le;return(le=p.name)!=null?le:`${i.value}-id-${y.prefix}-${t(v)}`}),z=Ue(()=>h==null?void 0:h.activeNames.value.includes(t(j)));return{focusing:s,id:v,isActive:z,handleFocus:()=>{setTimeout(()=>{g.value?g.value=!1:s.value=!0},50)},handleHeaderClick:()=>{p.disabled||(h==null||h.handleItemClick(t(j)),s.value=!1,g.value=!0)},handleEnterClick:()=>{h==null||h.handleItemClick(t(j))}}},co=(p,{focusing:h,isActive:i,id:s})=>{const g=bt("collapse"),y=Ue(()=>[g.b("item"),g.is("active",t(i)),g.is("disabled",p.disabled)]),v=Ue(()=>[g.be("item","header"),g.is("active",t(i)),{focusing:t(h)&&!p.disabled}]),j=Ue(()=>[g.be("item","arrow"),g.is("active",t(i))]),z=Ue(()=>g.be("item","wrap")),x=Ue(()=>g.be("item","content")),A=Ue(()=>g.b(`content-${t(s)}`)),T=Ue(()=>g.b(`head-${t(s)}`));return{arrowKls:j,headKls:v,rootKls:y,itemWrapperKls:z,itemContentKls:x,scopedContentId:A,scopedHeadId:T}},uo=Be({name:"ElCollapseItem"}),po=Be({...uo,props:io,setup(p,{expose:h}){const i=p,{focusing:s,id:g,isActive:y,handleFocus:v,handleHeaderClick:j,handleEnterClick:z}=ro(i),{arrowKls:x,headKls:A,rootKls:T,itemWrapperKls:le,itemContentKls:ue,scopedContentId:ie,scopedHeadId:O}=co(i,{focusing:s,isActive:y,id:g});return h({isActive:y}),(B,W)=>(a(),u("div",{class:me(t(T))},[e("button",{id:t(O),class:me(t(A)),"aria-expanded":t(y),"aria-controls":t(ie),"aria-describedby":t(ie),tabindex:B.disabled?-1:0,type:"button",onClick:t(j),onKeydown:it(Ze(t(z),["stop","prevent"]),["space","enter"]),onFocus:t(v),onBlur:b=>s.value=!1},[mt(B.$slots,"title",{},()=>[q(_(B.title),1)]),mt(B.$slots,"icon",{isActive:t(y)},()=>[l(t(pl),{class:me(t(x))},{default:c(()=>[(a(),fe(dl(B.icon)))]),_:1},8,["class"])])],42,["id","aria-expanded","aria-controls","aria-describedby","tabindex","onClick","onKeydown","onFocus","onBlur"]),l(t(Gl),null,{default:c(()=>[ze(e("div",{id:t(ie),role:"region",class:me(t(le)),"aria-hidden":!t(y),"aria-labelledby":t(O)},[e("div",{class:me(t(ue))},[mt(B.$slots,"default")],2)],10,["id","aria-hidden","aria-labelledby"]),[[dt,t(y)]])]),_:3})],2))}});var Xt=Tt(po,[["__file","collapse-item.vue"]]);const Yt=fl(ao,{CollapseItem:Xt}),el=gl(Xt),Ne=ml("im",{state:()=>({showReply:!1,index:0,accountsIdMap:[],lineState:[{currentAccId:0,userId:0,status:!1,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:0,gMessage:"",remark:""}]}),actions:{setReplyTrue(){this.showReply=!0},setReplyFalse(){this.showReply=!1},setReplyIndex(p){this.index=p},setAccounts(p){this.accountsIdMap=p},getAccountIdById(p){const h=this.accountsIdMap.find(i=>i.accountId!==void 0&&i.accountId===p);return h?h.id:null},addlineState(p){const h=this.lineState.findIndex(s=>s.userId===p.userId&&s.currentAccId===p.currentAccId),i=this.lineState.findIndex(s=>s.groupId===p.groupId&&s.currentAccId===p.currentAccId);p.userId!=0&&h!==-1||p.groupId!=0&&i!==-1||this.lineState.push({currentAccId:p.currentAccId,userId:p.userId,status:p.status,message:p.message,filePath:p.filePath,msgDate:p.msgDate,count:p.count,label:p.label,groupId:p.groupId,gMessage:p.gMessage,remark:p.remark})},sendLineMsg({currentAccId:p,userId:h,message:i,filePath:s,msgDate:g,groupId:y,gMessage:v}){let j=null;h!=0?j=this.lineState.find(z=>z.userId===h&&z.currentAccId===p):y!=0&&(j=this.lineState.find(z=>z.groupId===y&&z.currentAccId===p)),j&&(j.message=i,j.filePath=s,j.msgDate=g,j.groupId=y,j.gMessage=v)},updateLineStatus({currentAccId:p,userId:h,status:i}){const s=this.lineState.find(g=>g.userId===h&&g.currentAccId===p);s?s.status=i:this.lineState.push({currentAccId:p,userId:h,status:i,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:0,gMessage:"",remark:""})},updateLineMessage({currentAccId:p,userId:h,message:i,filePath:s,msgDate:g}){const y=this.lineState.find(v=>v.userId===h&&v.currentAccId===p);y?(y.message=i,y.filePath=s,y.msgDate=g):this.lineState.push({currentAccId:p,userId:h,status:!0,message:i,filePath:s,msgDate:g,count:0,label:"",groupId:0,gMessage:"",remark:""})},updateLineGroupMessage({currentAccId:p,groupId:h,gMessage:i,msgDate:s}){const g=this.lineState.find(y=>y.groupId===h&&y.currentAccId===p);g?(g.gMessage=i,g.msgDate=s):this.lineState.push({currentAccId:p,userId:0,status:!0,message:"",filePath:"",msgDate:"",count:0,label:"",groupId:h,gMessage:i,remark:""})},updateLineMessageCount({currentAccId:p,userId:h,count:i}){const s=this.lineState.find(g=>g.userId===h&&g.currentAccId===p);s?s.count=i:this.lineState.push({currentAccId:p,userId:h,status:!0,message:"",filePath:"",msgDate:"",count:i,label:"",groupId:0,gMessage:"",remark:""})},updateLineMessageGroupCount({currentAccId:p,groupId:h,count:i}){const s=this.lineState.find(g=>g.groupId===h&&g.currentAccId===p);s?s.count=i:this.lineState.push({currentAccId:p,userId:0,status:!0,message:"",filePath:"",msgDate:"",count:i,label:"",groupId:h,gMessage:"",remark:""})},updateLineMessageLabel({currentAccId:p,userId:h,label:i}){const s=this.lineState.find(g=>g.userId===h&&g.currentAccId===p);s?s.label=i:this.lineState.push({currentAccId:p,userId:h,status:!0,message:"",filePath:"",msgDate:"",count:0,label:i,groupId:0,gMessage:"",remark:""})},updateRemark({currentAccId:p,userId:h,remark:i}){const s=this.lineState.find(g=>g.userId===h&&g.currentAccId===p);s?s.remark=i:console.log("未找到对应的用户状态")},getRemarkById(p,h){const i=this.lineState.find(s=>s.userId===h&&s.currentAccId===p);return i?i.remark:""},getLineStatusById(p,h){const i=this.lineState.find(s=>s.userId===h&&s.currentAccId===p);return i?i.status:!1},getNewMsgById(p,h){const i=this.lineState.find(s=>s.userId===h&&s.currentAccId===p);return i?i.message:""},getNewMsgDateById(p,h){const i=this.lineState.find(y=>y.userId===h&&y.currentAccId===p);if(!i||!i.msgDate)return"";const s=new Date(i.msgDate);return`${String(s.getUTCMonth()+1).padStart(2,"0")}.${String(s.getUTCDate()).padStart(2,"0")} ${String(s.getUTCHours()).padStart(2,"0")}:${String(s.getUTCMinutes()).padStart(2,"0")}`},getNewMsgDateIntactById(p,h,i){let s=null;return h!=0&&h!=null&&h!=null?s=this.lineState.find(v=>v.userId===h&&v.currentAccId===p):i!=0&&i!=null&&i!=null&&(s=this.lineState.find(v=>v.groupId===i&&v.currentAccId===p)),!s||!s.msgDate?"":new Date(s.msgDate).toISOString()},getCountById(p,h){const i=this.lineState.find(s=>s.userId===h&&s.currentAccId===p);return i?Number(i.count):0},getLabelById(p,h){const i=this.lineState.find(s=>s.userId===h&&s.currentAccId===p);return i?i.label:""},getTotalUnreadCount(p){return this.lineState.filter(h=>h.currentAccId===p).reduce((h,i)=>h+i.count,0)},getTotalUnreadCountByUserId(p){return this.lineState.filter(h=>h.currentAccId===p&&h.userId!==0).reduce((h,i)=>h+i.count,0)},getTotalUnreadCountByGroupId(p){return this.lineState.filter(h=>h.currentAccId===p&&h.groupId!==0).reduce((h,i)=>h+i.count,0)},getLatestMsgDateByCurrentAccId(p){var g;const h=this.lineState.filter(y=>y.currentAccId===p);if(h.length===0)return null;const s=(g=h.filter(y=>y.msgDate).sort((y,v)=>new Date(v.msgDate).getTime()-new Date(y.msgDate).getTime())[0])==null?void 0:g.msgDate;return s||null},getLatestMessageByCurrentAccId(p){const h=this.lineState.filter(s=>s.currentAccId===p&&s.msgDate).map(s=>({...s,date:new Date(s.msgDate).getTime()})).sort((s,g)=>g.date-s.date);if(h.length===0)return null;const i=h[0];if(i){if(i.message)return i.message;if(i.gMessage)return i.gMessage}return null},getNewMsgByGroupId(p,h){const i=this.lineState.find(s=>s.groupId===h&&s.currentAccId===p);return i?i.gMessage:""},getNewMsgDateByGroupId(p,h){const i=this.lineState.find(y=>y.groupId===h&&y.currentAccId===p);if(!i||!i.msgDate)return"";const s=new Date(i.msgDate);return`${String(s.getUTCMonth()+1).padStart(2,"0")}.${String(s.getUTCDate()).padStart(2,"0")} ${String(s.getUTCHours()).padStart(2,"0")}:${String(s.getUTCMinutes()).padStart(2,"0")}`},getCountBygroupId(p,h){const i=this.lineState.find(s=>s.groupId===h&&s.currentAccId===p);return i?Number(i.count):0}},persist:!0}),fo={class:"col-span-2 mt-1 bg-white rounded-md p-4"},go={class:"flex justify-between items-center mb-4 pb-4",style:{"border-bottom":"1px solid #ccc"}},mo={class:"demo-collapse"},vo=["onClick"],ho={class:"absolute -top-3 left-6"},yo={class:"w-full h-full text-xl text-white flex justify-center items-center"},_o={class:"col-span-8 h-12 ml-2"},Io={class:"grid grid-cols-10 gap-4"},bo={class:"text-with-ellipsis col-span-6 font-bold text-sm"},xo={class:"font-thin text-xs flex"},wo={class:"grid grid-cols-10 gap-4"},Co={class:"col-span-6 font-thin text-xs flex"},ko={class:"text-with-ellipsis"},Ao={class:"col-span-4 font-thin text-xs -ml-2"},Mo=["onClick"],$o={class:"absolute -top-3 left-6"},jo={class:"w-full h-full text-xl text-white flex justify-center items-center"},So={class:"col-span-8 h-12 ml-2"},Do={class:"grid grid-cols-10 gap-4"},Lo={class:"text-with-ellipsis col-span-6 font-bold text-sm"},To={class:"font-thin text-xs flex"},No={class:"grid grid-cols-10 gap-4"},Vo={class:"col-span-6 font-thin text-xs flex"},Uo={class:"text-with-ellipsis"},Ro={class:"col-span-4 font-thin text-xs -ml-2"},Go=Be({__name:"account",props:{currentConId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},upAutoReply:{type:Boolean,required:!1}},emits:["accountId","loginError","accountList"],setup(p,{emit:h}){const i=p,s=h;je(()=>i.upAutoReply,()=>{T.value.forEach(k=>{k.id==z.value&&(k.automaticReply=i.upAutoReply)})});const g=n(!1),y=n(!1),v=Ne(),j=n(-1),z=n(0);function x(k,C){j.value=k,z.value=k,s("accountId",k,j.value,C)}const A=n(""),T=n([]),le=n([]);function ue(){g.value=!0;let k={GroupId:0,GetLastMsg:!0,Like:A.value};yl(k).then(C=>{try{y.value=!0;const te=C.data.data.data.map(H=>({accountId:H.account.accountId,id:H.account.id}));v.setAccounts(te);let J=C.data.data.data;for(let H=0;H<J.length;H++){let X=J[H];if(X.lastMsg){let re=0;X.account.accountId!=null&&(re=ve(J,X.account.accountId));const $={currentAccId:re,userId:X.lastMsg.toUserId,message:X.lastMsg.message,filePath:X.lastMsg.filePath?X.lastMsg.filePath:"",msgDate:X.lastMsg.date};v.updateLineMessage($)}}T.value=C.data.data.data.map(H=>({id:H.account.id,accountId:H.account.accountId,groupId:H.account.groupId,status:H.account.status,accountName:H.account.nickName,phone:H.account.phone,language:H.account.language,automaticReply:H.account.automaticReply,automaticReplyAll:H.account.automaticReplyAll,avatar:H.account.nickName===null?"A":H.account.nickName.charAt(0).toUpperCase(),msgNewDate:B(H.account.id),message:W(H.account.id),color:se()})),T.value.sort((H,X)=>H.msgNewDate&&!X.msgNewDate?-1:!H.msgNewDate&&X.msgNewDate?1:H.msgNewDate&&X.msgNewDate?new Date(X.msgNewDate).getTime()-new Date(H.msgNewDate).getTime():0),s("accountList",T.value)}catch(te){console.log(te)}}).catch(C=>{console.log("获取账号列表失败",C),y.value=!1}).finally(()=>{g.value=!1})}const ie=k=>{const C=JSON.parse(k);if(C.Type===Oe.OnLine){const{accountId:te,userId:J,status:H}=C.Message,X=ae(T.value,te);if(X===null)return;const re={currentAccId:X,userId:J,status:H==="Online"};v.updateLineStatus(re)}if(C.Type===Oe.OffLine){const{accountId:te,userId:J,status:H}=C.Message,X=ae(T.value,te);if(X===null)return;const re={currentAccId:X,userId:J,status:H!=="Offline"};v.updateLineStatus(re)}if(C.type===Oe.NewGroupMessage||C.type===Oe.NewClannelMessage){const{accountId:te,chatId:J,message:H,date:X}=C,re=ae(T.value,te);if(re===null)return;let $=Number(ce(re,J));re===z.value&&(j.value=re);const G={currentAccId:re,groupId:J,gMessage:H,msgDate:X};if(v.updateLineGroupMessage(G),i.currentGroId===J)return;{$++;const U={currentAccId:re,groupId:J,count:$};v.updateLineMessageGroupCount(U),Q(re)}let V=T.value.find(U=>U.id===re);V&&(V.msgNewDate=B(re)??"",V.message=W(re)||""),Z(re)}if(C.type===Oe.NewUserMessage){const{accountId:te,formUserId:J,message:H,date:X,filePath:re}=C,$=ae(T.value,te);if($===null)return;let G=Number(b($,J));$===z.value&&(j.value=$);const V={currentAccId:$,userId:J,message:H,filePath:re,msgDate:X};if(v.updateLineMessage(V),i.currentConId===J&&$===z.value){let I=T.value.find(m=>m.id===$);I&&(I.msgNewDate=B($)??"",I.message=W($)||"");return}else{G++;const I={currentAccId:$,userId:J,count:G};v.updateLineMessageCount(I),Q($)}let U=T.value.find(I=>I.id===$);U&&(U.msgNewDate=B($)??"",U.message=W($)||""),Z($)}if(C.Type===Oe.ErrorOnLine){const{type:te}=C.Message;s("loginError",te)}};function O(k){if(k==null||k==="")return"";const C=new Date(k);return`${String(C.getUTCMonth()+1).padStart(2,"0")}.${String(C.getUTCDate()).padStart(2,"0")} ${String(C.getUTCHours()).padStart(2,"0")}:${String(C.getUTCMinutes()).padStart(2,"0")}`??""}function B(k){return v.getLatestMsgDateByCurrentAccId(k)??""}function W(k){return v.getLatestMessageByCurrentAccId(k)}const b=(k,C)=>v.getCountById(k,C),ce=(k,C)=>v.getCountBygroupId(k,C);function Q(k){return Ne().getTotalUnreadCount(k)}function ae(k,C){const te=k.find(J=>J.accountId!=null?J.accountId===C:"");return te?te.id:null}function ve(k,C){const te=k.find(J=>J.account.accountId!=null?J.account.accountId===C:"");return te?te.account.id:0}function Z(k){const C=T.value.findIndex(te=>te.id===k);if(C!==-1){const[te]=T.value.splice(C,1);te&&T.value.unshift(te)}}et.on("updateNotice",ie),pt(()=>{et.off("updateNotice",ie)});const oe=n("-1"),Ae=k=>{le.value=T.value.filter(C=>C.groupId===k)},ye=n([]);function he(){_l().then(k=>{try{ye.value=k.data.data.data.map(C=>({id:C.id,groupName:C.name}))}catch(C){console.log(C)}}).catch(k=>{console.log("获取分组失败1",k.data)})}function se(){let J,H,X;do J=Math.floor(Math.random()*360),H=Math.floor(Math.random()*51)+50,X=Math.floor(Math.random()*41)+30;while(H<50||X>70);return`hsl(${J}, ${H}%, ${X}%)`}return ot(()=>{he(),ue()}),(k,C)=>{const te=Ke,J=ut,H=vt,X=tt,re=Ut,$=el,G=Yt,V=ct;return a(),u("div",fo,[e("div",go,[l(J,{modelValue:A.value,"onUpdate:modelValue":C[0]||(C[0]=U=>A.value=U),class:me(["w-full","input-with-select"]),placeholder:k.$t("btn.inputSearch")},{append:c(()=>[l(te,{type:"primary",plain:"",onClick:ue},{default:c(()=>[l(t(L),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue","placeholder"])]),l(X,{class:"w-full overflow-hidden",style:{height:"80.5vh"}},{default:c(()=>[e("div",mo,[ze((a(),fe(G,{accordion:"",modelValue:oe.value,"onUpdate:modelValue":C[1]||(C[1]=U=>oe.value=U),onChange:Ae},{default:c(()=>[l($,{name:"-1"},{title:c(()=>[q(_(k.$t("im.account.allAccount")),1)]),default:c(()=>[y.value?(a(),fe(X,{key:0,class:"w-full overflow-y-auto",style:{height:"62vh"}},{default:c(()=>[(a(!0),u(be,null,$e(T.value,(U,I)=>(a(),u("div",{key:I,class:me(["rounded-md shadow-md mb-1 h-20 grid grid-cols-10 gap-4 flex justify-between items-center hover:scale-95 transition-all duration-30 cursor-pointer",{"h-16 bg-sky-400 text-white":j.value===U.id,"h-12":j.value!==U.id}]),style:{border:"1px solid #38bdf8"},onClick:m=>x(U.id,U)},[e("div",{class:"col-span-2 w-10 h-10 rounded-full ml-4 relative",style:Je({backgroundColor:U.color})},[e("div",ho,[Q(U.id)!=0?(a(),fe(H,{key:0,value:Q(U.id),class:"h-1 w-1",offset:[-20,5]},null,8,["value"])):ge("",!0)]),e("div",yo,_(U.avatar),1)],4),e("div",_o,[e("div",Io,[e("div",bo,_(U.accountName),1),e("div",{class:me(["text-with-ellipsis col-span-4 font-thin text-xs mr-2",U.status==1?"text-green-300":"text-red-500"])},_(t(At)(U.status)),3)]),e("div",xo,[l(t(L),{icon:"line-md:phone",style:{"font-size":"16px"}}),q(" : "+_(U.phone),1)]),e("div",wo,[e("div",Co,[e("span",null,[l(t(L),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),e("div",ko," : "+_(U.message),1)]),e("div",Ao,_(O(U.msgNewDate)),1)])])],10,vo))),128))]),_:1})):(a(),fe(re,{key:1,description:"暂无数据"}))]),_:1}),(a(!0),u(be,null,$e(ye.value,(U,I)=>(a(),fe($,{key:I,name:U.id},{title:c(()=>[q(_(k.$t("im.account.grouping"))+" : "+_(U.groupName),1)]),default:c(()=>[l(X,{class:"w-full overflow-hidden",style:{height:"50vh"}},{default:c(()=>[(a(!0),u(be,null,$e(le.value,(m,ne)=>(a(),u("div",{key:ne,class:me(["rounded-md shadow-md mb-1 h-20 grid grid-cols-10 gap-4 flex justify-between items-center hover:scale-95 transition-all duration-30 cursor-pointer",{"h-16 bg-sky-400 text-white":j.value===m.id,"h-12":j.value!==m.id}]),style:{border:"1px solid #38bdf8"},onClick:Y=>x(m.id)},[e("div",{class:"col-span-2 w-10 h-10 rounded-full ml-4 relative",style:Je({backgroundColor:m.color})},[e("div",$o,[Q(m.id)!=0?(a(),fe(H,{key:0,value:Q(m.id),class:"h-1 w-1",offset:[-20,5]},null,8,["value"])):ge("",!0)]),e("div",jo,_(m.avatar),1)],4),e("div",So,[e("div",Do,[e("div",Lo,_(m.accountName),1),e("div",{class:me(["text-with-ellipsis col-span-4 font-thin text-xs mr-2",m.status==1?"text-green-300":"text-red-500"])},_(t(At)(m.status)),3)]),e("div",To,[l(t(L),{icon:"line-md:phone",style:{"font-size":"16px"}}),q(" : "+_(m.phone),1)]),e("div",No,[e("div",Vo,[e("span",null,[l(t(L),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),e("div",Uo," : "+_(m.message),1)]),e("div",Ro,_(O(m.msgNewDate)),1)])])],10,Mo))),128))]),_:2},1024)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])),[[V,g.value]])])]),_:1})])}}}),Eo=We(Go,[["__scopeId","data-v-724b3799"]]),Fo={class:"mb-2"},zo=["data","onClick","onContextmenu"],Po={key:1,class:"text-xl text-white"},Bo={key:3,class:"text-xl text-white"},Ho={class:"col-span-3 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},qo={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},Oo={key:1,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},Ko={class:"font-thin text-xs flex"},Jo={key:0},Wo={key:0,class:"flex"},Qo={key:1,class:"flex"},Zo={key:1,class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"},Xo={class:"col-span-2 h-12 w-20 -ml-2"},Yo={class:"font-thin text-xs"},es={class:"font-thin text-xs"},ts={class:"col-span-3 mr-2 flex relative"},ls={key:0,class:"absolute -top-5 w-20","aria-label":"Close",style:{right:"-1.2rem"}},os={class:"flex items-center text-amber-500"},ss={class:"text-xs"},ns={key:1},as={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},is={class:"flex"},rs={key:0},cs={key:1},us={class:"dialog-footer"},ds={key:0},ps={key:1},fs=Be({__name:"allContantList",props:{currentAccId:{},contantList:{},loading:{type:Boolean},isCurAcc:{type:Boolean},errMsg:{},loginError:{},currentComponent:{}},emits:["contactId","groupId","latestMsg","refreshContacts","allMsgCount","userMsgCount","groupMsgCount"],setup(p,{emit:h}){const i=p,s=h;je(()=>i.isCurAcc,()=>{i.isCurAcc==!0&&(ve(),Z(),oe(),z(),v.value=void 0,y.value=-1)});const g=Ne(),y=n(-1),v=n();function j(I,m){y.value=I,v.value=m,s("contactId",v.value),v.value&&(v.value.groupId!=null?g.updateLineMessageGroupCount({currentAccId:i.currentAccId,groupId:v.value.groupId,count:0}):g.updateLineMessageCount({currentAccId:i.currentAccId,userId:v.value.userId,count:0}),ve(),Z(),oe())}function z(){i.contantList.map(m=>({currentAccId:i.currentAccId,userId:m.tgAccountDialog.userId?m.tgAccountDialog.userId:0,groupId:m.tgAccountDialog.groupId?m.tgAccountDialog.groupId:0,gMessage:"",status:m.tgAccountDialog.isOnline?m.tgAccountDialog.isOnline:!1,message:m.lastMsg?m.lastMsg.message:"",filePath:m.lastMsg?m.lastMsg.filePath:"",msgDate:m.lastMsg?m.lastMsg.date:"",count:0,label:"",remark:""})).forEach(m=>{g.addlineState(m)})}const x=Ue(()=>g.accountsIdMap);function A(I,m){const ne=I.find(Y=>Y.accountId!=null?Y.accountId===m:"");return ne?ne.id:null}const T=I=>{const m=JSON.parse(I);if(m.type===Oe.NewGroupMessage||m.type===Oe.NewClannelMessage){const{accountId:ne,chatId:Y}=m,Ce=A(x.value,ne);ve(),oe(),Ce===i.currentAccId&&s("latestMsg",0,Y)}if(m.type===Oe.NewUserMessage){const{accountId:ne,formUserId:Y}=m;A(x.value,ne)===i.currentAccId&&s("latestMsg",Y,0),ve(),Z()}},le=I=>g.getLineStatusById(i.currentAccId,I),ue=I=>g.getNewMsgById(i.currentAccId,I),ie=I=>g.getNewMsgByGroupId(i.currentAccId,I),O=(I,m)=>{let ne="";return m=="con"?ne=g.getNewMsgDateById(i.currentAccId,I):ne=g.getNewMsgDateByGroupId(i.currentAccId,I),ne.split(" ")[0]},B=(I,m)=>{let ne="";m=="con"?ne=g.getNewMsgDateById(i.currentAccId,I):ne=g.getNewMsgDateByGroupId(i.currentAccId,I);const Y=ne.split(" ")[1];if(Y!=null){const Ce=Y.split(":")[0];return Number(Ce)>=12?`${Y} p.m.`:`${Y} a.m.`}},W=(I,m)=>{let ne=0;return m=="con"?ne=g.getCountById(i.currentAccId,I):ne=g.getCountBygroupId(i.currentAccId,I),ne},b=I=>g.getLabelById(i.currentAccId,I),ce=n(0),Q=n(0),ae=n(0),ve=()=>{ce.value=g.getTotalUnreadCount(i.currentAccId),s("allMsgCount",ce.value)},Z=()=>{Q.value=g.getTotalUnreadCountByUserId(i.currentAccId),s("userMsgCount",Q.value)},oe=()=>{ae.value=g.getTotalUnreadCountByGroupId(i.currentAccId),s("groupMsgCount",ae.value)};et.on("updateNotice",T),pt(()=>{et.off("updateNotice",T)});function Ae(I){if(I){const m=I.lastIndexOf(".");if(m!==-1){const ne=I.substring(m+1).toLowerCase();return["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(ne)?"image":"file"}}}const ye=n(""),he=n();function se(I,m){I.preventDefault(),rt.showContextMenu({x:I.x,y:I.y,theme:"mac",items:[{label:"退出群组",svgIcon:"#mdi--location-exit",onClick:()=>{k.value=!0,he.value=m.tgAccountDialog.groupId,ye.value="group"}}]})}const k=n(!1),C=()=>{k.value=!1;const I={id:i.currentAccId,chatId:he.value,isDelete:!1};Et(I).then(m=>{s("refreshContacts")}).catch(m=>{console.log("退出群组失败",m)})},te=n();function J(I,m){I.preventDefault(),rt.showContextMenu({x:I.x,y:I.y,theme:"mac",items:[{label:"删除联系人",svgIcon:"#mdi--location-exit",onClick:()=>{console.log("当前消息的信息1",m),k.value=!0,te.value=m.tgAccountDialog.userId,ye.value="contact"}}]})}const H=()=>{k.value=!1;const I={id:i.currentAccId,userId:te.value};Ft(I).then(m=>{s("refreshContacts")}).catch(m=>{console.log("删除联系人失败",m)})},X=n([]),re=n([]),$=n(!1);function G(){return X.value.map(I=>JSON.parse(I))}function V(){$.value=!0,re.value=G().map(I=>({groupId:I.tgAccountDialog.groupId?I.tgAccountDialog.groupId:0,userId:I.tgAccountDialog.userId?I.tgAccountDialog.userId:0}))}function U(){X.value=[],re.value=[]}return ot(()=>{ve(),Z(),oe()}),(I,m)=>{const ne=Ut,Y=Ke,Ce=Bt,Me=Fl,xe=vt,He=ht,Te=tt,Ge=Xe,Re=ct;return a(),u(be,null,[ze((a(),fe(Te,{"element-loading-text":I.$t("im.allContant.accLoging"),class:"w-full overflow-hidden -mt-3",style:{height:"64vh"}},{default:c(()=>[I.contantList.length===0?(a(),fe(ne,{key:0,description:I.loginError?I.loginError:I.errMsg===""?I.$t("im.allContant.notContactAndGroup"):I.errMsg},null,8,["description"])):ge("",!0),l(Nt,{name:"fade"},{default:c(()=>[ze(e("div",Fo,[l(Y,{class:"w-full",type:"primary",onClick:V},{default:c(()=>m[5]||(m[5]=[q(" 一键群发 ")])),_:1})],512),[[dt,X.value.length!==0]])]),_:1}),(a(!0),u(be,null,$e(I.contantList,(P,M)=>{var R,K;return a(),u("div",{key:M,class:"grid grid-cols-12 gap-4"},[e("div",{class:me(["col-span-1 ml-1 mr-1 flex justify-between items-center",{"h-16":y.value===P.tgAccountDialog.id,"h-12":y.value!==P.tgAccountDialog.id}])},[l(Me,{modelValue:X.value,"onUpdate:modelValue":m[0]||(m[0]=w=>X.value=w)},{default:c(()=>[l(Ce,{value:JSON.stringify(P)},null,8,["value"])]),_:2},1032,["modelValue"])],2),e("div",{data:P.tgAccountDialog.id,class:me(["col-span-11 grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-90 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":y.value===P.tgAccountDialog.id,"h-12":y.value!==P.tgAccountDialog.id}]),style:{"border-bottom":"1px solid #ccc"},onClick:w=>j(P.tgAccountDialog.id,P.tgAccountDialog),onContextmenu:w=>P.tgAccountDialog.groupId?se(w,P):J(w,P)},[e("div",{class:"col-span-4 w-10 h-10 flex rounded-full ml-2 items-center justify-center",style:Je({backgroundColor:P.color})},[W(P.tgAccountDialog.userId,"con")!==0?(a(),fe(xe,{key:0,value:Number(W(P.tgAccountDialog.userId,"con")),class:"item",offset:[-12,-12]},{default:c(()=>m[6]||(m[6]=[e("div",{class:"h-1 w-1"},null,-1)])),_:2},1032,["value"])):ge("",!0),P.tgAccountDialog.avatar?(a(),u("span",Po,_(P.tgAccountDialog.avatar),1)):W(P.tgAccountDialog.groupId??0,"gro")!==0?(a(),fe(xe,{key:2,type:"primary",value:Number(W(P.tgAccountDialog.groupId??0,"gro")),class:"item",offset:[-12,-12]},{default:c(()=>m[7]||(m[7]=[e("div",{class:"h-1 w-1"},null,-1)])),_:2},1032,["value"])):ge("",!0),P.tgAccountDialog.avatarG?(a(),u("span",Bo,_(P.tgAccountDialog.avatarG),1)):ge("",!0)],4),l(He,{class:"box-item",effect:"dark",content:(R=P.tgAccountDialog)!=null&&R.userName?(K=P.tgAccountDialog)==null?void 0:K.userName:P.tgAccountDialog.groupTitle?P.tgAccountDialog.groupTitle:"未识别命名",placement:"right"},{default:c(()=>{var w,f;return[e("div",Ho,[P.tgAccountDialog.userName?(a(),u("div",qo,_(P.tgAccountDialog.userName),1)):ge("",!0),P.tgAccountDialog.groupTitle?(a(),u("div",Oo,_(P.tgAccountDialog.groupTitle),1)):ge("",!0),e("div",Ko,[e("span",null,[l(t(L),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),((w=P.lastMsg)==null?void 0:w.filePath)!=null?(a(),u("div",Jo,[Ae(P.lastMsg.filePath)==="image"?(a(),u("div",Wo,[m[8]||(m[8]=q(" : ")),l(t(L),{icon:"lets-icons:img-box",class:"ml-2",style:{"font-size":"16px"}}),q(" "+_(P.lastMsg.message),1)])):Ae(P.lastMsg.filePath)==="file"?(a(),u("div",Qo,[m[9]||(m[9]=q(" : ")),l(t(L),{icon:"mi:document",class:"ml-2",style:{"font-size":"16px"}}),q(" "+_(P.lastMsg.message),1)])):ge("",!0)])):(a(),u("div",Zo," : "+_(P.tgAccountDialog.groupId?ie((f=P.tgAccountDialog)==null?void 0:f.groupId):ue(P.tgAccountDialog.userId)),1))])])]}),_:2},1032,["content"]),e("div",Xo,[e("div",null,[e("span",Yo,_(P.tgAccountDialog.groupId?O(P.tgAccountDialog.groupId,"gro"):O(P.tgAccountDialog.userId,"con")),1)]),e("div",null,[e("span",es,_(P.tgAccountDialog.groupId?B(P.tgAccountDialog.groupId,"gro"):B(P.tgAccountDialog.userId,"con")),1)])]),e("div",ts,[(b(P.tgAccountDialog.userId)?b(P.tgAccountDialog.userId):P.tgAccountDialog.label)?(a(),u("div",ls,[e("div",os,[l(t(L),{icon:"fluent-emoji:label",style:{"font-size":"18px"}}),e("span",ss,_(b(P.tgAccountDialog.userId)?b(P.tgAccountDialog.userId):P.tgAccountDialog.label),1)])])):ge("",!0),P.tgAccountDialog.groupId?ge("",!0):(a(),u("div",ns,[e("div",{class:me(["text-with-ellipsis font-thin text-xs absolute top-1",le(P.tgAccountDialog.userId)?"text-emerald-300":"text-red-500"]),style:{right:"0.4rem"}},_(le(P.tgAccountDialog.userId)?"在线":"离线"),3),l(t(L),{class:me(["absolute top-1",le(P.tgAccountDialog.userId)?"text-emerald-300":"text-red-500"]),icon:"icon-park-outline:dot",style:{"font-size":"20px",right:"-0.7rem"}},null,8,["class"])]))])],42,zo)])}),128))]),_:1},8,["element-loading-text"])),[[Re,I.loading]]),(a(),u("svg",as,m[10]||(m[10]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1)]))),l(Ge,{modelValue:k.value,"onUpdate:modelValue":m[3]||(m[3]=P=>k.value=P),title:`${ye.value=="group"?"群组":"联系人"}`,width:"500"},{footer:c(()=>[e("div",us,[ye.value=="group"?(a(),u("div",ds,[l(Y,{onClick:m[1]||(m[1]=P=>k.value=!1)},{default:c(()=>m[11]||(m[11]=[q("Cancel")])),_:1}),l(Y,{type:"danger",onClick:C},{default:c(()=>m[12]||(m[12]=[q("退出")])),_:1})])):(a(),u("data",ps,[l(Y,{onClick:m[2]||(m[2]=P=>k.value=!1)},{default:c(()=>m[13]||(m[13]=[q("Cancel")])),_:1}),l(Y,{type:"danger",onClick:H},{default:c(()=>m[14]||(m[14]=[q("删除")])),_:1})]))])]),default:c(()=>[e("div",is,[l(t(L),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),ye.value=="group"?(a(),u("span",rs,"是否确认退出群组？退出群组聊天数据将会丢失！")):(a(),u("span",cs,"是否确认删除联系人？删除该联系人聊天数据将会丢失！"))])]),_:1},8,["modelValue","title"]),l(zl,{currentAccId:i.currentAccId,show:$.value,oneClickGList:re.value,"onUp:show":m[4]||(m[4]=P=>$.value=P),"onUp:success":U},null,8,["currentAccId","show","oneClickGList"])],64)}}}),It=We(fs,[["__scopeId","data-v-cde9a68a"]]),gs=["onClick","onContextmenu"],ms={class:"text-xl text-white"},vs={class:"col-span-4 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},hs={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},ys={class:"font-thin text-xs flex"},_s={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Is={class:"flex"},bs={class:"dialog-footer"},xs=Be({__name:"myContacts",props:{currentAccId:{}},emits:["myConId","refreshCon"],setup(p,{emit:h}){const i=p,s=h,g=n(!1),y=n(-1);function v(O,B){y.value=O,s("myConId",B)}const j=n(),z=n();function x(O,B){O.preventDefault(),rt.showContextMenu({x:O.x,y:O.y,theme:"mac",items:[{label:"删除联系人",svgIcon:"#mdi--location-exit",onClick:()=>{A.value=!0,z.value=B.tgAccountDialog.userId,j.value=B.tgAccountDialog.firstName}}]})}const A=n(!1),T=()=>{A.value=!1;const O={id:i.currentAccId,userId:z.value};Ft(O).then(B=>{s("refreshCon")}).catch(B=>{console.log("删除联系人失败",B)}),le()};function le(){A.value=!1,j.value=""}const ue=n([]);function ie(){g.value=!0;const O={id:i.currentAccId};wt(O).then(B=>{try{console.log("获取我的群组列表成功",B.data.data),Array.isArray(B.data.data)&&(ue.value=B.data.data.map(W=>({...W,avatarC:W.firstName?W.firstName.charAt(0).toUpperCase():void 0,color:yt()})))}catch(W){console.log(W)}}).catch(B=>{console.log("获取我的群组列表失败",B)}).finally(()=>{g.value=!1})}return ot(()=>{ie()}),(O,B)=>{const W=tt,b=Ke,ce=Xe,Q=ct;return a(),u(be,null,[ze((a(),fe(W,{class:"w-full overflow-hidden",style:{height:"70.7vh"}},{default:c(()=>[(a(!0),u(be,null,$e(ue.value,(ae,ve)=>(a(),u("div",{key:ve,class:me(["grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-110 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":y.value===ae.id,"h-12":y.value!==ae.id}]),style:{"border-bottom":"1px solid #ccc"},onClick:Z=>v(ae.id,ae),onContextmenu:Z=>x(Z,ae)},[e("div",{class:"col-span-3 w-10 h-10 flex rounded-full ml-4 items-center justify-center",style:Je({backgroundColor:ae.color})},[e("span",ms,_(ae.avatarC),1)],4),e("div",vs,[ae.firstName?(a(),u("div",hs,_(ae.firstName),1)):ge("",!0),e("div",ys,[e("span",null,[l(t(L),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),B[1]||(B[1]=e("div",{class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"}," : 文字内容 ",-1))])]),B[2]||(B[2]=e("div",{class:"mr-2"},null,-1))],42,gs))),128))]),_:1})),[[Q,g.value]]),(a(),u("svg",_s,B[3]||(B[3]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1)]))),l(ce,{modelValue:A.value,"onUpdate:modelValue":B[0]||(B[0]=ae=>A.value=ae),title:`是否删除联系人：${j.value}`,width:"500"},{footer:c(()=>[e("div",bs,[l(b,{onClick:le},{default:c(()=>B[5]||(B[5]=[q("Cancel")])),_:1}),l(b,{type:"danger",onClick:T},{default:c(()=>B[6]||(B[6]=[q("删除")])),_:1})])]),default:c(()=>[e("div",Is,[l(t(L),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),B[4]||(B[4]=e("span",null,_("删除该联系人，聊天数据将会丢失！"),-1))])]),_:1},8,["modelValue","title"])],64)}}}),ws=We(xs,[["__scopeId","data-v-9bc87f18"]]),Cs=["onClick","onContextmenu"],ks={class:"text-xl text-white"},As={class:"col-span-4 h-12 -ml-3 overflow-hidden text-ellipsis whitespace-nowrap"},Ms={key:0,class:"font-bold text-sm overflow-hidden text-ellipsis whitespace-nowrap"},$s={class:"font-thin text-xs flex"},js={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Ss={class:"flex"},Ds={class:"dialog-footer"},Ls=Be({__name:"myGroups",props:{currentAccId:{}},emits:["myGroupId","refreshGroup"],setup(p,{emit:h}){const i=p,s=h,g=Ne(),y=n(!1),v=n(-1);function j(W,b){v.value=W,s("myGroupId",b.id)}const z=n(),x=n(!1),A=n();function T(W,b){W.preventDefault(),rt.showContextMenu({x:W.x,y:W.y,theme:"mac",items:[{label:"退出群组",svgIcon:"#mdi--location-exit",onClick:()=>{console.log("当前消息的信息1",b),le.value=!0,A.value=b.id,z.value=b.title,x.value=!1}},{label:"解散群组",svgIcon:"#fluent-mdl2--leave-user",onClick:()=>{console.log("当前消息的信息2",b),g.getAccountIdById(b.adminId),le.value=!0,A.value=b.id,z.value=b.title,i.currentAccId==g.getAccountIdById(b.adminId)&&(x.value=!0)}}]})}const le=n(!1),ue=()=>{le.value=!1;const W={id:i.currentAccId,chatId:A.value,isDelete:x.value};Et(W).then(b=>{console.log("退出群组成功",b.data),s("refreshGroup")}).catch(b=>{console.log("退出群组失败",b)}),ie()};function ie(){le.value=!1,x.value=!1,z.value="",A.value=""}const O=n([]);function B(){y.value=!0;const W={id:i.currentAccId};Il(W).then(b=>{try{console.log("获取我的群组列表成功",b.data.data),Array.isArray(b.data.data)&&(O.value=b.data.data.map(ce=>({...ce,avatarG:ce.title?ce.title.charAt(0).toUpperCase():void 0,color:yt()})))}catch(ce){console.log(ce)}}).catch(b=>{console.log("获取我的群组列表失败",b)}).finally(()=>{y.value=!1})}return ot(()=>{B()}),(W,b)=>{const ce=tt,Q=Ke,ae=Xe,ve=ct;return a(),u(be,null,[ze((a(),fe(ce,{class:"w-full overflow-hidden",style:{height:"70.7vh"}},{default:c(()=>[(a(!0),u(be,null,$e(O.value,(Z,oe)=>(a(),u("div",{key:oe,class:me(["grid grid-cols-12 gap-4 flex justify-between items-center rounded-md mb-2 hover:scale-110 transition-all duration-30 cursor-pointer",{"h-16 shadow-xl bg-sky-400 text-white":v.value===oe,"h-12":v.value!==oe}]),style:{"border-bottom":"1px solid #ccc"},onClick:Ae=>j(oe,Z),onContextmenu:Ae=>T(Ae,Z)},[e("div",{class:"col-span-3 w-10 h-10 flex rounded-full ml-4 items-center justify-center",style:Je({backgroundColor:Z.color})},[e("span",ks,_(Z.avatarG),1)],4),e("div",As,[Z.title?(a(),u("div",Ms,_(Z.title),1)):ge("",!0),e("div",$s,[e("span",null,[l(t(L),{icon:"bitcoin-icons:message-outline",style:{"font-size":"16px"}})]),b[1]||(b[1]=e("div",{class:"text-with-ellipsis overflow-hidden text-ellipsis whitespace-nowrap"}," : 文字内容 ",-1))])]),b[2]||(b[2]=e("div",{class:"mr-2"},null,-1))],42,Cs))),128))]),_:1})),[[ve,y.value]]),(a(),u("svg",js,b[3]||(b[3]=[e("symbol",{id:"mdi--location-exit",viewBox:"0 0 24 24"},[e("path",{fill:"#ec0000",d:"m22 12l-4-4v3h-8v2h8v3m2 2a10 10 0 1 1 0-12h-2.73a8 8 0 1 0 0 12Z"})],-1),e("symbol",{id:"fluent-mdl2--leave-user",viewBox:"0 0 2048 2048"},[e("path",{fill:"#ff0a0a",d:"M2048 1536v128h-646l211 211l-90 90l-365-365l365-365l90 90l-211 211zm-756-433l-88 93q-89-84-201-128t-235-44q-88 0-170 23t-153 64t-129 100t-100 130t-65 153t-23 170H0q0-117 35-229t101-207t157-169t203-113q-56-36-100-83t-76-103t-47-118t-17-130q0-106 40-199t109-163T568 40T768 0t199 40t163 109t110 163t40 200q0 137-63 248t-177 186q70 26 133 66t119 91M384 512q0 80 30 149t82 122t122 83t150 30q79 0 149-30t122-82t83-122t30-150q0-79-30-149t-82-122t-123-83t-149-30q-80 0-149 30t-122 82t-83 123t-30 149"})],-1)]))),l(ae,{modelValue:le.value,"onUpdate:modelValue":b[0]||(b[0]=Z=>le.value=Z),title:`是否${x.value?"解散":"退出"}群组：${z.value}`,width:"500"},{footer:c(()=>[e("div",Ds,[l(Q,{onClick:ie},{default:c(()=>b[4]||(b[4]=[q("Cancel")])),_:1}),l(Q,{type:"danger",onClick:ue},{default:c(()=>[q(_(x.value?"解散":"退出"),1)]),_:1})])]),default:c(()=>[e("div",Ss,[l(t(L),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),e("span",null,_(`${x.value?"解散":"退出"} 群组聊天数据将会丢失！`),1)])]),_:1},8,["modelValue","title"])],64)}}}),Ts=We(Ls,[["__scopeId","data-v-78c9e3a5"]]),Ns={key:0},Vs={key:1},Us={key:2},Rs={key:0,class:"mt-4"},Gs={class:"mb-2"},Es={class:"flex justify-center items-center"},Fs={class:"w-full"},zs={class:"mb-2"},Ps={class:"w-full"},Bs={class:"w-full"},Hs={class:"w-full mr-2"},qs={class:"flex justify-center items-center mt-4"},Os={key:1,class:"mt-4"},Ks={class:"flex justify-center items-center mt-4"},Js={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},Ws=["onClick"],Qs={class:"flex items-center h-8 w-64 overflow-hidden whitespace-nowrap truncate"},Zs=["onClick"],Xs={key:0},Ys={key:1,class:"h-full w-full mt-1",style:{height:"21%"}},en={class:"h-1/4 w-full text-gray-400 flex items-center"},tn={for:"file-input"},ln={class:"flex mr-2 hover:text-sky-500 cursor-pointer"},on={key:0,class:"mt-4",style:{border:"1px solid #ccc"}},sn=["src"],nn=["onClick"],an={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},rn={class:"message-input-container"},cn=["placeholder"],un={class:"h-3/4 w-full flex justify-between items-center",style:{border:"1px solid #ccc"}},dn={class:"message-input-container"},pn=["placeholder"],fn=Be({__name:"addContant",props:["show","currentAccId"],emits:["update:show","anewGet"],setup(p,{emit:h}){const i=p,s=h,g=n("phone");je(()=>g.value,()=>{g.value=="group"&&(ie(),B())});const y=n(""),v=n(),j=()=>{v.value&&(v.value.style.height="auto",v.value.style.height=`${v.value.scrollHeight}px`)},z=n({phone:""});function x(){s("update:show",!1);let w=null;if(z.value.phone&&(w=String(z.value.phone).trimStart().replace(/^\+/,"")),!w||w.trim()===""){console.warn("无效的电话号码");return}const f=new FormData;Z.value.length>0&&Z.value.forEach(F=>{F instanceof File&&f.append("files.FormFiles",F)}),J.value&&J.value.forEach(F=>{f.append("files.UrlFiles",F)}),H.value&&H.value.forEach(F=>{f.append("files.UrlFileTypes",F)}),f.append("Phone",w),f.append("Id",i.currentAccId),y.value&&f.append("Text",y.value),console.log("xxxx"),bl(f).then(F=>{s("anewGet"),z.value.phone="",y.value=""}).catch(F=>{console.log("手机发送消息失败",F),z.value.phone="",y.value=""}),he(),le()}const A=n({username:""});function T(){if(s("update:show",!1),G.value){Fe.error(Ye.global.t("im.addContant.emptyFile"));return}let w=null;if(A.value.username&&(w="@"+A.value.username.substring(A.value.username.lastIndexOf("/")+1)),!w||w.trim()===""){console.warn("无效的电话号码");return}const f=new FormData;Z.value.length>0&&Z.value.forEach(F=>{F instanceof File&&f.append("files.FormFiles",F)}),J.value&&J.value.forEach(F=>{f.append("files.UrlFiles",F)}),H.value&&H.value.forEach(F=>{f.append("files.UrlFileTypes",F)}),f.append("UserName",w),f.append("Id",i.currentAccId),y.value&&f.append("Text",y.value),xl(f).then(F=>{s("anewGet"),A.value.username="",y.value=""}).catch(F=>{console.log("手机发送消息失败",F),A.value.username="",y.value=""}),le(),he()}const le=()=>{k.value=null,Z.value=[],J.value=[],H.value=[],y.value="",A.value.username="",z.value.phone=""},ue=n([]);function ie(){const w={id:i.currentAccId};wt(w).then(f=>{try{ue.value=f.data.data}catch(F){console.log(F)}}).catch(f=>{console.log("联系人列表失败",f)})}const O=n([]);function B(){Ot({GroupId:0}).then(f=>{try{console.log("查询联系人素材成功",f.data.data),O.value=f.data.data.data}catch(F){console.log(F)}}).catch(f=>{console.log("查询联系人素材失败",f)})}const W=n(),b=n([]),ce=w=>{b.value=w},Q=w=>{b.value.some(F=>F===w)?W.value.toggleRowSelection(w,!1):W.value.toggleRowSelection(w,!0)},ae=n([]),ve=n(!1),Z=n([]),oe=n(),Ae=n(""),ye=w=>{const f=w.target.files;if(f.length>0)for(let F=0;F<f.length;F++){const _e=f[F];Z.value.push(_e),Ae.value="isImg";const r=new FileReader;r.onloadend=()=>{typeof r.result=="string"&&ae.value.push(r.result),F===f.length-1&&(ve.value=!0)},r.readAsDataURL(_e)}};function he(){ve.value=!1,Z.value=[],ae.value=[],y.value="",oe.value.value="",Ae.value="",A.value.username="",z.value.phone=""}const se=w=>{ae.value.splice(w,1),Z.value.splice(w,1)},k=n(),C=n(!1);function te(){C.value=!0}const J=n([]),H=n([]),X=n([]);function re(w,f,F,_e){C.value=w,f.length>0&&(X.value=[...X.value,...f],Z.value=[...Z.value,...f]),F.length>0&&_e.length>0&&(Array.isArray(J.value)||(J.value=[]),Array.isArray(H.value)||(H.value=[]),J.value=[...J.value,...F],H.value=[...H.value,..._e])}function $(w){J.value&&H.value&&(J.value.splice(w,1),H.value.splice(w,1))}const G=Ue(()=>k.value&&k.value.size===0),V=n({title:"",phone:""}),U=n("conSend"),I=n(),m=n(0),ne=n([]),Y=n([]),Ce=n(!0),Me=n(!0);let xe=[],He=[];const Te=n([]),Ge=w=>{Te.value=w},Re=w=>{Te.value.some(F=>F===w)?I.value.toggleRowSelection(w,!1):I.value.toggleRowSelection(w,!0)};je([()=>V.value,()=>b.value,()=>Te.value,()=>Y.value],()=>{V.value.title!=""&&(V.value.phone!=""||b.value.length>0||Te.value.length>0)?Ce.value=!1:Ce.value=!0,Y.value.length>0?Me.value=!1:Me.value=!0},{deep:!0});function P(){m.value++,V.value.phone.split(/\r?\n/).forEach(f=>{const F=f.trim();if(F!==""){let _e={phone:F,filterPhone:F,firstName:"",userId:"",userHash:""};ne.value.push(_e)}}),b.value.map(f=>{let F={phone:String(f.phone),filterPhone:String(f.phone),firstName:"",userId:"",userHash:""};ne.value.push(F)}),Te.value.forEach(f=>{let F={phone:"",filterPhone:f.phone,firstName:f.firstName,userId:f.userId,userHash:f.accessHash};ne.value.push(F)}),ne.value=Array.from(new Map(ne.value.map(f=>[f.filterPhone,f])).values())}function M(){m.value--,Y.value=[],ne.value=[],V.value.phone="",b.value=[],Te.value=[]}function R(){const w=V.value.phone.split(/\r?\n/),f=[];w.forEach(r=>{const o=r.trim();o!==""&&f.push(o)}),b.value.map(r=>{f.push(String(r.phone))});const F=Te.value.map(r=>({userId:r.userId,userHash:r.accessHash}));Y.value.forEach(r=>{let o=JSON.parse(r);console.log("item--->",o),o.phone==""?xe.push({userId:o.userId,userHash:o.userHash}):He.push(o.phone)});const _e={id:i.currentAccId,title:V.value.title,phones:f,values:F,adminUsers:xe,adminPhones:He};wl(_e).then(r=>{console.log("新增群组成功",r.data),Fe.success("新增群组成功"),s("anewGet")}).catch(r=>{console.log("新增群组失败",r)}),K()}function K(){s("update:show",!1),V.value.title="",V.value.phone="",Te.value=[],I.value.clearSelection(),g.value="phone",m.value=0}return(w,f)=>{const F=Ke,_e=xt,r=ut,o=Ct,D=kt,Ie=Bl,we=Hl,Le=Ht,Pe=qt,E=ft,S=gt,de=ht,d=tt,Se=Xe;return a(),fe(Se,{modelValue:i.show,"onUpdate:modelValue":f[16]||(f[16]=N=>i.show=N),title:w.$t("im.addContant.addContact"),width:"700"},{footer:c(()=>[g.value==="group"?(a(),u("div",Xs)):(a(),u("div",Ys,[e("div",en,[e("div",null,[e("label",tn,[e("div",ln,[l(t(L),{icon:"lets-icons:img-box",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(w.$t("im.addContant.image")),1)])]),e("input",{ref_key:"imgInputRef",ref:oe,id:"file-input",type:"file",accept:"image/*",multiple:"",onChange:ye,style:{display:"none"}},null,544),l(Se,{modelValue:ve.value,"onUpdate:modelValue":f[13]||(f[13]=N=>ve.value=N),title:"Send an Image",width:"500"},{default:c(()=>[ae.value.length>0?(a(),u("div",on,[(a(!0),u(be,null,$e(ae.value,(N,De)=>(a(),u("div",{key:De,class:"mb-2 relative"},[e("img",{src:N,alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,sn),e("button",{onClick:ke=>se(De),class:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded"},"X",8,nn)]))),128))])):ge("",!0),e("div",an,[e("div",rn,[l(d,{class:"scrollbar",height:100},{default:c(()=>[ze(e("textarea",{"onUpdate:modelValue":f[11]||(f[11]=N=>y.value=N),onInput:j,onKeydown:f[12]||(f[12]=it(Ze(N=>g.value==="phone"?x:T,["prevent"]),["enter"])),placeholder:w.$t("im.addContant.inputSearch"),ref_key:"messageInput",ref:v,class:"message-input"},null,40,cn),[[at,y.value]])]),_:1})]),g.value==="phone"?(a(),u("div",{key:0,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:x},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])):(a(),u("div",{key:1,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:T},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})]))])]),_:1},8,["modelValue"])]),e("div",null,[e("div",{class:"flex hover:text-sky-500 cursor-pointer",onClick:te},[l(t(L),{icon:"mi:document",style:{"font-size":"22px"}}),e("span",null,_(w.$t("im.addContant.file")),1)]),l(Pl,{show:C.value,isLocal:!0,onDeliver:re},null,8,["show"])])]),e("div",un,[e("div",dn,[l(d,{class:"scrollbar",height:100},{default:c(()=>[ze(e("textarea",{"onUpdate:modelValue":f[14]||(f[14]=N=>y.value=N),onInput:j,onKeydown:f[15]||(f[15]=it(Ze(N=>g.value==="phone"?x:T,["prevent"]),["enter"])),placeholder:w.$t("btn.inputSearch"),ref_key:"messageInput",ref:v,class:"message-input"},null,40,pn),[[at,y.value]])]),_:1})]),g.value==="phone"?(a(),u("div",{key:0,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:x},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])):(a(),u("div",{key:1,class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:T},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})]))])]))]),default:c(()=>[l(_e,{class:"w-full mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:c(()=>[l(F,{class:me(["w-1/3",{active:g.value==="phone"}]),type:"primary",plain:"",onClick:f[0]||(f[0]=N=>g.value="phone")},{default:c(()=>[l(t(L),{icon:"line-md:phone-add-filled",style:{"font-size":"22px"}}),q(" "+_(w.$t("im.addContant.sendMsgToPhone")),1)]),_:1},8,["class"]),l(F,{class:me(["w-1/3",{active:g.value==="users"}]),type:"primary",plain:"",onClick:f[1]||(f[1]=N=>g.value="users")},{default:c(()=>[l(t(L),{icon:"mdi:user-add",style:{"font-size":"22px"}}),q(" "+_(w.$t("im.addContant.sendMsgToUser")),1)]),_:1},8,["class"]),l(F,{class:me(["w-1/3",{active:g.value==="group"}]),type:"primary",plain:"",onClick:f[2]||(f[2]=N=>g.value="group")},{default:c(()=>[l(t(L),{icon:"material-symbols:group",style:{"font-size":"22px"}}),f[17]||(f[17]=q(" 新增群组 "))]),_:1},8,["class"])]),_:1}),g.value==="phone"?(a(),u("div",Ns,[l(D,{ref:"phoneFormRef",style:{"max-width":"600px"},model:z.value,"status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:c(()=>[l(o,{label:"phone",prop:"phone"},{default:c(()=>[l(r,{modelValue:z.value.phone,"onUpdate:modelValue":f[3]||(f[3]=N=>z.value.phone=N),modelModifiers:{number:!0},type:"number",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):g.value==="users"?(a(),u("div",Vs,[l(D,{ref:"userFormRef",style:{"max-width":"600px"},model:A.value,"status-icon":"","label-width":"auto",class:"demo-ruleForm"},{default:c(()=>[l(o,{label:"username",prop:"username"},{default:c(()=>[l(r,{modelValue:A.value.username,"onUpdate:modelValue":f[4]||(f[4]=N=>A.value.username=N),type:"text",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])):g.value==="group"?(a(),u("div",Us,[l(we,{class:"flex items-center justify-center",style:{"max-width":"400px"},active:m.value,"finish-status":"success"},{default:c(()=>[l(Ie,{title:"添加联系人"}),l(Ie,{title:"设置群管理"})]),_:1},8,["active"]),m.value===0?(a(),u("div",Rs,[e("div",Gs,[f[18]||(f[18]=e("div",{class:"font-bold mb-2"},"群名称",-1)),l(r,{modelValue:V.value.title,"onUpdate:modelValue":f[5]||(f[5]=N=>V.value.title=N),type:"text",autocomplete:"off"},null,8,["modelValue"])]),e("div",Es,[l(_e,{class:"w-3/5 mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:c(()=>[l(F,{class:me(["w-1/3",{active:U.value==="conSend"}]),type:"primary",plain:"",onClick:f[6]||(f[6]=N=>U.value="conSend")},{default:c(()=>f[19]||(f[19]=[q(" 手动输入 ")])),_:1},8,["class"]),l(F,{class:me(["w-1/3",{active:U.value==="conList"}]),type:"primary",plain:"",onClick:f[7]||(f[7]=N=>U.value="conList")},{default:c(()=>f[20]||(f[20]=[q(" 联系人素材 ")])),_:1},8,["class"]),l(F,{class:me(["w-1/3",{active:U.value==="conMaterial"}]),type:"primary",plain:"",onClick:f[8]||(f[8]=N=>U.value="conMaterial")},{default:c(()=>f[21]||(f[21]=[q(" 联系人列表 ")])),_:1},8,["class"])]),_:1})]),ze(e("div",Fs,[e("div",zs,[f[22]||(f[22]=e("div",{class:"font-bold mb-2"},"邀请联系人",-1)),l(r,{modelValue:V.value.phone,"onUpdate:modelValue":f[9]||(f[9]=N=>V.value.phone=N),rows:7,type:"textarea",placeholder:"注：每行一个联系人信息",autocomplete:"off"},null,8,["modelValue"])])],512),[[dt,U.value==="conSend"]]),ze(e("div",Ps,[e("div",null,[f[24]||(f[24]=e("div",{class:"font-bold mb-2"},"联系人素材",-1)),l(Pe,{ref_key:"conMaterialRef",ref:W,"show-header":!1,data:O.value,style:{width:"100%",height:"353px",border:"1px solid #ddd"},onSelectionChange:ce,onRowClick:Q},{default:c(()=>[l(Le,{type:"selection",width:"55"}),l(Le,null,{default:c(N=>[q(" 昵称："+_(N.row.userName)+" ",1),f[23]||(f[23]=e("br",null,null,-1)),q(" 号码："+_(N.row.phone),1)]),_:1})]),_:1},8,["data"])])],512),[[dt,U.value==="conList"]]),ze(e("div",Bs,[e("div",Hs,[f[26]||(f[26]=e("div",{class:"font-bold mb-2"},"联系人列表",-1)),l(Pe,{ref_key:"conListRef",ref:I,"show-header":!1,data:ue.value,style:{width:"100%",height:"353px",border:"1px solid #ddd"},onSelectionChange:Ge,onRowClick:Re},{default:c(()=>[l(Le,{type:"selection",width:"55"}),l(Le,null,{default:c(N=>[q(" 昵称："+_(N.row.userName?N.row.userName:N.row.firstName??""+N.row.lastName??"")+" ",1),f[25]||(f[25]=e("br",null,null,-1)),q(" 号码："+_(N.row.phone),1)]),_:1})]),_:1},8,["data"])])],512),[[dt,U.value==="conMaterial"]]),e("div",qs,[l(F,{type:"primary",disabled:Ce.value,onClick:P},{default:c(()=>f[27]||(f[27]=[q("下一步")])),_:1},8,["disabled"])])])):ge("",!0),m.value===1?(a(),u("div",Os,[e("div",null,[f[28]||(f[28]=e("div",{class:"font-bold mb-2"},"选择设置的管理员",-1)),e("div",null,[l(S,{modelValue:Y.value,"onUpdate:modelValue":f[10]||(f[10]=N=>Y.value=N),multiple:"",filterable:"","allow-create":"","default-first-option":"","reserve-keyword":!1,placeholder:"请选择设置的管理员",style:{width:"100%"}},{default:c(()=>[(a(!0),u(be,null,$e(ne.value,(N,De)=>(a(),fe(E,{key:De,label:N.phone==null||N.phone==""?N.firstName:N.phone,value:JSON.stringify(N)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),e("div",Ks,[l(F,{type:"primary",onClick:M},{default:c(()=>f[29]||(f[29]=[q("上一步")])),_:1}),l(F,{type:"primary",disabled:Me.value,onClick:R},{default:c(()=>f[30]||(f[30]=[q("完成")])),_:1},8,["disabled"]),l(F,{onClick:K},{default:c(()=>f[31]||(f[31]=[q("取消")])),_:1})])])):ge("",!0)])):ge("",!0),(a(!0),u(be,null,$e(J.value,(N,De)=>(a(),u("div",{key:De,class:"flex items-center justify-between w-4/5 text-cyan-500",style:{border:"1px dashed #ccc"}},[l(t(L),{icon:"bxs:file",style:{"font-size":"22px"}}),l(de,{class:"box-item",effect:"dark",content:N,placement:"bottom"},{default:c(()=>[e("span",Js,_(N),1)]),_:2},1032,["content"]),e("span",{type:"danger",plain:"",onClick:ke=>$(De)},[l(t(L),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,Ws)]))),128)),(a(!0),u(be,null,$e(X.value,(N,De)=>(a(),u("div",{key:De,class:"flex items-center justify-between w-4/5 text-cyan-500",style:{border:"1px dashed #ccc"}},[l(t(L),{icon:"bxs:file",style:{"font-size":"22px"}}),e("span",Qs,_(N.name),1),e("span",{type:"danger",plain:"",onClick:ke=>$(De)},[l(t(L),{icon:"mynaui:delete-solid",class:"hover:text-red-500 cursor-pointer",style:{"font-size":"22px"}})],8,Zs)]))),128))]),_:1},8,["modelValue","title"])}}}),gn=We(fn,[["__scopeId","data-v-7805ead3"]]),mn={class:"col-span-2 mt-1 bg-white rounded-md p-4"},vn={class:"flex justify-between items-center pb-2"},hn={class:"w-1/5"},yn={class:"mb-4 pb-2 h14 w-full",style:{"border-bottom":"1px solid #ccc"}},_n={key:0},In={key:0},bn={key:1},xn={key:2},wn={key:1},Cn={key:2},kn={key:0,class:"flex justify-between items-center mt-4 pt-4 w-full",style:{"border-top":"1px solid #ccc"}},An=Be({__name:"index",props:{currentAccId:{type:Number,required:!0},loginError:{type:String,required:!0}},emits:["contactId","groupId","currCom","currSelectTab"],setup(p,{expose:h,emit:i}){const s=p,g=i;h({getAllContantList:ce});const y=Ne(),v=n("AllContantList"),j=n("dialog"),z=n(!1),x=n(!1);je(()=>v.value,()=>{g("currCom",v.value)}),je(()=>j.value,()=>{g("currSelectTab",j.value)}),je(()=>s.currentAccId,()=>{x.value=!1,s.currentAccId!=-1&&ce()});function A($){$.dialogType==1?(g("contactId",$.userId,$.userName),g("groupId",-1,void 0)):$.dialogType==2&&(g("groupId",$.groupId,$.groupTitle),g("contactId",-1,void 0))}function T(){ce()}function le($){g("groupId",$),g("contactId",-1,void 0)}function ue($){g("groupId",-1),g("contactId",$.userId,$.userName)}const ie=n(!1),O=n([]),B=n([]),W=n([]),b=n("");function ce(){j.value="dialog",zt(),setTimeout(()=>{ie.value=!0;const $={id:s.currentAccId};Pt($).then(G=>{try{G.data.code==201&&(b.value=G.data.message),W.value=[],B.value=[],Array.isArray(G.data.data)?(O.value=G.data.data,O.value.forEach(V=>{V&&V.tgAccountDialog&&(V.tgAccountDialog.userName&&(V.tgAccountDialog.avatar=V.tgAccountDialog.userName.charAt(0).toUpperCase()),V.tgAccountDialog.groupTitle&&(V.tgAccountDialog.avatarG=V.tgAccountDialog.groupTitle.charAt(0).toUpperCase()),V.conMsgDate=Q(s.currentAccId,V.tgAccountDialog.userId,V.tgAccountDialog.groupId),V.color=ye(),V.tgAccountDialog.dialogType===1?W.value.push(V):B.value.push(V))}),O.value.sort((V,U)=>{const I=Me=>Me&&Me.date?new Date(Me.date).getTime():0,m=I(V.lastMsg),ne=I(U.lastMsg),Y=I({date:V.conMsgDate}),Ce=I({date:U.conMsgDate});return Y>0&&Ce===0?-1:Y===0&&Ce>0?1:Y>0&&Ce>0?Ce-Y:ne-m})):O.value=[],x.value=!0}catch(V){console.log(V)}}).catch(G=>{var V;try{console.log("获取联系列表失败:",G),O.value=[],(V=G.response.data)!=null&&V.errorCode&&(b.value=G.response.data.errorMessage)}catch(U){console.log("获取联系列表失败:",U)}}).finally(()=>{ie.value=!1})},200)}function Q($,G,V){return y.getNewMsgDateIntactById($,G,V)}function ae($,G){let V=0;if($!=0?V=O.value.findIndex(U=>U.tgAccountDialog.userId===$):G!=0&&(V=O.value.findIndex(U=>U.tgAccountDialog.groupId===G)),V!==-1){const[U]=O.value.splice(V,1);U&&O.value.unshift(U)}}const ve=n([]),Z=n([]),oe=n("");function Ae(){oe.value?(O.value.forEach($=>{var G,V,U,I;$.tgAccountDialog&&((G=$.tgAccountDialog)!=null&&G.groupTitle&&(V=$.tgAccountDialog)!=null&&V.groupTitle.includes(oe.value)&&ve.value.push($),(U=$.tgAccountDialog)!=null&&U.userName&&(I=$.tgAccountDialog)!=null&&I.userName.includes(oe.value)&&ve.value.push($))}),Z.value=O.value,O.value=ve.value):(ve.value=[],Z.value.length<=0?ce():O.value=Z.value)}function ye(){let U,I,m;do U=Math.floor(Math.random()*360),I=Math.floor(Math.random()*51)+50,m=Math.floor(Math.random()*41)+30;while(I<50||m>70);return`hsl(${U}, ${I}%, ${m}%)`}const he=n(!1);function se(){s.currentAccId!==-1&&(he.value=!0)}function k(){j.value="dialog",O.value.length<=0&&ce()}const C=n(0),te=n(0),J=n(0);function H($){C.value=$}function X($){te.value=$}function re($){J.value=$}return($,G)=>{const V=Ke,U=xt,I=vt;return a(),u(be,null,[e("div",mn,[e("div",vn,[e("div",{class:me(["flex w-4/5 mr-2 border-gray-300 rounded-lg transition-all duration-300 cursor-pointer",{"border-color":z.value}]),style:{border:"1px solid #ccc"},onClick:G[3]||(G[3]=m=>z.value=!0)},[ze(e("input",{type:"text",class:"w-4/5 py-1 pl-4 pr-10 bg-transparent focus:outline-none focus:ring-0 focus:shadow-none",placeholder:"Search...","onUpdate:modelValue":G[0]||(G[0]=m=>oe.value=m),onBlur:G[1]||(G[1]=m=>z.value=!1)},null,544),[[at,oe.value]]),l(V,{plain:"",size:"default",class:"w-1/5 pl-2 flex items-center bg-transparent",onClick:Ae,onBlur:G[2]||(G[2]=m=>z.value=!1)},{default:c(()=>[l(t(L),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})],2),e("div",hn,[l(V,{type:"primary",plain:"",size:"default",disabled:p.currentAccId===-1,onClick:se},{default:c(()=>[l(t(L),{icon:"mingcute:add-fill",style:{"font-size":"22px"}})]),_:1},8,["disabled"])])]),e("div",yn,[l(U,{class:"w-full"},{default:c(()=>[l(V,{class:me(["w-1/2",{active:j.value==="dialog"}]),type:"primary",plain:"",onClick:k},{default:c(()=>[l(t(L),{icon:"ant-design:message-filled",style:{"font-size":"22px"}}),q(" "+_($.$t("im.contact.dialogue")),1)]),_:1},8,["class"]),v.value==="GroupList"?(a(),fe(V,{key:0,class:me(["w-1/2",{active:j.value==="groups"}]),type:"primary",plain:"",onClick:G[4]||(G[4]=m=>j.value="groups")},{default:c(()=>[l(t(L),{icon:"dashicons:groups",style:{"font-size":"22px"}}),G[11]||(G[11]=q(" 我管理的群组 "))]),_:1},8,["class"])):(a(),fe(V,{key:1,class:me(["w-1/2",{active:j.value==="contacts"}]),type:"primary",plain:"",onClick:G[5]||(G[5]=m=>j.value="contacts")},{default:c(()=>[l(t(L),{icon:"mdi:contact",style:{"font-size":"22px"}}),q(" "+_($.$t("im.contact.contacts")),1)]),_:1},8,["class"]))]),_:1})]),e("div",null,[j.value==="dialog"?(a(),u("div",_n,[v.value==="AllContantList"?(a(),u("div",In,[l(It,{currentAccId:s.currentAccId,contantList:O.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:s.loginError,currentComponent:v.value,onContactId:A,onAllMsgCount:H,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae,onRefreshContacts:ce},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])])):v.value==="GroupList"?(a(),u("div",bn,[l(It,{currentAccId:s.currentAccId,contantList:B.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:s.loginError,currentComponent:v.value,onContactId:A,onAllMsgCount:H,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae,onRefreshContacts:ce},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])])):(a(),u("div",xn,[l(It,{currentAccId:s.currentAccId,contantList:W.value,loading:ie.value,isCurAcc:x.value,errMsg:b.value,loginError:s.loginError,currentComponent:v.value,onContactId:A,onAllMsgCount:H,onUserMsgCount:X,onGroupMsgCount:re,onLatestMsg:ae},null,8,["currentAccId","contantList","loading","isCurAcc","errMsg","loginError","currentComponent"])]))])):j.value==="contacts"?(a(),u("div",wn,[l(ws,{currentAccId:s.currentAccId,onMyConId:ue,onRefreshCon:T},null,8,["currentAccId"])])):j.value==="groups"?(a(),u("div",Cn,[l(Ts,{currentAccId:s.currentAccId,onMyGroupId:le,onRefreshGroup:T},null,8,["currentAccId"])])):ge("",!0)]),j.value==="dialog"?(a(),u("div",kn,[l(V,{class:me(["w-2/6",{"is-active":v.value==="AllContantList"}]),type:"primary",plain:"",onClick:G[6]||(G[6]=m=>v.value="AllContantList")},{default:c(()=>[C.value!=0?(a(),fe(I,{key:0,value:C.value,class:"item",offset:[35,-9]},{default:c(()=>G[12]||(G[12]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):ge("",!0),e("div",null,_($.$t("im.contact.all")),1)]),_:1},8,["class"]),l(V,{class:me(["w-2/6",{"is-active":v.value==="ContantList"}]),type:"primary",plain:"",onClick:G[7]||(G[7]=m=>v.value="ContantList")},{default:c(()=>[te.value!=0?(a(),fe(I,{key:0,value:te.value,class:"item",offset:[75,-9]},{default:c(()=>G[13]||(G[13]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):ge("",!0),e("div",null,_($.$t("im.contact.contactList")),1)]),_:1},8,["class"]),l(V,{class:me(["w-2/6",{"is-active":v.value==="GroupList"}]),type:"primary",plain:"",onClick:G[8]||(G[8]=m=>v.value="GroupList")},{default:c(()=>[J.value!=0?(a(),fe(I,{key:0,value:J.value,class:"item",offset:[60,-9]},{default:c(()=>G[14]||(G[14]=[e("div",{class:"h-1 w-1"},null,-1)])),_:1},8,["value"])):ge("",!0),e("div",null,_($.$t("im.contact.gropupList")),1)]),_:1},8,["class"])])):ge("",!0)]),l(gn,{show:he.value,currentAccId:s.currentAccId,onClose:G[9]||(G[9]=m=>he.value=!1),"onUpdate:show":G[10]||(G[10]=m=>he.value=!1),onAnewGet:T},null,8,["show","currentAccId"])],64)}}}),Mn=We(An,[["__scopeId","data-v-edb41186"]]),$n=[{type:"😀",desc:"笑脸",emoji:[{emoji:"😀",title:"嘿嘿"},{emoji:"😃",title:"哈哈"},{emoji:"😄",title:"大笑"},{emoji:"😁",title:"嘻嘻"},{emoji:"😆",title:"斜眼笑"},{emoji:"😅",title:"苦笑"},{emoji:"🤣",title:"笑的满地打滚"},{emoji:"😂",title:"笑哭了"},{emoji:"🙂",title:"呵呵"},{emoji:"🙃",title:"倒脸"},{emoji:"😉",title:"眨眼"},{emoji:"😊",title:"羞涩微笑"},{emoji:"😇",title:"微笑天使"},{emoji:"🥰",title:"喜笑颜开"},{emoji:"😍",title:"花痴"},{emoji:"🤩",title:"崇拜"},{emoji:"😘",title:"飞吻"},{emoji:"😋",title:"好吃"},{emoji:"😛",title:"吐舌"},{emoji:"😜",title:"单眼吐舌"},{emoji:"🤪",title:"滑稽"},{emoji:"😝",title:"滑稽眯眼吐舌"},{emoji:"🤗",title:"抱抱"},{emoji:"🤭",title:"不说"},{emoji:"🤔",title:"想一想"},{emoji:"🤐",title:"闭嘴"},{emoji:"🤨",title:"挑眉"},{emoji:"😐",title:"冷漠"},{emoji:"😑",title:"无语"},{emoji:"😶",title:"沉默"},{emoji:"😏",title:"得意"},{emoji:"😒",title:"不高兴"},{emoji:"🙄",title:"翻白眼"},{emoji:"😬",title:"龇牙咧嘴"},{emoji:"🤥",title:"说谎"},{emoji:"😔",title:"沉默"},{emoji:"😪",title:"困"},{emoji:"🤤",title:"流口水"},{emoji:"😴",title:"睡着了"},{emoji:"😷",title:"感冒"},{emoji:"🤒",title:"发烧"},{emoji:"🤕",title:"受伤"},{emoji:"🤢",title:"恶心"},{emoji:"🤮",title:"呕吐"},{emoji:"🤧",title:"打喷嚏"},{emoji:"🥵",title:"脸发烫"},{emoji:"😵",title:"晕头转向"},{emoji:"🤯",title:"爆炸头"},{emoji:"🤠",title:"牛仔帽"},{emoji:"🥳",title:"聚会笑脸"},{emoji:"😎",title:"墨镜笑脸"},{emoji:"🧐",title:"单片眼睛脸"},{emoji:"😕",title:"困扰"},{emoji:"😟",title:"担心"},{emoji:"🙁",title:"微微不满"},{emoji:"☹",title:"不满"},{emoji:"😮",title:"吃惊"},{emoji:"😲",title:"震惊"},{emoji:"😳",title:"脸红"},{emoji:"🥺",title:"恳求的脸"},{emoji:"😨",title:"害怕"},{emoji:"😰",title:"冷汗"},{emoji:"😥",title:"失望"},{emoji:"😭",title:"哭泣"},{emoji:"😱",title:"吓死了"},{emoji:"😓",title:"汗"},{emoji:"🥱",title:"打哈欠"},{emoji:"😤",title:"傲慢"},{emoji:"😡",title:"怒火中烧"},{emoji:"🤬",title:"嘴上符号"},{emoji:"💩",title:"大便"},{emoji:"🤡",title:"小丑"},{emoji:"👻",title:"鬼"},{emoji:"👽",title:"外星人"}]},{type:"👍",desc:"手势",emoji:[{emoji:"👍",title:"赞同"},{emoji:"👎",title:"反对"},{emoji:"👏",title:"鼓掌"},{emoji:"🙏",title:"祈祷"},{emoji:"👋",title:"挥手"},{emoji:"👍",title:"赞同"},{emoji:"👎",title:"反对"},{emoji:"👏",title:"鼓掌"},{emoji:"🙏",title:"祈祷"},{emoji:"👋",title:"挥手"},{emoji:"👌",title:"ok"},{emoji:"🤏",title:"拿捏"},{emoji:"✌",title:"胜利"},{emoji:"🤞",title:"交叉"},{emoji:"🤙",title:"给我打电话"},{emoji:"👊",title:"出拳"}]},{type:"👨‍👩‍👧‍👦",desc:"家庭",emoji:[{emoji:"👨‍👩‍👧‍👦",title:"家庭"},{emoji:"👨‍👩‍👧",title:"家庭"},{emoji:"👨‍👩‍👦",title:"家庭"},{emoji:"👨‍👩‍👧‍👧",title:"家庭"},{emoji:"👨‍👩‍👦‍👦",title:"家庭"}]},{type:"🍺",desc:"饮料",emoji:[{emoji:"🥤",title:"果汁"},{emoji:"🥢",title:"沙拉"},{emoji:"🍹",title:"鸡尾酒"},{emoji:"🍺",title:"啤酒"},{emoji:"🍻",title:"干杯"}]},{type:"🍎",desc:"食物",emoji:[{emoji:"🍎",title:"苹果"},{emoji:"🍊",title:"橘子"},{emoji:"🍇",title:"葡萄"},{emoji:"🍉",title:"西瓜"},{emoji:"🍓",title:"草莓"},{emoji:"🍒",title:"樱桃"},{emoji:"🍑",title:"桃子"},{emoji:"🍍",title:"菠萝"},{emoji:"🥭",title:"香蕉"},{emoji:"🍏",title:"苹果"},{emoji:"🍆",title:"茄子"},{emoji:"🥦",title:"胡萝卜"},{emoji:"🥬",title:"生菜"},{emoji:"🥕",title:"胡萝卜"},{emoji:"🌽",title:"玉米"},{emoji:"🍄",title:"蘑菇"},{emoji:"🥐",title:"羊角面包"},{emoji:"🥖",title:"法式面包"},{emoji:"🥞",title:"煎饼"},{emoji:"🍳",title:"烤炉"},{emoji:"🍔",title:"汉堡包"},{emoji:"🍟",title:"薯条"},{emoji:"🍕",title:"披萨"},{emoji:"🍝",title:"意大利面"},{emoji:"🍜",title:"面条"},{emoji:"🍲",title:"餐盘"},{emoji:"🍱",title:"便当"},{emoji:"🍣",title:"寿司"},{emoji:"🍤",title:"天妇罗"},{emoji:"🍥",title:"鱼板"},{emoji:"🍦",title:"冰淇淋"},{emoji:"🍨",title:"雪糕"},{emoji:"🍧",title:"冰激凌"}]},{type:"🎁",desc:"装饰",emoji:[{emoji:"🎉",title:"庆祝"},{emoji:"🎊",title:"庆祝"},{emoji:"🎈",title:"气球"},{emoji:"🎁",title:"礼物"},{emoji:"🎄",title:"圣诞树"},{emoji:"🎆",title:"烟花"},{emoji:"🎇",title:"烟花"},{emoji:"🎌",title:"旗帜"},{emoji:"🎓",title:"毕业帽"},{emoji:"🎖",title:"勋章"},{emoji:"🏆",title:"奖杯"},{emoji:"🎲",title:"骰子"},{emoji:"🎯",title:"靶心"},{emoji:"🎰",title:"老虎机"},{emoji:"🎳",title:"保龄球"},{emoji:"🎱",title:"台球"},{emoji:"🎾",title:"网球"}]},{type:"🌛",desc:"地点",emoji:[{emoji:"🌍",title:"地球"},{emoji:"🌎",title:"地球"},{emoji:"🌏",title:"地球"},{emoji:"🌐",title:"地球"},{emoji:"🌛",title:"月亮"},{emoji:"🌙",title:"月亮"},{emoji:"🌟",title:"星星"},{emoji:"🌠",title:"星星"},{emoji:"🌌",title:"银河"},{emoji:"🌅",title:"日出"},{emoji:"🌆",title:"日落"},{emoji:"🌇",title:"黄昏"},{emoji:"🌉",title:"桥梁"},{emoji:"🌊",title:"波浪"},{emoji:"🌴",title:"棕榈树"},{emoji:"🌵",title:"仙人掌"},{emoji:"🌲",title:"树"}]},{type:"🐶",desc:"动物",emoji:[{emoji:"🐶",title:"狗"},{emoji:"🐱",title:"猫"},{emoji:"🐭",title:"老鼠"},{emoji:"🐹",title:"仓鼠"},{emoji:"🐰",title:"兔子"},{emoji:"🦊",title:"狐狸"},{emoji:"🐻",title:"熊"},{emoji:"🐼",title:"熊猫"},{emoji:"🐨",title:"考拉"},{emoji:"🐯",title:"老虎"},{emoji:"🦁",title:"狮子"},{emoji:"🐮",title:"牛"},{emoji:"🐷",title:"猪"},{emoji:"🐸",title:"青蛙"},{emoji:"🐵",title:"猴子"},{emoji:"🐔",title:"鸡"},{emoji:"🐧",title:"企鹅"},{emoji:"🐦",title:"鸟"},{emoji:"🐣",title:"小鸡"},{emoji:"🐥",title:"小鸡"},{emoji:"🐸",title:"青蛙"}]},{type:"🎨",desc:"艺术",emoji:[{emoji:"🎨",title:"调色板"},{emoji:"🎩",title:"帽子"},{emoji:"🎓",title:"毕业帽"},{emoji:"🎭",title:"戏剧"},{emoji:"🎬",title:"电影"},{emoji:"🎤",title:"麦克风"},{emoji:"🎧",title:"耳机"},{emoji:"🎼",title:"小提琴"},{emoji:"🎹",title:"钢琴"},{emoji:"🎵",title:"音乐"},{emoji:"🎶",title:"音乐"},{emoji:"🎧",title:"耳机"},{emoji:"🎤",title:"麦克风"},{emoji:"🎭",title:"戏剧"},{emoji:"🎬",title:"电影"}]},{type:"🔠",desc:"符号",emoji:[{emoji:"📶",title:"信号"},{emoji:"🚮",title:"倒垃圾"},{emoji:"🚰",title:"饮用水"},{emoji:"♿",title:"轮椅"},{emoji:"🚹",title:"男厕"},{emoji:"🚺",title:"女厕"},{emoji:"🚺",title:"女厕"},{emoji:"⚠",title:"危险"},{emoji:"🚫",title:"禁止"},{emoji:"⛔",title:"禁止通行"},{emoji:"🔞",title:"18禁止"},{emoji:"♀",title:"女性"},{emoji:"♂",title:"男性"},{emoji:"♂",title:"男性"}]}],jn={class:"h-full w-full mt-1",style:{border:"1px solid #ccc",height:"21%"}},Sn={class:"h-1/4 w-full text-gray-400 flex items-center",style:{"border-bottom":"1px solid #ccc"}},Dn={for:"file-input"},Ln={key:1,class:"flex mr-2 hover:text-sky-500 cursor-pointer"},Tn=["disabled"],Nn={key:0,class:"mt-4",style:{border:"1px solid #ccc"}},Vn=["src"],Un=["onClick"],Rn={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},Gn={class:"message-input-container"},En=["onKeydown","placeholder"],Fn={key:0},zn={key:1},Pn={class:"mt-4"},Bn={class:"h-6 w-72 overflow-hidden whitespace-nowrap truncate"},Hn={class:"flex mt-4",style:{width:"100%"}},qn={class:"mt-2 flex items-center justify-center h-full",style:{border:"1px solid #ccc"}},On={class:"message-input-container"},Kn=["onKeydown"],Jn={key:1,class:"flex hover:text-sky-500 cursor-pointer"},Wn={class:"flex items-center space-x-4 overflow-x-auto h-10 rounded-lg scrollbar-flex-content",style:{"border-bottom":"1px solid red"}},Qn=["onClick"],Zn={class:"grid grid-cols-12 gap-2 mt-2 ml-2"},Xn=["onClick"],Yn={class:"hover:bg-sky-500 rounded-lg shadow-md p-2"},ea={class:"h-3/4 w-full flex justify-between items-center"},ta={class:"message-input-container"},la=["placeholder","disabled"],oa=Be({__name:"sendMsg",props:{currentAccId:{type:Number,required:!0},currentConId:{type:Number,required:!0},replyId:{type:Number,required:!0},editId:{type:Number,required:!0},editContent:{type:String,required:!0},sendType:{type:String,required:!0},currentGroId:{type:Number,required:!0}},emits:["sendRecordMsg","fakeM","fakeM2","update:msg","vacant","resetScroll"],setup(p,{expose:h,emit:i}){h({sendQueickMsg:A});const s=p,g=i;je(()=>s.editContent,()=>{x.value=s.editContent});const y=n(),v=()=>{y.value&&(y.value.style.height="auto",y.value.style.height=`${y.value.scrollHeight}px`,z())},j=n(),z=()=>{nt(()=>{var S;const E=(S=j.value)==null?void 0:S.$el.querySelector(".el-scrollbar__wrap");E&&(E.scrollTop=E.scrollHeight-E.clientHeight,j.value.setScrollTop(E.scrollTop))})},x=n("");function A(E){x.value=E,T()}function T(){ce.value=!1,ye.value=!1,Ne().setReplyFalse();let E="";ve.value?E=ve.value:k.value&&(E=k.value);const S={currentAccId:s.currentAccId,userId:s.currentConId!==-1?s.currentConId:0,message:x.value+" ",filePath:E!=""?E=="isImg"?".jpg":".txt":"",msgDate:$t(new Date().toString()),groupId:s.currentGroId!==-1?s.currentGroId:0,gMessage:s.currentGroId!==-1?x.value+" ":""};Ne().sendLineMsg(S);const de={currentAccId:s.currentAccId,groupId:s.currentGroId!==-1?s.currentGroId:0,gMessage:s.currentGroId!==-1?x.value+" ":"",msgDate:$t(new Date().toString())};if(Ne().updateLineGroupMessage(de),le.value){Fe.error(i18n.global.t("im.addContant.emptyFile"));return}const d=new FormData;Q.value.forEach((N,De)=>{N instanceof File?d.append("files.FormFiles",N):console.error(`Invalid file object at index ${De}:`,N)}),Y.value.forEach(N=>{d.append("files.UrlFiles",N)}),Ce.value.forEach(N=>{d.append("files.UrlFileTypes",N)}),s.currentGroId!=-1?d.append("ChatId",String(s.currentGroId)):d.append("UserId",String(s.currentConId)),d.append("Id",String(s.currentAccId)),x.value&&d.append("Text",x.value),s.sendType=="reply"&&d.append("ReplyMsgId",String(s.replyId)),s.sendType=="edit"&&d.append("EditMsgId",String(s.editId));const Se={massage:x.value,date:new Date().toISOString(),filePath:ve.value==="isImg"?b.value:null,file:k.value==="isFile"?he.value:null};Y.value.length>0&&(Se.filePath=Y.value),g("fakeM",Se),g("resetScroll"),s.currentGroId!=-1?Cl(d).then(N=>{try{g("update:msg",Se.date,N.data.data.id,1)}catch(De){console.log(De)}}).catch(N=>{console.log("发送消息失败",N),Fe.error("消息发送失败")}):kl(d).then(N=>{try{g("update:msg",Se.date,N.data.data.id,1)}catch(De){console.log(De)}}).catch(N=>{console.log("发送消息失败",N),N.errorCode&&(g("fakeM2"),vl.error(N.errorCode)),Fe.error("消息发送失败")}),oe(),re(),R(),g("vacant")}const le=Ue(()=>he.value&&he.value.size===0),ue=Ue(()=>s.currentConId==null||s.currentConId==null||s.currentConId==-1),ie=Ue(()=>s.currentGroId==null||s.currentGroId==null||s.currentGroId==-1),O=Ue(()=>ue.value&&ie.value);function B(){O.value||x.value!=""&&T()}const W=E=>{E.key==="Enter"&&(E.shiftKey?(E.preventDefault(),x.value+=`
`):!O.value&&x.value.trim()!==""&&T())},b=n([]),ce=n(!1),Q=n([]),ae=n(),ve=n(""),Z=E=>{const S=E.target.files;if(S.length>0)for(let de=0;de<S.length;de++){const d=S[de];Q.value.push(d),ve.value="isImg";const Se=new FileReader;Se.onloadend=()=>{typeof Se.result=="string"&&b.value.push(Se.result),de===S.length-1&&(ce.value=!0)},Se.readAsDataURL(d)}};function oe(){ce.value=!1,Q.value=[],b.value=[],x.value="",ae.value.value="",ve.value=""}const Ae=E=>{b.value.splice(E,1),Q.value.splice(E,1)},ye=n(!1),he=n(),se=n(),k=n(""),C=n("storage");function te(){ye.value=!0}function J(E,S){Q.value=[],he.value=[];for(const de of S)if(de.raw){const d=de.raw;Q.value.push(d),he.value.push(d)}k.value="isFile"}function H(E,S){se.value.clearFiles(),Q.value=[],he.value=null,k.value=""}const X=E=>{console.log("文件 ",E)},re=()=>{ye.value=!1,he.value=null,Q.value=[],x.value="",k.value="",G.value="",m.value=""};je(()=>ye.value,()=>{ye.value===!0&&(R(),U(),ne())});const $=n([]),G=n("");function V(E){return E.substring(E.lastIndexOf("/")+1)}function U(){ql().then(E=>{try{$.value=E.data.data.data.map(S=>({value:S.fileName,label:V(S.fileName)}))}catch(S){console.log(S)}}).catch(E=>{console.log("资源库获取失败",E)})}const I=n([]),m=n("");function ne(){Kt({GroupId:0}).then(S=>{try{I.value=S.data.data.data.map(de=>({value:de.filePath,label:de.name}))}catch(de){console.log(de)}}).catch(S=>{console.log("查询文件失败",S)}).finally(()=>{})}const Y=n([]),Ce=n([]),Me=n(Y.value.map(()=>"file"));je(()=>Y.value,()=>{Me.value=Y.value.map((E,S)=>S<Me.value.length?Me.value[S]:"file")},{deep:!0});const xe=n(""),He=n([{value:"file",label:"文件"},{value:"image",label:"图片"}]);function Te(E){let S="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/"+E;Y.value.push(S),Ce.value.push("file")}function Ge(E){let S="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/"+E;Y.value.push(S),Ce.value.push("file")}function Re(E,S){Ce.value.forEach((de,d)=>{d===S&&Ce.value.splice(d,1,E)})}function P(E){Ce.value.splice(E,1),Y.value.splice(E,1)}function M(){if(xe.value.startsWith("http://")||xe.value.startsWith("https://")){Y.value.push(xe.value),Ce.value.push(xe.value),xe.value="";return}Fe.warning("请输入正确的URL地址"),xe.value=""}function R(){Y.value=[],Ce.value=[],xe.value="",G.value="",m.value="",Me.value=[]}function K(){ye.value=!1}function w(){T()}const f=n(!0);function F(){f.value=!f.value}function _e(){f.value=!0}function r(E){E.target.closest("#emoji-input")||E.target.closest('label[for="emoji-label"]')||_e()}const o=n($n),D=n(0),Ie=n(!1),we=Ue(()=>{const E=o.value[D.value];return E||{emoji:[]}});function Le(E){D.value=E}function Pe(E){x.value=x.value?`${x.value} ${E}`:E,_e(),y.value.focus()}return ot(()=>{s.editContent!==""&&(x.value=s.editContent),document.addEventListener("click",r)}),pt(()=>{document.removeEventListener("click",r)}),(E,S)=>{const de=ht,d=tt,Se=Xe,N=Ke,De=xt,ke=Jt,Qe=ft,st=gt,_t=Wt,ee=ut;return a(),u("div",jn,[e("div",Sn,[e("div",null,[e("label",Dn,[t(O)?(a(),fe(de,{key:0,content:"请选择群组或联系人",placement:"top"},{default:c(()=>[e("div",{class:me(["flex mr-2",{"cursor-not-allowed opacity-50":t(O)}])},[l(t(L),{icon:"line-md:image-filled",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(E.$t("im.addContant.image")),1)],2)]),_:1})):(a(),u("div",Ln,[l(t(L),{icon:"line-md:image-filled",class:"ml-2",style:{"font-size":"22px"}}),e("span",null,_(E.$t("im.addContant.image")),1)]))]),e("input",{ref_key:"imgInputRef",ref:ae,id:"file-input",type:"file",accept:"image/*",multiple:"",onChange:Z,style:{display:"none"},disabled:t(O)},null,40,Tn),l(Se,{modelValue:t(ce),"onUpdate:modelValue":S[1]||(S[1]=pe=>Ve(ce)?ce.value=pe:null),title:"Send an Image",width:"500"},{default:c(()=>[t(b).length>0?(a(),u("div",Nn,[(a(!0),u(be,null,$e(t(b),(pe,Ee)=>(a(),u("div",{key:Ee,class:"mb-2 relative"},[e("img",{src:pe,alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,Vn),e("button",{onClick:qe=>Ae(Ee),class:"absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded"},"X",8,Un)]))),128))])):ge("",!0),e("div",Rn,[e("div",Gn,[l(d,{class:"scrollbar",height:100},{default:c(()=>[ze(e("textarea",{ref_key:"messageInput",ref:y,"onUpdate:modelValue":S[0]||(S[0]=pe=>Ve(x)?x.value=pe:null),onInput:v,onKeydown:it(Ze(T,["prevent"]),["enter"]),placeholder:E.$t("btn.inputSearch"),class:"message-input"},null,40,En),[[at,t(x)]])]),_:1})]),e("div",{class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:T},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])])]),_:1},8,["modelValue"])]),e("div",null,[t(O)?(a(),fe(de,{key:0,content:"请选择群组或联系人",placement:"top"},{default:c(()=>[e("div",{class:me(["flex",{"cursor-not-allowed opacity-50":t(O)}])},[l(t(L),{icon:"mingcute:file-fill",style:{"font-size":"22px"}}),e("span",null,_(E.$t("im.addContant.file")),1)],2)]),_:1})):(a(),u("div",{key:1,class:"flex hover:text-sky-500 cursor-pointer",onClick:te},[l(t(L),{icon:"mingcute:file-fill",style:{"font-size":"22px"}}),e("span",null,_(E.$t("im.addContant.file")),1)])),l(Se,{modelValue:t(ye),"onUpdate:modelValue":S[8]||(S[8]=pe=>Ve(ye)?ye.value=pe:null),title:"发送文件",width:"600",onClose:K},{default:c(()=>[l(De,{class:"w-full mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:c(()=>[l(N,{class:me(["w-1/2",{active:t(C)==="local"}]),type:"primary",plain:"",onClick:S[2]||(S[2]=pe=>C.value="local")},{default:c(()=>[l(t(L),{icon:"mdi:local-area-network",style:{"font-size":"22px"}}),S[13]||(S[13]=q(" 从本地发送图片 "))]),_:1},8,["class"]),l(N,{class:me(["w-1/2",{active:t(C)==="storage"}]),type:"primary",plain:"",onClick:S[3]||(S[3]=pe=>C.value="storage")},{default:c(()=>[l(t(L),{icon:"material-symbols:storage-rounded",style:{"font-size":"22px"}}),S[14]||(S[14]=q(" 从存储资源发送图片 "))]),_:1},8,["class"])]),_:1}),t(C)==="local"?(a(),u("div",Fn,[l(ke,{ref_key:"uploadRef",ref:se,class:"upload-demo w-full","file-list":t(Q),"auto-upload":!1,"on-preview":X,"on-remove":H,"on-change":J,multiple:!0,limit:10,drag:""},{default:c(()=>[l(t(L),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),S[15]||(S[15]=e("div",{class:"el-upload__text"},[q(" 请"),e("em",null,"点击或拖拽"),q("上传文件 ")],-1))]),_:1},8,["file-list"])])):ge("",!0),t(C)==="storage"?(a(),u("div",zn,[l(st,{modelValue:t(G),"onUpdate:modelValue":S[4]||(S[4]=pe=>Ve(G)?G.value=pe:null),clearable:"",placeholder:"从聊天记录文件中选择",style:{width:"50%"},filterable:"",onChange:Te},{default:c(()=>[(a(!0),u(be,null,$e(t($),pe=>(a(),fe(Qe,{key:pe.value,label:pe.label,value:pe.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(st,{"element-loading-text":"正在获取资料库...",modelValue:t(m),"onUpdate:modelValue":S[5]||(S[5]=pe=>Ve(m)?m.value=pe:null),clearable:"",placeholder:"从素材库中选择",style:{width:"50%"},filterable:"",onChange:Ge},{default:c(()=>[(a(!0),u(be,null,$e(t(I),pe=>(a(),fe(Qe,{key:pe.value,label:pe.label,value:pe.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e("div",Pn,[(a(!0),u(be,null,$e(t(Y),(pe,Ee)=>(a(),u("div",{key:Ee,class:"flex items-center justify-between mt-0.5 p-0.5",style:{border:"1px dashed #ccc"}},[l(_t,{type:"primary",size:"large"},{default:c(()=>S[16]||(S[16]=[q("文件")])),_:1}),l(de,{class:"box-item",effect:"dark",content:pe,placement:"bottom"},{default:c(()=>[e("span",Bn,_(pe),1)]),_:2},1032,["content"]),e("div",null,[l(st,{modelValue:t(Me)[Ee],"onUpdate:modelValue":qe=>t(Me)[Ee]=qe,clearable:"",placeholder:"选择类型",style:{width:"100px"},filterable:""},{default:c(()=>[(a(!0),u(be,null,$e(t(He),qe=>(a(),fe(Qe,{key:qe.value,label:qe.label,value:qe.value,onClick:ic=>Re(qe.value,Ee)},null,8,["label","value","onClick"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"]),l(N,{type:"danger",class:"ml-2",onClick:qe=>P(Ee)},{default:c(()=>[l(t(L),{icon:"ic:baseline-delete",style:{"font-size":"22px"}})]),_:2},1032,["onClick"])])]))),128))]),e("div",Hn,[l(ee,{modelValue:t(xe),"onUpdate:modelValue":S[6]||(S[6]=pe=>Ve(xe)?xe.value=pe:null),placeholder:"手动添加一条图片URL (需要以http/https开头)",clearable:"",style:{width:"88%"}},null,8,["modelValue"]),l(N,{type:"primary",class:"ml-2",onClick:M},{default:c(()=>[l(t(L),{icon:"mingcute:add-fill",style:{"font-size":"22px"}})]),_:1})])])):ge("",!0),e("div",qn,[e("div",On,[l(d,{class:"scrollbar",height:100},{default:c(()=>[ze(e("textarea",{"onUpdate:modelValue":S[7]||(S[7]=pe=>Ve(x)?x.value=pe:null),onInput:v,onKeydown:it(Ze(w,["prevent"]),["enter"]),placeholder:"请输入发送信息",ref_key:"messageInput",ref:y,class:"message-input"},null,40,Kn),[[at,t(x)]])]),_:1})]),e("div",{class:"flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",style:{"border-left":"1px solid #ccc"},onClick:w},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})])])]),_:1},8,["modelValue"])]),e("div",{class:"ml-2 relative",onClick:r},[e("label",{for:"emoji-label",onClick:Ze(F,["stop"])},[t(O)?(a(),fe(de,{key:0,content:"请选择群组或联系人",placement:"top"},{default:c(()=>[e("div",{class:me(["flex",{"cursor-not-allowed opacity-50":t(O)}])},[l(t(L),{icon:"mingcute:emoji-fill",style:{"font-size":"22px"}}),S[17]||(S[17]=e("span",null,"表情",-1))],2)]),_:1})):(a(),u("div",Jn,[l(t(L),{icon:"mingcute:emoji-fill",style:{"font-size":"22px"}}),S[18]||(S[18]=e("span",null,"表情",-1))]))]),!t(O)&&!t(f)?(a(),u("div",{key:0,id:"emoji-input",class:"absolute bottom-10 -left-32 h-64 bg-white border border-gray-300 rounded-lg shadow-lg z-10",style:{width:"580px"},onClick:S[11]||(S[11]=Ze(()=>{},["stop"]))},[e("div",Wn,[(a(!0),u(be,null,$e(t(o),(pe,Ee)=>(a(),u("div",{key:Ee,class:me(["flex-shrink-0 rounded-lg px-2 py-1 ml-2",{"bg-sky-500 text-white":t(D)===Ee}]),onClick:qe=>Le(Ee),onMouseover:S[9]||(S[9]=qe=>Ie.value=!0),onMouseleave:S[10]||(S[10]=qe=>Ie.value=!1),style:Je({cursor:t(Ie)?"pointer":"default"})},_(pe.type),47,Qn))),128))]),l(d,{style:{height:"calc(100% - 40px)"}},{default:c(()=>[e("div",Zn,[(a(!0),u(be,null,$e(t(we).emoji,(pe,Ee)=>(a(),u("div",{key:Ee,class:"flex items-center justify-center cursor-pointer",onClick:qe=>Pe(pe.emoji)},[l(de,{class:"box-item",effect:"dark",content:pe.title,placement:"top"},{default:c(()=>[e("div",Yn,_(pe.emoji),1)]),_:2},1032,["content"])],8,Xn))),128))])]),_:1})])):ge("",!0)])]),e("div",ea,[e("div",ta,[l(d,{ref_key:"scrollTextRef",ref:j,class:"scrollbar",height:100},{default:c(()=>[ze(e("textarea",{"onUpdate:modelValue":S[12]||(S[12]=pe=>Ve(x)?x.value=pe:null),onInput:v,onKeydown:W,placeholder:E.$t("btn.inputSearch"),ref_key:"messageInput",ref:y,class:me(["message-input",{"cursor-not-allowed opacity-50":t(O)}]),disabled:t(O)},null,42,la),[[at,t(x)]])]),_:1},512)]),e("div",{class:me(["flex items-center justify-center text-sky-500 bg-white h-full w-1/6 hover:bg-sky-500 hover:text-white cursor-pointer transition duration-300 ease-in-out",{"cursor-not-allowed opacity-50":t(O)}]),style:{"border-left":"1px solid #ccc"},onClick:B},[l(t(L),{icon:"cib:telegram-plane",style:{"font-size":"32px"}})],2)])])}}}),sa=We(oa,[["__scopeId","data-v-ab5ee889"]]),na="/tg-yk-online/assets/tgChat-C3m2x06y.png",aa={key:0,class:"flex flex-row-reverse mb-4"},ia={class:"relative"},ra={class:"w-8 h-8 rounded-full bg-cyan-200 mr-2 mb-1"},ca={class:"text-xl text-white w-full h-full flex justify-center items-center"},ua={class:"flex items-end justify-end mb-3 absolute left-0 bottom-0"},da={key:0},pa={key:1},fa={class:"flex flex-row"},ga={class:"w-full flex flex-col items-end mr-2"},ma=["id","onContextmenu"],va={class:"whitespace-normal"},ha={key:0},ya={key:0},_a=["data"],Ia=["data"],ba={key:1},xa=["innerHTML"],wa={key:2,class:"flex items-center"},Ca={class:"flex w-full"},ka={key:1},Aa={key:0},Ma={key:0,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},$a={class:"rounded-full p-2 mx-4 bg-sky-500"},ja={key:1},Sa=["src","onClick"],Da={key:1},La={key:0},Ta=["src","onClick"],Na={key:1},Va=["src","onClick"],Ua={key:2},Ra={key:3,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},Ga=["href"],Ea={class:"rounded-full p-2 mx-4 bg-sky-500"},Fa=["innerHTML"],za={key:2,class:"flex items-center",style:{height:"20px"}},Pa={class:"flex w-full"},Ba={class:"flex justify-between w-full"},Ha={class:"text-sky-500 font-bold text-xs"},qa={class:"text-gray-500 font-bold text-xs ml-3 mr-2"},Oa={key:1,class:"flex mt-4"},Ka={class:"relative"},Ja={class:"w-8 h-8 rounded-full bg-cyan-200 ml-4 -mt-1"},Wa={class:"text-xl text-white flex justify-center items-center"},Qa={key:0,class:"flex items-end justify-end -ml-4 mb-3 w-12 absolute right-0 bottom-0"},Za={class:"flex flex-row"},Xa={class:"w-full flex flex-col items-start ml-2"},Ya=["id","onContextmenu"],ei={class:"whitespace-normal"},ti={key:0},li=["innerHTML"],oi={key:0,class:"flex items-center"},si={class:"flex w-full"},ni={key:1},ai={key:0},ii={key:0,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},ri=["href"],ci={class:"rounded-full p-2 mx-4 bg-sky-500"},ui={key:1},di=["src","onClick"],pi=["innerHTML"],fi={key:1},gi={key:0},mi=["src","onClick"],vi={key:1},hi=["src","onClick"],yi={key:2},_i={key:3,class:"pb-2 mb-2 h-12 w-full flex items-center",style:{"border-bottom":"1px solid #ccc"}},Ii=["href"],bi={class:"rounded-full p-2 mx-4 bg-sky-500"},xi=["innerHTML"],wi={class:"flex justify-between w-full"},Ci={class:"text-gray-500 font-bold text-xs ml-3 mr-2"},ki={class:"text-sky-500 font-bold text-xs"},Ai={key:0,class:"bg-gray-100 relative h-screen",style:{height:"7vh"}},Mi={class:"absolute -bottom-1 left-0 w-full h-16 bg-white",style:{border:"1px solid #ccc"}},$i={class:"flex items-center justify-center h-full",style:{border:"1px solid red"}},ji={class:"w-1/12 ml-4 flex items-center justify-center"},Si={class:"w-10/12 items-center justify-center"},Di={class:"text-sky-500"},Li={key:0},Ti={key:1},Ni={key:0},Vi={class:"rounded-full py-1 px-2 mx-10 bg-sky-500 flex items-center"},Ui={class:"w-full truncate cursor-pointer hover:text-sky-500"},Ri={class:"rounded-full py-1 px-2 mx-10 flex items-center"},Gi=["src"],Ei={class:"w-full truncate cursor-pointer hover:text-sky-500"},Fi={key:1},zi={class:"rounded-full py-1 px-2 mx-10 flex items-center"},Pi={class:"flex items-center"},Bi=["src"],Hi={class:"w-full truncate cursor-pointer hover:text-sky-500"},qi={class:"rounded-full py-1 px-2 mx-10 h-8 bg-sky-500 flex items-center"},Oi={class:"truncate"},Ki={class:"w-full truncate cursor-pointer hover:text-sky-500"},Ji={viewBox:"0 0 80 20",xmlns:"http://www.w3.org/2000/svg",style:{display:"none"}},Wi={class:"mx-auto max-w-full"},Qi=["src"],Zi={class:"dialog-footer"},Xi={style:{float:"left"}},Yi={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},er={class:"dialog-footer"},tr={class:"dialog-footer"},lr=Be({__name:"contantChat",props:["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName","isHistory"],emits:["messageId","editMessage","lazyLoad","translate","delMessage","historyLazyLoad"],setup(p,{expose:h,emit:i}){const s=p,g=i;h({resetScrollPosition:Me}),je(()=>[s.currentConId,s.currentGroId],()=>{m.value=1,ne(),Me()});const y=n([]),v=n([]);je(()=>s.conChatList,()=>{s.conChatList.length>0&&(y.value=s.conChatList,s.conChatList.forEach(r=>{v.value.push(r.msgId)}))}),je([()=>s.currentAccId,()=>s.currentConId,()=>s.currentGroId],()=>{y.value=[],v.value=[]});const j="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/",z=n(""),x=n(""),A=n(""),T=n(""),le=n(""),ue=n(!1),ie=n(!1),O=n(""),B=n(""),W=n(!1),b=n();function ce(r,o){r.preventDefault();const D=[{label:Ye.global.t("im.chat.replyMessage"),svgIcon:"#charm--reply",onClick:()=>{r.target instanceof HTMLElement&&"dataset"in r.target&&console.log("当前消息的信息1",r,o,r.target.dataset.id),T.value=o.filePath,le.value=o.file,ue.value=o.isRead,ie.value=o.sender,o.filePath===null&&o.file===null?(z.value=o.message,x.value="",A.value=""):z.value=o.message,o.filePath&&(x.value=o.filePath,A.value=""),o.file&&(A.value=o.file.name,x.value=""),Ne().setReplyIndex(o.id),Ne().setReplyTrue(),g("messageId","right",o.msgId,o.filePath,o.file,o.isRead)}},{label:Ye.global.t("im.chat.editMessage"),svgIcon:"#iconamoon--edit-fill",onClick:()=>{g("editMessage",o.msgId,o.message)}},{label:Ye.global.t("im.chat.deleteMessage"),svgIcon:"#icon-multiply",onClick:()=>{Q.value=o.msgId,oe.value=!0}},{label:"消息转发",svgIcon:"#basil--forward-solid",onClick:()=>{W.value=!0,b.value=o,$()}}];o.translateText||D.push({label:Ye.global.t("im.chat.translationMessage"),svgIcon:"#dashicons--translation",onClick:()=>{console.log("翻译",o),O.value=o.msgId,B.value=o.message,se.value=!0}}),rt.showContextMenu({x:r.x,y:r.y,theme:"mac",items:D})}const Q=n("");function ae(r,o){r.preventDefault();const D=[{label:Ye.global.t("im.chat.replyMessage"),svgIcon:"#charm--reply",onClick:()=>{T.value=o.filePath,le.value=o.file,ue.value=o.isRead,ie.value=o.sender,o.filePath===null&&o.file===null?(z.value=o.message,x.value="",A.value=""):z.value=o.message,o.filePath&&(x.value=o.filePath,A.value=""),o.file&&(A.value=o.file,x.value=""),Ne().setReplyIndex(o.id),Ne().setReplyTrue(),g("messageId","left",o.msgId,o.filePath)}},{label:Ye.global.t("im.chat.deleteMessage"),svgIcon:"#icon-multiply",onClick:()=>{Q.value=o.msgId,oe.value=!0}},{label:"消息转发",svgIcon:"#basil--forward-solid",onClick:()=>{W.value=!0,b.value=o,$()}}];o.translateText||D.push({label:Ye.global.t("im.chat.translationMessage"),svgIcon:"#dashicons--translation",onClick:()=>{console.log("翻译",o),O.value=o.msgId,B.value=o.message,se.value=!0}}),rt.showContextMenu({x:r.x,y:r.y,theme:"mac",items:D})}function ve(){Ne().setReplyFalse()}function Z(){const r=Ne().index;nt(()=>{const o=`${r}`,D=document.getElementById(o);D&&D.scrollIntoView({behavior:"smooth",block:"center"})})}const oe=n(!1),Ae=n(!0);function ye(){oe.value=!1;const r={id:s.currentAccId,userId:s.currentConId,msgId:Q.value,revoke:Ae.value};Al(r).then(o=>{g("delMessage",Q.value),Fe({type:"success",message:"Delete successfully"})}).catch(o=>{console.log("删除消息失败",o)}),he()}function he(){oe.value=!1,Ae.value=!1}const se=n(!1),k=n("zh"),C=n(Qt);function te(){se.value=!1;const r={id:s.currentAccId,user_id:s.currentConId,msg_id:O.value,msg:B.value,to_lang:k.value};Ml(r).then(o=>{try{g("translate",O.value,o.data.data.newMsg)}catch(D){console.log(D)}}).catch(o=>{console.log("翻译失败",o)}),J()}function J(){se.value=!1}const H=n(""),X=n(),re=n([]);function $(){const r={id:s.currentAccId};Pt(r).then(o=>{if(re.value=o.data.data.map(D=>({...D,label:D.tgAccountDialog.groupId!=null?D.tgAccountDialog.groupTitle:D.tgAccountDialog.userName})),b.value){const D=o.data.data.find(Ie=>{var we;return Ie.tgAccountDialog.userId==((we=b.value)==null?void 0:we.toUserId)});X.value=D.tgAccountDialog.userHash}}).catch(o=>{console.log(o)})}function G(){var o,D,Ie,we,Le,Pe,E,S;const r=JSON.parse(H.value);if(b.value){const de=new FormData;de.append("Id",String(s.currentAccId)),de.append("MsgIds",String((o=b.value)==null?void 0:o.msgId)),(D=b.value)!=null&&D.formChatId&&de.append("FormChatId",String((Ie=b.value)==null?void 0:Ie.formChatId)),(we=b.value)!=null&&we.toUserId&&(de.append("FromPeerId",String((Le=b.value)==null?void 0:Le.toUserId)),de.append("FromPeerHash",String(X.value))),r.tgAccountDialog.groupId!=null?de.append("ToChatId",String(r.tgAccountDialog.groupId)):(de.append("ToPeerId",String(r.tgAccountDialog.userId)),de.append("ToPeerHash",String(r.tgAccountDialog.userHash))),de.append("Msg",(Pe=b.value)==null?void 0:Pe.message),de.append("FilePath",(E=b.value)==null?void 0:E.filePath),de.append("TranslateMsg",(S=b.value)==null?void 0:S.translateText),$l(de).then(d=>{console.log("发送转发消息成功",d),Fe.success("消息发送成功")}).catch(d=>{console.log("发送消息失败",d),Fe.error("消息发送失败")}),V()}}function V(){W.value=!1,H.value=""}const U=n(null),I=n(!1),m=n(1),ne=()=>{nt(()=>{if(U.value){const r=U.value.$el.querySelector(".el-scrollbar__wrap");if(r)try{r.scrollTop=r.scrollHeight-r.clientHeight,U.value.setScrollTop(r.scrollTop)}catch(o){console.log("滚动到底部失败",o)}}})};je([()=>s.conChatList],([])=>{I.value?(I.value=!1,nt(()=>{if(U.value){const r=U.value.$el.querySelector(".el-scrollbar__wrap");r&&(Y.value=r.scrollHeight-r.scrollTop-r.clientHeight,r.scrollTop=r.scrollHeight-Y.value)}})):ne()},{deep:!0}),je(()=>Ne().showReply,r=>{r||ne()});const Y=n(0),Ce=()=>{nt(()=>{if(U.value){const r=U.value.$el.querySelector(".el-scrollbar__wrap");r&&r.scrollTop===0&&(console.log("滚动到顶部",r.scrollTop),s.conChatList.length<s.totalPages&&(I.value=!0,m.value++,s.isHistory?(console.log("懒加载历史11111",s.conChatList.length<s.totalPages),g("historyLazyLoad",m.value)):(console.log("懒加载22222",s.conChatList.length<s.totalPages),g("lazyLoad",m.value))))}})};function Me(){Y.value=0}je(()=>s.currentConId,()=>{Me()});function xe(r,o){if(r){if(r.startsWith("http://")||r.startsWith("https://"))return"networkImg";if(r=="账号异常，文件保存失败！")return"error";const D=r.lastIndexOf(".");if(D!==-1){const we=r.substring(D+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(we))return"image"}let Ie=-1;return o===!0?Ie=r.lastIndexOf("-"):Ie=r.lastIndexOf("/"),Ie!==-1?r.substring(Ie+1):""}}function He(r){if(r){if(r=="账号异常，文件保存失败！")return"error";const o=r.lastIndexOf(".");if(o!==-1){const D=r.substring(o+1).toLowerCase();return["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(D)?"image":"file"}}}function Te(r){const o=s.conChatList;for(let D of o)if(D.msgId===r)return D.filePath;return null}function Ge(r){const o=s.conChatList;for(let D of o)if(D.msgId===r)return D.message;return null}const Re=n(!1),P=n(""),M=r=>{P.value=r,Re.value=!0},R=()=>{Re.value=!1},K=r=>{if(r){const o=URL.createObjectURL(r),D=document.createElement("a");D.href=o,D.download=r.name,D.click(),URL.revokeObjectURL(o)}};function w(r){if(r)return r.startsWith(j)?r:j+r}function f(r){if(r)return r.replace(/\r\n|\r|\n/g,"<br>")}const F=n(""),_e=r=>{const o=JSON.parse(r);o.type===Oe.TranslationSuccessful&&(F.value=o.TranslateText,y.value.forEach(D=>{D.msgId===o.msg_id&&D.accountId===o.accountId&&(D.toUserId===o.formUserId||D.formUserId===o.formUserId)&&(D.translateText=o.TranslateText)}))};return et.on("updateNotice",_e),pt(()=>{et.off("updateNotice",_e)}),ot(()=>{ne()}),(r,o)=>{const D=el,Ie=Yt,we=Bt,Le=Ke,Pe=Xe,E=ft,S=gt,de=ct;return a(),u(be,null,[e("div",{class:"bg-gray-100 h-screen",style:Je({height:("useImStore"in r?r.useImStore:t(Ne))().showReply?"55vh":"63vh"})},[ze((a(),fe(t(tt),{ref_key:"scrollRef",ref:U,"element-loading-background":"rgba(122, 122, 122, 0.1)","element-loading-text":"消息内容加载状态...",onScroll:Ce,style:Je({height:("useImStore"in r?r.useImStore:t(Ne))().showReply?"55vh":"63vh","background-image":`url(${t(na)})`,"background-size":"cover","background-repeat":"no-repeat"})},{default:c(()=>[(a(!0),u(be,null,$e(t(y),(d,Se)=>{var N,De;return a(),u("div",{key:d.id},[d.sender===!0?(a(),u("div",aa,[e("div",ia,[e("div",ra,[e("div",ca,[e("span",null,_(s.currentAccName.charAt(0)),1)])]),e("div",ua,[d.sendFailed?(a(),u("div",da,[l(t(L),{icon:"material-symbols:error-outline",class:"text-red-500",style:{"font-size":"22px"}})])):(a(),u("div",pa,[d.status===3?(a(),fe(t(L),{key:0,icon:"ion:checkmark-done-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):d.status===0?(a(),fe(t(L),{key:1,icon:"ion:ellipsis-horizontal-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):(a(),fe(t(L),{key:2,icon:"ion:checkmark-sharp",style:{"font-size":"22px"}}))]))])]),e("div",fa,[e("div",ga,[e("div",{id:`${d.id}`,class:"max-w-md bg-white p-3 border border-gray-300 rounded-lg",onContextmenu:ke=>ce(ke,d)},[e("div",va,[d.filePath===null&&(d.file===null||d.file===void 0)?(a(),u("div",ha,[d.isRead===!1?(a(),u("span",ya,[d.replyToMsgId!=null&&String(d.existFilePath)=="image"?(a(),u("div",{key:0,class:"h-7 w-full pl-2 mb-2",data:`${d.existFile}`,style:{"border-left":"4px solid #ccc"},onClick:Z}," [图片] ",8,_a)):d.replyToMsgId!=null&&String(d.existFile)=="file"?(a(),u("div",{key:1,class:"h-7 w-full pl-2 mb-2",data:`${d.existFilePath}`,style:{"border-left":"4px solid #ccc"},onClick:Z}," [文件] ",8,Ia)):d.replyToMsgId!=null?(a(),u("div",{key:2,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z},_(Ge(d.replyToMsgId)),1)):ge("",!0)])):(a(),u("span",ba,[d.replyToMsgId!=null&&He(Te(d.replyToMsgId))==="image"?(a(),u("div",{key:0,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z}," [图片] ")):d.replyToMsgId!=null&&He(Te(d.replyToMsgId))==="file"?(a(),u("div",{key:1,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z}," [文件] ")):d.replyToMsgId!=null&&d.filePath==null?(a(),u("div",{key:2,class:"h-7 w-full pl-2 mb-2",style:{"border-left":"4px solid #ccc"},onClick:Z},_(Ge(d.replyToMsgId)),1)):ge("",!0)])),e("p",{innerHTML:f(d.message)},null,8,xa),d.translateText?(a(),u("div",wa,[e("div",Ca,[l(Ie,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:c(()=>[l(D,{name:d.msgId,icon:"null"},{title:c(()=>[l(t(L),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:c(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):ge("",!0)])):(a(),u("div",ka,[d.isRead===!1?(a(),u("span",Aa,[d.file?(a(),u("div",Ma,[e("div",$a,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl",onClick:ke=>K(d.file)},null,8,["onClick"])]),e("p",null,_(d.file.name),1)])):(a(),u("div",ja,[(a(!0),u(be,null,$e(d.filePath,(ke,Qe)=>(a(),u("div",{key:Qe,class:"mb-2 relative"},[e("img",{src:ke,onClick:st=>M(ke),alt:"Selected Image",class:"h-48 w-full object-contain"},null,8,Sa)]))),128))]))])):(a(),u("span",Da,[xe(d.filePath,d.sender)==="image"?(a(),u("div",La,[e("img",{"data-id":23333,src:w(d.filePath),onClick:ke=>M(w(d.filePath)),class:"h-48 w-full object-contain"},null,8,Ta)])):xe(d.filePath,d.sender)==="networkImg"?(a(),u("div",Na,[e("img",{src:`${d.filePath}`,onClick:ke=>M(d.filePath),class:"h-48 w-full object-contain"},null,8,Va)])):xe(d.filePath,d.sender)==="error"?(a(),u("div",Ua)):(a(),u("div",Ra,[e("div",null,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",Ea,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(xe(d.filePath,d.sender)),1)],8,Ga)])]))])),e("p",{innerHTML:f(d.message)},null,8,Fa),d.translateText?(a(),u("div",za,[e("div",Pa,[l(Ie,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:c(()=>[l(D,{name:d.msgId,icon:"null"},{title:c(()=>[l(t(L),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:c(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):ge("",!0)]))])],40,ma),e("div",Ba,[e("div",Ha,_((N=d.date)==null?void 0:N.replace("T","")),1),e("div",qa,_(s.currentName),1)])])])])):(a(),u("div",Oa,[e("div",Ka,[e("div",Ja,[e("div",Wa,_(s.currentName.charAt(0)),1)]),p.currentGroId==-1?(a(),u("div",Qa,[d.status===3?(a(),fe(t(L),{key:0,icon:"ion:checkmark-done-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):d.status===0?(a(),fe(t(L),{key:1,icon:"ion:ellipsis-horizontal-sharp",class:"text-teal-500",style:{"font-size":"22px"}})):(a(),fe(t(L),{key:2,icon:"ion:checkmark-sharp",style:{"font-size":"22px"}}))])):ge("",!0)]),e("div",Za,[e("div",Xa,[e("div",{id:`${d.id}`,class:"max-w-md bg-white p-4 border border-gray-300 rounded-lg",onContextmenu:ke=>ae(ke,d)},[e("div",ei,[d.filePath===null&&(d.file===null||d.file===void 0)?(a(),u("div",ti,[e("p",{innerHTML:f(d.message)},null,8,li),d.translateText?(a(),u("div",oi,[e("div",si,[l(Ie,{modelValue:t(v)[Se],"onUpdate:modelValue":ke=>t(v)[Se]=ke,accordion:"",class:"w-full"},{default:c(()=>[l(D,{name:d.msgId,icon:"null"},{title:c(()=>[l(t(L),{icon:"dashicons:translation",class:"ml-2",style:{"font-size":"16px"}})]),default:c(()=>[e("div",null,_(d.translateText),1)]),_:2},1032,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue"])])])):ge("",!0)])):(a(),u("div",ni,[d.isRead===!1?(a(),u("span",ai,[d.file?(a(),u("div",ii,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",ci,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(d.file.includes(".ogg")?"语音":d.file),1)],8,ri)])):(a(),u("div",ui,[e("img",{class:"h-48 w-full object-contain",src:w(d.filePath),onClick:ke=>M(w(d.filePath))},null,8,di)])),e("p",{innerHTML:f(d.message)},null,8,pi)])):(a(),u("span",fi,[xe(d.filePath,d.sender)==="image"?(a(),u("div",gi,[e("img",{class:"h-48 w-full object-contain",src:w(d.filePath),onClick:ke=>M(w(d.filePath))},null,8,mi)])):xe(d.filePath,d.sender)==="networkImg"?(a(),u("div",vi,[e("img",{src:`${d.filePath}`,onClick:ke=>M(w(d.filePath))},null,8,hi)])):xe(d.filePath,d.sender)==="error"?(a(),u("div",yi)):(a(),u("div",_i,[e("a",{href:w(d.filePath),target:"_blank",class:"pb-2 mb-2 h-12 w-full flex items-center"},[e("div",bi,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-3xl"})]),e("p",null,_(xe(d.filePath,d.sender).includes(".ogg")?"语音":xe(d.filePath,d.sender)),1)],8,Ii)])),e("p",{innerHTML:f(d.message),class:"whitespace-normal break-words"},null,8,xi)]))]))])],40,Ya),e("div",wi,[e("div",Ci,_(s.currentAccName),1),e("div",ki,_((De=d.date)==null?void 0:De.replace("T","")),1)])])])]))])}),128))]),_:1},8,["style"])),[[de,s.loading]])],4),("useImStore"in r?r.useImStore:t(Ne))().showReply?(a(),u("div",Ai,[e("div",Mi,[e("div",$i,[e("div",ji,[l(t(L),{icon:"ic:baseline-reply",class:"mr-4 text-sky-500",style:{"font-size":"22px"}})]),e("div",Si,[e("div",Di,"Reply to "+_(s.currentName??""),1),t(T)===null&&t(le)===null?(a(),u("div",Li,[e("div",{class:"w-full truncate cursor-pointer hover:text-sky-500",onClick:Z},_(t(z)),1)])):(a(),u("div",Ti,[t(ue)===!1?(a(),u("div",Ni,[t(le)?(a(),u("div",{key:0,class:"flex items-center -ml-10",onClick:Z},[e("div",Vi,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-xl"}),e("p",null,_(t(A)),1)]),e("div",Ui,_(t(z)),1)])):(a(),u("div",{key:1,class:"flex items-center -ml-10",onClick:Z},[e("div",Ri,[e("img",{class:"h-8 w-16",src:t(x)},null,8,Gi)]),e("div",Ei,_(t(z)),1)]))])):(a(),u("div",Fi,[xe(t(x),t(ie))==="image"?(a(),u("div",{key:0,class:"flex items-center -ml-10",onClick:Z},[e("div",zi,[e("div",Pi,[e("img",{class:"h-8 w-16",src:`${t(j)}${t(x)}`},null,8,Bi)])]),e("div",Hi,_(t(z)),1)])):(a(),u("div",{key:1,class:"flex items-center -ml-10",onClick:Z},[e("div",qi,[l(t(L),{icon:"basil:document-solid",class:"text-white cursor-pointer text-xl"}),e("div",Oi,_(xe(t(x),t(ie))),1)]),e("div",Ki,_(t(z)),1)]))]))]))]),e("div",{class:"w-1/12 items-center justify-center cursor-pointer",onClick:ve},[l(t(L),{icon:"icon-park-twotone:error",class:"mr-4 text-sky-500",style:{"font-size":"22px"}})])])])])):ge("",!0),(a(),u("svg",Ji,o[6]||(o[6]=[hl('<symbol id="charm--reply" viewBox="0 0 16 16" data-v-de327e77><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M14.25 13.25c-.5-6-5.5-7.5-8-7v-3.5L1.75 8l4.5 5.25v-3.5c2.5-.5 6.5.5 8 3.5" data-v-de327e77></path></symbol><symbol id="iconamoon--edit-fill" viewBox="0 0 24 24" data-v-de327e77><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m5 16l-1 4l4-1L19.586 7.414a2 2 0 0 0 0-2.828l-.172-.172a2 2 0 0 0-2.828 0z" data-v-de327e77></path><path fill="currentColor" d="m5 16l-1 4l4-1L18 9l-3-3z" data-v-de327e77></path><path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 6l3 3m-5 11h8" data-v-de327e77></path></symbol><symbol id="icon-multiply" viewBox="0 0 1024 1024" data-v-de327e77><path d="M512 64C264.608 64 64 264.608 64 512c0 247.36 200.608 448 448 448 247.36 0 448-200.64 448-448 0-247.392-200.64-448-448-448z m158.4 651.552L512 557.312l-158.4 158.24-45.312-45.248L466.688 512l-158.304-158.4 45.312-45.312L512 466.688l158.4-158.4 45.28 45.312L557.312 512l158.368 158.4-45.28 45.152z" fill="#F74A21" data-v-de327e77></path></symbol><symbol id="dashicons--translation" viewBox="0 0 20 20" data-v-de327e77><path fill="currentColor" d="M11 7H9.49c-.63 0-1.25.3-1.59.7L7 5H4.13l-2.39 7h1.69l.74-2H7v4H2c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h7c1.1 0 2 .9 2 2zM6.51 9H4.49l1-2.93zM10 8h7c1.1 0 2 .9 2 2v7c0 1.1-.9 2-2 2h-7c-1.1 0-2-.9-2-2v-7c0-1.1.9-2 2-2m7.25 5v-1.08h-3.17V9.75h-1.16v2.17H9.75V13h1.28c.11.85.56 1.85 1.28 2.62c-.87.36-1.89.62-2.31.62c-.01.02.22.97.2 1.46c.84 0 2.21-.5 3.28-1.15c1.09.65 2.48 1.15 3.34 1.15c-.02-.49.2-1.44.2-1.46c-.43 0-1.49-.27-2.38-.63c.7-.77 1.14-1.77 1.25-2.61zm-3.81 1.93c-.5-.46-.85-1.13-1.01-1.93h2.09c-.17.8-.51 1.47-1 1.93l-.04.03s-.03-.02-.04-.03" data-v-de327e77></path></symbol><symbol id="basil--forward-solid" viewBox="0 0 24 24" data-v-de327e77><path fill="currentColor" d="M2.554 16.06a.5.5 0 0 0 .656.68l2.499-1.153c2.1-.97 4.393-1.413 6.681-1.309q.041 1.103.121 2.204l.069.938a.754.754 0 0 0 1.158.581a19.6 19.6 0 0 0 5.351-5.068l.46-.64a.5.5 0 0 0 0-.584l-.46-.64A19.6 19.6 0 0 0 13.738 6a.754.754 0 0 0-1.158.58l-.069.94a62 62 0 0 0-.108 1.89h-.644a9.5 9.5 0 0 0-8.475 5.209z" data-v-de327e77></path></symbol>',5)]))),l(Nt,{name:"zoom-fade",mode:"out-in"},{default:c(()=>[t(Re)?(a(),u("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{"z-index":"100"},onClick:R},[e("div",Wi,[e("img",{src:t(P),class:"object-cover w-full"},null,8,Qi)])])):ge("",!0)]),_:1}),l(Pe,{modelValue:t(oe),"onUpdate:modelValue":o[1]||(o[1]=d=>Ve(oe)?oe.value=d:null),title:r.$t("im.chat.confirmDelMessage"),width:"500"},{footer:c(()=>[e("div",Zi,[l(Le,{onClick:he},{default:c(()=>[q(_(r.$t("btn.cancel")),1)]),_:1}),l(Le,{type:"primary",onClick:ye},{default:c(()=>[q(_(r.$t("btn.delete")),1)]),_:1})])]),default:c(()=>[e("div",null,[l(we,{modelValue:t(Ae),"onUpdate:modelValue":o[0]||(o[0]=d=>Ve(Ae)?Ae.value=d:null),label:r.$t("im.chat.isDelBothSides"),size:"large"},null,8,["modelValue","label"])])]),_:1},8,["modelValue","title"]),l(Pe,{modelValue:t(se),"onUpdate:modelValue":o[3]||(o[3]=d=>Ve(se)?se.value=d:null),title:r.$t("im.chat.selectLanguage"),width:"500"},{footer:c(()=>[e("div",er,[l(Le,{onClick:J},{default:c(()=>[q(_(r.$t("btn.cancel")),1)]),_:1}),l(Le,{type:"primary",onClick:te},{default:c(()=>[q(_(r.$t("im.chat.translation")),1)]),_:1})])]),default:c(()=>[l(S,{modelValue:t(k),"onUpdate:modelValue":o[2]||(o[2]=d=>Ve(k)?k.value=d:null),placeholder:"Select",style:{width:"240px"},filterable:""},{default:c(()=>[(a(!0),u(be,null,$e(t(C),d=>(a(),fe(E,{key:d.language,label:d.country,value:d.language},{default:c(()=>[e("span",Xi,_(d.country),1),e("span",Yi,_(d.language),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title"]),l(Pe,{modelValue:t(W),"onUpdate:modelValue":o[5]||(o[5]=d=>Ve(W)?W.value=d:null),title:"选择转发对象",width:"500",onClose:V},{footer:c(()=>[e("div",tr,[l(Le,{onClick:V},{default:c(()=>o[7]||(o[7]=[q("Cancel")])),_:1}),l(Le,{type:"primary",onClick:G},{default:c(()=>o[8]||(o[8]=[q("Confirm")])),_:1})])]),default:c(()=>[l(S,{modelValue:t(H),"onUpdate:modelValue":o[4]||(o[4]=d=>Ve(H)?H.value=d:null),placeholder:"Select",size:"large",style:{width:"240px"},filterable:""},{default:c(()=>[(a(!0),u(be,null,$e(t(re),d=>(a(),fe(E,{style:{width:"240px"},key:d.tgAccountDialog.id,label:d.label,value:JSON.stringify(d)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}}),St=We(lr,[["__scopeId","data-v-de327e77"]]),or={class:"col-span-4 mt-1 bg-white rounded-md p-4 relative"},sr={class:"mb-1",style:{"border-bottom":"1px solid #ccc",height:"5%"}},nr={class:"flex justify-between items-center h-full ml-4"},ar={key:0,class:"flex items-center justify-between w-full"},ir={class:"flex"},rr={class:"font-black"},cr={key:0},ur={key:1,class:"flex items-center justify-between w-full"},dr={class:"font-black"},pr={key:0,class:"absolute top-20 left-72 z-10"},fr={class:"flex justify-between items-center mb-4 pb-4",style:{"border-bottom":"1px solid #ccc"}},gr=Be({__name:"chatRoom",props:{currentAccId:{type:Number,required:!0},currentConId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},currentUsername:{type:String,required:!1},currentTitle:{type:String,required:!1},currentAccName:{type:String,required:!1},currComs:{type:String,required:!0},currSelTab:{type:String,required:!0}},emits:["clearContactId","clearGroupId"],setup(p,{expose:h,emit:i}){const s=p,g=i,y=Ne(),v=n(-1),j=n(-1),z=n(-1);je(()=>[s.currentAccId,s.currentConId,s.currentGroId],([M],[R])=>{M!=R?x():(v.value=s.currentAccId,j.value=s.currentConId,z.value=s.currentGroId,A(),Ae()),oe.value=!1}),je(()=>s.currComs,()=>{x()}),je(()=>s.currSelTab,()=>{x()});function x(){g("clearContactId"),g("clearGroupId"),j.value=-1,z.value=-1,A()}function A(){ae.value=1,Q.value=[],Z.value=0,oe.value=!1,Ne().setReplyFalse()}let T=n();const le=n(),ue=n(),ie=n();function O(M,R,K,w,f){M=="left"?(ue.value=Me(K),ie.value=Me(K)):M=="right"&&(f?(ue.value=Me(K),ie.value=Me(K)):(ue.value=K?"image":null,ie.value=w?"file":null)),le.value=R,T.value="reply"}const B=n(),W=n();function b(M,R){B.value=M,W.value=R,T.value="edit"}function ce(){T.value=void 0,le.value=void 0,ue.value=void 0,ie.value=void 0,B.value=void 0,W.value=void 0}const Q=n([]),ae=n(1),ve=n(20),Z=n(0),oe=n(!1);async function Ae(){zt(),setTimeout(async()=>{oe.value=!0;let M={id:v.value,to_user_id:0,isGroup:!1,pageNum:ae.value,pageSize:ve.value};if(s.currentConId!=-1?M.to_user_id=j.value:s.currentGroId!=-1&&(M.to_user_id=z.value,M.isGroup=!0),j.value!=-1||z.value!=-1)try{const R=await jl(M);R.data.data.data.forEach(K=>{K.isRead=!0,K.file=null}),Q.value=[...R.data.data.data.slice().reverse(),...Q.value],Z.value=R.data.data.totalCount}catch(R){console.log("获取联系聊天记录失败",R)}finally{oe.value=!1}},200)}const ye=n(!1),he=n([]),se=n(""),k=n(!1),C=Vt({pageSizes:[1,10,20,50],pageSize:10,pageNum:1,total:400});function te(M){k.value=!1,C.pageNum=M,J()}function J(){if(ye.value=!0,k.value=!0,oe.value=!0,s.currentConId!=-1){const M={Id:s.currentAccId,UserId:s.currentConId,Like:se.value,pageNum:C.pageNum,pageSize:C.pageSize};se.value!=""&&(M.pageNum=1),Sl(M).then(R=>{R.data.data.data.map(K=>({...K})),se.value!=""?he.value=R.data.data.data.slice().reverse():he.value=[...R.data.data.data.slice().reverse(),...he.value]}).catch(R=>{console.log("获取用户历史",R)}).finally(()=>{oe.value=!1})}else if(s.currentGroId!=-1){const M={GroupId:s.currentGroId,Like:se.value,pageNum:C.pageNum,pageSize:C.pageSize};se.value!=""&&(M.pageNum=1),Dl(M).then(R=>{R.data.data.data.map(K=>({...K})),se.value!=""?he.value=R.data.data.data.slice().reverse():he.value=[...R.data.data.data.slice().reverse(),...he.value]}).catch(R=>{console.log("获取群组历史",R)}).finally(()=>{oe.value=!1})}}function H(){ye.value=!1,he.value=[],C.pageNum=1}function X(M){return Ae(),Q.value=Q.value.filter(R=>R.msgId!==M),Q.value}function re(M){oe.value=!0,ae.value=M,C.pageNum=M,Ae()}function $(M,R){const K=Q.value.find(w=>w.msgId===M);K&&(K.translateText=R)}h({quickMsg:V});const G=n();function V(M){G.value.sendQueickMsg(M)}function U(){const M=new Date,R=M.getFullYear(),K=String(M.getMonth()+1).padStart(2,"0"),w=String(M.getDate()).padStart(2,"0"),f=String(M.getHours()).padStart(2,"0"),F=String(M.getMinutes()).padStart(2,"0"),_e=String(M.getSeconds()).padStart(2,"0");return`${R}-${K}-${w}T${f}:${F}:${_e}`}const I=n(!1);function m(){I.value=!0}function ne(M){let R=null;if(Q.value.length==0?R={id:0,date:U(),msgId:0,sender:!0,message:M.massage,status:0,file:M.file,filePath:M.filePath,isRead:!1}:R=Q.value[Q.value.length-1],R){const K={...R};K.sender=!0,K.message=M.massage,K.id=(R.id??0)+1,K.msgId=M.date,K.status=0,K.filePath=M.filePath,K.existFilePath=ue.value,K.isRead=!1,K.file=M.file,K.existFile=ie.value,K.replyToMsgId=le.value,K.sendFailed=I.value,K.translateText="",Q.value.push(K)}}function Y(M,R,K){const w=Q.value.find(f=>f.msgId===M);w&&(w.msgId=R,w.status=K)}function Ce(M){if(M){const R=M.lastIndexOf(".");if(R!==-1){const w=M.substring(R+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(w))return null}const K=M.lastIndexOf("/");return K!==-1?M.substring(K+1):null}return null}function Me(M){if(M){const R=M.lastIndexOf(".");if(R!==-1){const K=M.substring(R+1).toLowerCase();if(["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(K))return"image"}return"file"}return null}const xe=Ue(()=>y.accountsIdMap);function He(M,R){const K=M.find(w=>w.accountId!=null?w.accountId===R:"");return K?K.id:null}const Te=M=>{const R=JSON.parse(M);if(R.Type===Oe.MessageRead&&(Q.value=Q.value.map(K=>({...K,status:3}))),R.type===Oe.NewUserMessage){const{accountId:K,formUserId:w}=R,f=He(xe.value,K);if(w===s.currentConId&&f===s.currentAccId){const F=Q.value[Q.value.length-1];if(F){const _e={...F};_e.sender=!1,_e.message=R.message,_e.msgId=R.msg_id,_e.id=(F.id??0)+1,_e.status=3,_e.filePath=R.filePath,_e.isRead=!1,_e.file=Ce(R.filePath),_e.translateText=R.TranslateText,Q.value.push(_e)}}}};et.on("updateNotice",Te),pt(()=>{et.off("updateNotice",Te)});const Ge=M=>y.getLabelById(s.currentAccId,M),Re=n();function P(){nt(()=>{Re.value.resetScrollPosition()})}return(M,R)=>{const K=Ke,w=ut,f=Xe;return a(),u(be,null,[e("div",or,[e("div",sr,[e("div",nr,[s.currentUsername!=null?(a(),u("div",ar,[e("div",ir,[Ge(p.currentConId)?(a(),fe(t(L),{key:0,icon:"fluent-emoji:label",style:{"font-size":"18px"}})):ge("",!0),e("span",null,_(Ge(p.currentConId)?Ge(p.currentConId):""),1)]),e("div",null,[e("span",rr,[q(_(s.currentUsername)+" ",1),t(y).getRemarkById(s.currentAccId,s.currentConId)!==""?(a(),u("span",cr,_(`(${t(y).getRemarkById(s.currentAccId,s.currentConId)})`),1)):ge("",!0)])]),e("div",{onClick:J},[l(K,{type:"primary"},{default:c(()=>R[2]||(R[2]=[q("历史消息")])),_:1})])])):ge("",!0),s.currentTitle?(a(),u("div",ur,[e("span",dr,_(s.currentTitle),1),e("div",{onClick:J},[l(K,{type:"primary"},{default:c(()=>R[3]||(R[3]=[q("历史消息")])),_:1})])])):ge("",!0)])]),t(oe)?(a(),u("div",pr,[l(t(L),{icon:"eos-icons:loading",class:"text-sky-500",style:{"font-size":"32px"}})])):ge("",!0),l(St,{ref_key:"contantChatRef",ref:Re,conChatList:t(Q),currentAccId:t(v),currentConId:t(j),currentGroId:t(z),pageNum:t(ae),totalPages:t(Z),loading:t(oe),currentName:p.currentUsername?p.currentUsername??"":p.currentTitle??"",currentAccName:p.currentAccName??"",onMessageId:O,onEditMessage:b,onLazyLoad:re,onTranslate:$,onDelMessage:X},null,8,["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName"]),l(sa,{ref_key:"sendMsgRef",ref:G,currentAccId:s.currentAccId,currentConId:s.currentConId,replyId:t(le),editId:t(B),editContent:t(W),sendType:t(T),currentGroId:s.currentGroId,onSendRecordMsg:Ae,onFakeM:ne,onFakeM2:m,"onUpdate:msg":Y,onVacant:ce,onResetScroll:P},null,8,["currentAccId","currentConId","replyId","editId","editContent","sendType","currentGroId"])]),l(f,{draggable:"",modelValue:t(ye),"onUpdate:modelValue":R[1]||(R[1]=F=>Ve(ye)?ye.value=F:null),title:"历史记录",width:"800",onClose:H},{default:c(()=>[e("div",fr,[l(w,{modelValue:t(se),"onUpdate:modelValue":R[0]||(R[0]=F=>Ve(se)?se.value=F:null),class:me(["w-full","input-with-select"]),placeholder:M.$t("btn.inputSearch")},{append:c(()=>[l(K,{type:"primary",plain:"",onClick:J},{default:c(()=>[l(t(L),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue","placeholder"])]),l(St,{ref_key:"contantChatRef",ref:Re,conChatList:t(he),currentAccId:t(v),currentConId:t(j),currentGroId:t(z),pageNum:t(ae),totalPages:t(Z),loading:t(oe),currentName:p.currentUsername?p.currentUsername??"":p.currentTitle??"",currentAccName:p.currentAccName??"",isHistory:t(k),onHistoryLazyLoad:te},null,8,["conChatList","currentAccId","currentConId","currentGroId","pageNum","totalPages","loading","currentName","currentAccName","isHistory"])]),_:1},8,["modelValue"])],64)}}});class mr{constructor(h,i,s,g){lt(this,"id");lt(this,"useNum");lt(this,"msg");lt(this,"color");this.id=h,this.useNum=i,this.msg=s,g?this.color=g:this.color=yt()}}class vr{constructor(h,i){lt(this,"name");lt(this,"color");this.name=h,i?this.color=i:this.color=yt()}}const hr={class:"dialog-footer"},yr=Be({__name:"autoReply",props:{show:{type:Boolean,required:!0},autoReply:{type:Boolean,required:!0},currentAccId:{type:Number,required:!0}},emits:["update:show"],setup(p,{emit:h}){const i=p,s=h;je(()=>i.show,()=>{y()}),je(()=>i.autoReply,()=>{i.autoReply==!1&&(v.value.AutomaticReply="否",v.value.AutomaticReplyAll="否",j())});const g=n([]);function y(){Kt({GroupId:0}).then(A=>{try{g.value=A.data.data.data.map(T=>({value:T.filePath,label:T.name}))}catch(T){console.log(T)}}).catch(A=>{console.log("查询文件失败",A)})}const v=n({AutomaticReply:"是",AutomaticReplyAll:"是",AutomaticReplyText:"",AutomaticReplyMaterialId:"",AutomaticReplyType:"",AutomaticReplyTimeout:"",Id:""});function j(){const x=new FormData;x.append("AutomaticReply",v.value.AutomaticReply==="是"?"true":"false"),x.append("AutomaticReplyAll",v.value.AutomaticReplyAll==="是"?"true":"false"),x.append("AutomaticReplyText",v.value.AutomaticReplyText),x.append("AutomaticReplyMaterialId",String(v.value.AutomaticReplyMaterialId)),x.append("AutomaticReplyType",String(v.value.AutomaticReplyType)),x.append("AutomaticReplyTimeout",String(v.value.AutomaticReplyTimeout)),x.append("Id",String(i.currentAccId)),Ll(x).then(A=>{console.log("自动回复设置成功",A.data.data)}).catch(A=>{console.log("自动回复设置成功",A)}),z()}function z(){s("update:show",!1),v.value={AutomaticReply:"是",AutomaticReplyAll:"是",AutomaticReplyText:"",AutomaticReplyMaterialId:"",AutomaticReplyType:"",AutomaticReplyTimeout:"",Id:""}}return(x,A)=>{const T=ft,le=gt,ue=Ct,ie=ut,O=kt,B=Ke,W=Xe;return a(),u("div",null,[l(W,{modelValue:i.show,"onUpdate:modelValue":A[5]||(A[5]=b=>i.show=b),title:"自动回复设置",width:"500",onClose:z},{footer:c(()=>[e("div",hr,[l(B,{onClick:z},{default:c(()=>A[6]||(A[6]=[q("Cancel")])),_:1}),l(B,{type:"primary",onClick:j},{default:c(()=>A[7]||(A[7]=[q("Confirm")])),_:1})])]),default:c(()=>[l(O,{"label-width":"auto",model:t(v),style:{"max-width":"600px"}},{default:c(()=>[l(ue,{label:"账号自动回复","label-position":"right"},{default:c(()=>[l(le,{modelValue:t(v).AutomaticReply,"onUpdate:modelValue":A[0]||(A[0]=b=>t(v).AutomaticReply=b),filterable:""},{default:c(()=>[l(T,{label:"是",value:"true"}),l(T,{label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"每条消息自动回复","label-position":"right"},{default:c(()=>[l(le,{modelValue:t(v).AutomaticReplyAll,"onUpdate:modelValue":A[1]||(A[1]=b=>t(v).AutomaticReplyAll=b),filterable:""},{default:c(()=>[l(T,{label:"是",value:"true"}),l(T,{label:"否",value:"false"})]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"回复文本","label-position":"right"},{default:c(()=>[l(ie,{modelValue:t(v).AutomaticReplyText,"onUpdate:modelValue":A[2]||(A[2]=b=>t(v).AutomaticReplyText=b)},null,8,["modelValue"])]),_:1}),l(ue,{label:"回复素材Id","label-position":"right"},{default:c(()=>[l(le,{modelValue:t(v).AutomaticReplyMaterialId,"onUpdate:modelValue":A[3]||(A[3]=b=>t(v).AutomaticReplyMaterialId=b),filterable:""},{default:c(()=>[(a(!0),u(be,null,$e(t(g),(b,ce)=>(a(),fe(T,{key:ce,label:b.label,value:b.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ue,{label:"回复延时","label-position":"right"},{default:c(()=>[l(ie,{modelValue:t(v).AutomaticReplyTimeout,"onUpdate:modelValue":A[4]||(A[4]=b=>t(v).AutomaticReplyTimeout=b),placeholder:"请输入延时时间，单位为秒"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),_r={class:"col-span-2 mt-5 rounded-md p-0 h-full"},Ir={style:{height:"50.6vh"}},br={class:"bg-white -mt-6 px-3 rounded-md",style:{height:"10.5vh"}},xr={class:"pb-2 mb-2 mt-2 items-center flex justify-between",style:{"border-bottom":"1px solid red"}},wr={class:"flex items-center"},Cr={class:"mt-1"},kr={style:{float:"left"}},Ar={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Mr={class:"mt-2 relative"},$r={key:0,class:"overlay"},jr={class:"-mt-8"},Sr={key:1,class:"p-3 bg-white rounded-md",style:{height:"38.5vh"}},Dr={class:"mb-2 pb-2 flex justify-between",style:{"border-bottom":"1px solid red"}},Lr={class:"flex items-center"},Tr={class:"flex"},Nr={class:"flex-1 flex items-center"},Vr={class:"text-with-ellipsis ml-2 mr-0 w-24"},Ur={class:"cursor-pointer"},Rr={class:"flex"},Gr={key:2,class:"mt-2 rounded-md",style:{height:"38.5vh"}},Er={class:"bg-white p-3",style:{height:"10.5vh"}},Fr={class:"pb-2 flex items-center",style:{"border-bottom":"1px solid red"}},zr={class:"bg-white mt-2 p-3 rounded-md",style:{height:"28vh"}},Pr={class:"mb-2 pb-2 flex items-center",style:{"border-bottom":"1px solid red"}},Br={style:{"word-wrap":"break-word"}},Hr=["onClick"],qr={class:"bg-white mt-4 p-3 rounded-md",style:{height:"38.5vh","user-select":"none"}},Or={class:"mb-2 pb-2 flex items-center justify-between",style:{"border-bottom":"1px solid red"}},Kr={class:"flex items-center"},Jr={style:{"word-wrap":"break-word"}},Wr=["onDblclick"],Qr={class:"mb-2"},Zr={class:"flex"},Xr={class:"w-1/2 mr-2",style:{"border-right":"1px solid #ccc"}},Yr={class:"w-1/2"},ec={class:"flex"},tc={class:"dialog-footer"},lc={class:"dialog-footer"},oc=Be({__name:"quickMess",props:{activeAcc:{type:Number,required:!0},currentConId:{type:Number,required:!0},currentAccId:{type:Number,required:!0},currentGroId:{type:Number,required:!0},currentAcc:{type:Object,required:!0},autoReply:{type:Boolean,required:!1}},emits:["quickMsg","updateGroupName","up:autoReply"],setup(p,{emit:h}){const i=p,s=h,g=Ne(),y=Ue(()=>[i.currentConId,i.currentGroId].every(r=>r==-1));je(()=>i.currentGroId,()=>{se()});const v=n(!1);je(()=>v.value,()=>{v.value===!0&&(C(),J())}),je(()=>i.currentAccId,()=>{x.value=i.currentAcc.language,i.autoReply===!0?T.value=!0:T.value=!1});const j=n(!1),z=n(Qt),x=n();function A(){const r={id:i.currentAccId,language:x.value};Wl(r).then(o=>{Fe.success("设置账号翻译语言成功")}).catch(o=>{console.log("设置账号翻译语言失败",o)})}const T=n(!1),le=n(!1);function ue(){T.value===!0?(le.value=!0,s("up:autoReply",!0),console.log("true",T.value)):(le.value=!1,s("up:autoReply",!1),console.log("false",T.value))}const ie=n({nickname:""});function O(){const r=new FormData;r.append("id",String(i.currentAccId)),r.append("userId",String(i.currentConId)),r.append("note",ie.value.nickname),Tl(r).then(o=>{Fe.success("设置用户备注成功"),g.updateRemark({currentAccId:i.currentAccId,userId:i.currentConId,remark:ie.value.nickname})}).catch(o=>{console.log("设置用户备注失败",o)})}const B=n(!1),W=n("");function b(r){B.value=!0,W.value=r,Q()}const ce=n([{value:0,label:"快捷消息分组"}]);function Q(){Ol({type:2}).then(o=>{try{ce.value=o.data.data.data.map(D=>({value:D.id,label:D.name})),ce.value.unshift({value:0,label:"快捷消息分组"})}catch(D){console.log(D)}}).catch(o=>{console.log("获取分组失败",o)})}const ae=n();function ve(){j.value=!0,Kl({GroupId:0,pageNum:1,pageSize:1e3}).then(o=>{try{ae.value=o.data.data.data.map(D=>new mr(D.id,D.useNum,D.msg))}catch(D){console.log(D)}}).catch(o=>{console.log("获取话术失败",o)}).finally(()=>{j.value=!1})}function Z(r,o){var Ie;s("quickMsg",r),Ql({id:o}).then(we=>{console.log("统计使用次数",we.data)}).catch(we=>{console.log("统计使用次数",we)}),(Ie=ae.value)==null||Ie.forEach(we=>{we.id===o&&we.useNum++})}const oe=n();function Ae(){Jl().then(r=>{try{oe.value=r.data.data.data.map(o=>new vr(o.name))}catch(o){console.log(o)}}).catch(r=>{console.log("获取标签失败",r)})}function ye(r){const o={currentAccId:i.currentAccId,userId:i.currentConId,label:r};g.updateLineMessageLabel(o);const D={Id:i.currentAccId,UserId:i.currentConId,Label:r};Zl(D).then(Ie=>{Fe.success("打标签成功")}).catch(Ie=>{console.log("打标签失败",Ie)})}const he=n([]);function se(){const r={id:i.currentAccId,chat_id:i.currentGroId};Nl(r).then(o=>{try{he.value=o.data.data}catch(D){console.log(D)}}).catch(o=>{console.log("获取群成员失败",o)})}const k=n([]);function C(){const r={id:i.currentAccId};wt(r).then(o=>{try{k.value=o.data.data}catch(D){console.log(D)}}).catch(o=>{console.log("联系人列表失败",o)})}const te=n([]);function J(){Ot({GroupId:0}).then(o=>{try{te.value=o.data.data.data}catch(D){console.log(D)}}).catch(o=>{console.log("查询联系人素材失败",o)})}const H=n([]),X=r=>{H.value=r,console.log("yyy",r)},re=Vt({phone:""}),$=n(),G=n([]),V=r=>{G.value=r,console.log("xxx",r)};function U(){v.value=!0}function I(){const r=re.phone.split(/\r?\n/),o=[];r.forEach(we=>{const Le=we.trim();Le!==""&&o.push(Le)});const D=G.value.map(we=>({userId:we.userId,userHash:we.accessHash})),Ie={id:i.currentAccId,chat_id:i.currentGroId,phones:o,values:D};console.log("新增群成员参数",Ie),Vl(Ie).then(we=>{console.log("新增群成员成功",we.data),Fe.success("新增群成员成功"),se()}).catch(we=>{console.log("新增群成员失败",we)}),m()}function m(){re.phone="",v.value=!1,G.value=[],$.value.clearSelection()}const ne=n(!1),Y=n(),Ce=n(),Me=n();function xe(r){ne.value=!0,Y.value=r.userId,Ce.value=r.userHash,Me.value=r.userName}function He(){const r={id:i.currentAccId,chatId:i.currentGroId,userId:Y.value,userHash:Ce.value};console.log("踢人信息",r),Ul(r).then(o=>{console.log("踢人成功",o.data),Fe.success("踢人成功"),se()}).catch(o=>{console.log("踢人失败",o)}),Te()}function Te(){ne.value=!1}const Ge=n(!1),Re=n({title:""}),P=n(),M=n([]);function R(r,o){P.value.clearFiles(),M.value=[]}const K=r=>{console.log("文件 ",r)},w=(r,o)=>{const D=r.raw;["image/jpeg","image/png","image/gif","image/bmp","image/tiff","image/webp"].includes(D.type)||(Fe({message:"文件类型错误,请上传图片文件",type:"error"}),P.value.clearFiles()),M.value.push(D)};function f(){Ge.value=!0}function F(){const r=new FormData;M.value.forEach(o=>{o instanceof File&&r.append("photo",o)}),r.append("id",String(i.currentAccId)),r.append("chatId",String(i.currentGroId)),r.append("title",String(Re.value.title)),Rl(r).then(o=>{console.log("修改成功",o.data),Fe.success("修改成功"),s("updateGroupName")}).catch(o=>{console.log("修改失败",o),Fe.error("修改失败")}),_e()}function _e(){Ge.value=!1,Re.value.title="",M.value=[]}return ot(()=>{ve(),Ae()}),(r,o)=>{const D=Xl,Ie=gt,we=ht,Le=ft,Pe=Ct,E=kt,S=Wt,de=tt,d=ut,Se=vt,N=Ht,De=qt,ke=Ke,Qe=Xe,st=Jt,_t=ct;return a(),u(be,null,[e("div",_r,[e("div",Ir,[e("div",br,[e("div",xr,[e("div",wr,[l(t(L),{icon:"icon-park:setting",class:"mr-2",style:{"font-size":"18px"}}),o[15]||(o[15]=e("span",null,"账号设置",-1))]),e("div",Cr,[o[16]||(o[16]=e("span",{class:"text-slate-700 text-sm"},"自动回复",-1)),l(D,{modelValue:t(T),"onUpdate:modelValue":o[0]||(o[0]=ee=>Ve(T)?T.value=ee:null),disabled:i.activeAcc==-1,class:"ml-2","inline-prompt":"",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"是","inactive-text":"否",onChange:ue},null,8,["modelValue","disabled"])])]),e("div",null,[i.activeAcc==-1?(a(),fe(we,{key:0,class:"box-item",effect:"dark",content:"请先选择账户",placement:"left"},{default:c(()=>[l(Ie,{placeholder:"翻译语言",size:"large",disabled:i.activeAcc==-1,filterable:""},null,8,["disabled"])]),_:1})):(a(),fe(E,{key:1,ref:"ruleFormRef",model:t(ie),"status-icon":"","label-width":"auto",class:"demo-ruleForm w-11/12 mt-2 mx-2"},{default:c(()=>[l(Pe,{label:"设置翻译",prop:"translate"},{default:c(()=>[l(Ie,{modelValue:t(x),"onUpdate:modelValue":o[1]||(o[1]=ee=>Ve(x)?x.value=ee:null),placeholder:"翻译语言",filterable:"",onChange:A},{default:c(()=>[(a(!0),u(be,null,$e(t(z),ee=>(a(),fe(Le,{key:ee.language,label:ee.country,value:ee.language},{default:c(()=>[e("span",kr,_(ee.country),1),e("span",Ar,_(ee.language),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]))])]),e("div",Mr,[t(y)?(a(),u("div",$r,[e("div",jr,[l(S,{type:"warning",effect:"dark"},{default:c(()=>o[17]||(o[17]=[q("请先选择联系人 / 群组")])),_:1})])])):ge("",!0),p.currentGroId!=-1?(a(),u("div",Sr,[e("div",Dr,[e("div",Lr,[l(t(L),{class:"mr-2",icon:"ic:round-group",style:{"font-size":"24px"}}),o[18]||(o[18]=e("span",null,"群成员管理",-1))]),e("div",Tr,[e("div",{class:"w-8 px-1 ml-2 rounded-md",onClick:f},[l(t(L),{icon:"ep:tools",class:"text-sky-500 cursor-pointer",style:{"font-size":"22px"}})]),e("div",{class:"w-8 px-1 rounded-md",onClick:U},[l(t(L),{icon:"icon-park-solid:add-one",class:"mr-2 text-sky-500 cursor-pointer",style:{"font-size":"22px"}})])])]),l(de,{always:"",style:{height:"32vh"}},{default:c(()=>[(a(!0),u(be,null,$e(t(he),(ee,pe)=>(a(),u("div",{key:pe,class:me(["h-10 w-full mb-2 rounded-md flex items-center",{"bg-border":ee.adminRights}]),style:{"border-bottom":"1px solid #388df8"}},[e("div",Nr,[e("div",Vr,_(ee.userName),1),e("div",Ur,[l(S,{effect:"dark",type:"primary"},{default:c(()=>[q(_(ee.phone),1)]),_:2},1024)])]),e("div",Rr,[l(t(L),{icon:"icon-park:delete-two",class:"mr-2 cursor-pointer",style:{"font-size":"22px"},onClick:Ee=>xe(ee)},null,8,["onClick"])])],2))),128))]),_:1})])):(a(),u("div",Gr,[e("div",Er,[e("div",Fr,[l(t(L),{icon:"fluent-mdl2:contact-card-settings",class:"mr-2",style:{"font-size":"18px"}}),o[19]||(o[19]=q("联系人设置 "))]),e("div",null,[l(E,{ref:"ruleFormRef",model:t(ie),"status-icon":"","label-width":"auto",class:"demo-ruleForm w-11/12 mt-2 mx-2",onSubmit:o[4]||(o[4]=Ze(()=>{},["prevent"]))},{default:c(()=>[l(Pe,{label:"设置备注",prop:"types"},{default:c(()=>[l(d,{modelValue:t(ie).nickname,"onUpdate:modelValue":o[2]||(o[2]=ee=>t(ie).nickname=ee),type:"text",autocomplete:"off",onBlur:O,onKeydown:o[3]||(o[3]=it(Ze(()=>{},["prevent"]),["enter"]))},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),e("div",zr,[e("div",Pr,[l(t(L),{icon:"fluent-emoji:label",class:"mr-2",style:{"font-size":"18px"}}),o[20]||(o[20]=q("联系人标签 "))]),l(de,{always:"",style:{height:"22vh"}},{default:c(()=>[e("div",Br,[(a(!0),u(be,null,$e(t(oe),(ee,pe)=>(a(),u("div",{key:pe,class:"inline-block text-white text-xs mx-1 px-2 py-1 my-1 rounded-md shadow-md hover:bg-sky-500 transition-colors duration-300 cursor-pointer",style:Je([{border:"1px solid #ccc",display:"inline-block"},{backgroundColor:ee.color}]),onClick:Ee=>ye(ee.name)},_(ee.name),13,Hr))),128))])]),_:1})])])),e("div",qr,[e("div",Or,[e("div",Kr,[l(t(L),{icon:"icon-park:text-message",class:"mr-2",style:{"font-size":"18px"}}),o[21]||(o[21]=q(" 快捷消息 ")),o[22]||(o[22]=e("span",{class:"ml-1 text-red-400",style:{"font-size":"10px"}},"(双击发送消息)",-1))]),e("div",{onClick:o[5]||(o[5]=ee=>b("add"))},[l(t(L),{icon:"icon-park-solid:add-one",class:"text-sky-500 cursor-pointer",style:{"font-size":"26px"}})])]),ze((a(),fe(de,{always:"",style:{height:"22vh"}},{default:c(()=>[e("div",Jr,[(a(!0),u(be,null,$e(t(ae),(ee,pe)=>(a(),u("div",{key:pe,class:"inline-block text-white text-xs mx-1 px-2 py-1 my-1 rounded-md shadow-md hover:bg-sky-500 transition-colors duration-300 cursor-pointer hover:scale-95 relative",style:Je([{border:"1px solid #ccc",display:"inline-block"},{backgroundColor:ee.color}]),onDblclick:Ee=>Z(ee.msg,ee.id)},[l(Se,{value:ee.useNum,offset:[3,-1]},{default:c(()=>[q(_(ee.msg),1)]),_:2},1032,["value"])],44,Wr))),128))])]),_:1})),[[_t,t(j)]])])])])]),l(Qe,{modelValue:t(v),"onUpdate:modelValue":o[7]||(o[7]=ee=>Ve(v)?v.value=ee:null),title:r.$t("im.addContant.addContact"),width:"700"},{footer:c(()=>[l(ke,{onClick:m},{default:c(()=>[q(_(r.$t("btn.cancel")),1)]),_:1}),l(ke,{type:"primary",onClick:I},{default:c(()=>[q(_(r.$t("btn.confirm")),1)]),_:1})]),default:c(()=>[e("div",null,[e("div",Qr,[o[23]||(o[23]=e("div",{class:"font-bold mb-2"},"邀请联系人",-1)),l(d,{modelValue:t(re).phone,"onUpdate:modelValue":o[6]||(o[6]=ee=>t(re).phone=ee),rows:7,type:"textarea",placeholder:"注：每行一个联系人信息",autocomplete:"off"},null,8,["modelValue"])]),e("div",Zr,[e("div",Xr,[o[25]||(o[25]=e("div",{class:"font-bold mb-2"},"联系人列表",-1)),l(De,{"show-header":!1,ref_key:"conListRef",ref:$,data:t(k),style:{width:"100%",height:"300px"},onSelectionChange:V},{default:c(()=>[l(N,{type:"selection",width:"55"}),l(N,null,{default:c(ee=>[q(" 昵称："+_(ee.row.firstName)+" ",1),o[24]||(o[24]=e("br",null,null,-1)),q(" 号码："+_(ee.row.phone),1)]),_:1})]),_:1},8,["data"])]),e("div",Yr,[o[27]||(o[27]=e("div",{class:"font-bold mb-2"},"联系人素材",-1)),l(De,{"show-header":!1,data:t(te),style:{width:"100%",height:"300px"},onSelectionChange:X},{default:c(()=>[l(N,{type:"selection",width:"55"}),l(N,null,{default:c(ee=>[q(" 昵称："+_(ee.row.userName)+" ",1),o[26]||(o[26]=e("br",null,null,-1)),q(" 号码："+_(ee.row.phone),1)]),_:1})]),_:1},8,["data"])])])])]),_:1},8,["modelValue","title"]),l(Qe,{modelValue:t(ne),"onUpdate:modelValue":o[8]||(o[8]=ee=>Ve(ne)?ne.value=ee:null),title:"移除群成员",width:"500"},{footer:c(()=>[e("div",tc,[l(ke,{onClick:Te},{default:c(()=>o[28]||(o[28]=[q("Cancel")])),_:1}),l(ke,{type:"danger",onClick:He},{default:c(()=>o[29]||(o[29]=[q("确认移除")])),_:1})])]),default:c(()=>[e("div",ec,[l(t(L),{icon:"solar:danger-broken",class:"text-red-500 mr-2",style:{"font-size":"24px"}}),e("span",null,_(`确认移除群成员：${t(Me)}`),1)])]),_:1},8,["modelValue"]),l(Qe,{modelValue:t(Ge),"onUpdate:modelValue":o[10]||(o[10]=ee=>Ve(Ge)?Ge.value=ee:null),title:"修改群信息",width:"500"},{footer:c(()=>[e("div",lc,[l(ke,{onClick:_e},{default:c(()=>o[31]||(o[31]=[q("Cancel")])),_:1}),l(ke,{type:"primary",onClick:F},{default:c(()=>o[32]||(o[32]=[q("确认修改")])),_:1})])]),default:c(()=>[l(E,{model:t(Re),"label-position":"right","label-width":"auto",style:{"max-width":"600px"}},{default:c(()=>[l(Pe,{label:"群标题","label-position":"right"},{default:c(()=>[l(d,{modelValue:t(Re).title,"onUpdate:modelValue":o[9]||(o[9]=ee=>t(Re).title=ee)},null,8,["modelValue"])]),_:1}),l(Pe,{label:"群头像","label-position":"right"},{default:c(()=>[l(st,{ref_key:"uploadRef",ref:P,class:"upload-demo","file-list":t(M),"auto-upload":!1,"on-preview":K,"on-remove":R,"on-change":w,multiple:!0,limit:10,drag:"",style:{width:"420px"}},{default:c(()=>[l(t(L),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),o[30]||(o[30]=e("div",{class:"el-upload__text"},[q(" 请"),e("em",null,"点击或拖拽"),q("上传图片 ")],-1))]),_:1},8,["file-list"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(Yl,{show:t(B),formType:t(W),groupOptions:t(ce),"onUp:show":o[11]||(o[11]=ee=>B.value=ee),"onUp:formType":o[12]||(o[12]=ee=>W.value=ee),"onUp:speech":ve,"onUp:loading":o[13]||(o[13]=ee=>j.value=ee)},null,8,["show","formType","groupOptions"]),l(yr,{show:t(le),autoReply:t(T),currentAccId:p.currentAccId,"onUpdate:show":o[14]||(o[14]=ee=>le.value=ee)},null,8,["show","autoReply","currentAccId"])],64)}}}),sc=We(oc,[["__scopeId","data-v-62c05b27"]]),nc={class:"grid grid-cols-10 gap-4"},ac=Be({__name:"im",setup(p){const h=n(-1),i=n(-1),s=n(),g=n(),y=n(!1),v=n(!1);function j(se,k,C){h.value=se,i.value=k,y.value=C.automaticReply,g.value=C.accountName,s.value=z.value.find(te=>te.id===h.value)}const z=n([]);function x(se){z.value=se}const A=n(-1),T=n();function le(se,k){A.value=se,T.value=k}const ue=n(-1),ie=n();function O(se,k){ue.value=se,ie.value=k}function B(){A.value=-1,T.value=void 0}function W(){ue.value=-1}const b=n("");function ce(se){b.value=se}const Q=n();function ae(se){Q.value.quickMsg(se)}const ve=n();function Z(){ve.value.getAllContantList()}const oe=n("");function Ae(se){oe.value=se}const ye=n("");function he(se){ye.value=se}return(se,k)=>(a(),u("div",nc,[l(Eo,{currentConId:t(A),currentGroId:t(ue),upAutoReply:t(v),onAccountId:j,onLoginError:ce,onAccountList:x},null,8,["currentConId","currentGroId","upAutoReply"]),l(Mn,{ref_key:"contactAndGroupRef",ref:ve,currentAccId:t(h),loginError:t(b),onContactId:le,onGroupId:O,onCurrCom:Ae,onCurrSelectTab:he},null,8,["currentAccId","loginError"]),l(gr,{ref_key:"chatRoomRef",ref:Q,currentAccId:t(h),currentConId:t(A),currentGroId:t(ue),currentUsername:t(T),currentTitle:t(ie),currentAccName:t(g),currComs:t(oe),currSelTab:t(ye),onClearContactId:B,onClearGroupId:W},null,8,["currentAccId","currentConId","currentGroId","currentUsername","currentTitle","currentAccName","currComs","currSelTab"]),l(sc,{activeAcc:t(i),currentAccId:t(h),currentConId:t(A),currentGroId:t(ue),currentAcc:t(s),autoReply:t(y),onQuickMsg:ae,onUpdateGroupName:Z,"onUp:autoReply":k[0]||(k[0]=C=>v.value=C)},null,8,["activeAcc","currentAccId","currentConId","currentGroId","currentAcc","autoReply"])]))}}),zc=We(ac,[["__scopeId","data-v-583012ca"]]);export{zc as default};
