import{d as xe,t as d,y as B,B as Ce,b as z,Y as i,a4 as t,i as n,e as l,a9 as q,H as $,h as L,J as H,aa as V,o as b,$ as ke,Z as m,a3 as Se,n as J,I as W,a0 as ze}from"./index-2a2bri-d.js";import{b as Ve,v as Ee,c as Ne,e as Ue}from"./el-select-Dz2KJnwc.js";import{E as Ie}from"./el-upload-DvftR1ML.js";/* empty css                        */import"./el-tag-BySgfF3p.js";import"./el-scrollbar-CXPZY7Bs.js";import{E as $e,a as Le}from"./el-form-item-DzHjpJCN.js";import{E as Fe}from"./el-pagination-9PnmAPxJ.js";import{E as De}from"./el-input-DOfSdrh_.js";import{a as Me,E as Re}from"./el-table-column-BN4sCq-k.js";import"./el-checkbox-CMe2Q5Jf.js";import"./el-tooltip-l0sNRNKZ.js";import{E as Be}from"./el-popover-C08XbDAN.js";import{E as Te,a as Ge}from"./el-button-D_fjb_vJ.js";import{I as w}from"./iconify-BO38E5Xh.js";import{d as Pe,a as Ae,q as je,r as Oe,s as Ye}from"./material-CaO01XEC.js";import{g as qe}from"./utils-DaTdCYcK.js";import{_ as He}from"./group.vue_vue_type_script_setup_true_lang-C1jwDhw7.js";import{_ as Je}from"./oneClickG.vue_vue_type_script_setup_true_lang-C539e8t4.js";import{_ as We,a as Ze}from"./phoneSend.vue_vue_type_script_setup_true_lang-Dt25D4YH.js";import{_ as Ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-rGSOovlF.js";import"./index-3_ES5SxW.js";import"./refs-CTMQh0bL.js";import"./_Uint8Array-BA5rhpUc.js";import"./_initCloneObject-BSnmcygP.js";import"./account-BYfcswwO.js";import"./el-step-DN_0vMak.js";import"./account.StatusEnum-CqjSWtZY.js";import"./accountList.vue_vue_type_script_setup_true_lang-BLpQhr_P.js";import"./im-DDAOu1MQ.js";const Qe={class:"grid grid-cols-12 gap-4 mt-1"},Xe={class:"col-span-2 bg-white rounded-md p-4"},el={class:"mr-4",style:{width:"100%"}},ll={class:"mt-2"},tl={class:"mt-2"},ol={class:"mt-2"},al={class:"mt-2"},nl={class:"col-span-10 bg-white rounded-md p-4"},sl={style:{height:"82.5vh",overflow:"auto"}},il={class:"mt-4"},dl={class:"flex justify-center items-center"},rl={class:"w-full"},pl={class:"w-full"},ul={class:"dialog-footer"},ml={key:0},cl={key:1},fl=xe({__name:"contact",setup(gl){const f=d(!1),E=d([{value:0,label:"默认分组"}]);function T(){Pe({type:1}).then(e=>{console.log("获取分组成功",e.data.data),E.value=e.data.data.data.map(a=>({value:a.id,label:a.name})),E.value.unshift({value:0,label:"默认分组"})}).catch(e=>{console.log("获取分组失败",e)})}function Z(s){const e=E.value.find(a=>a.value==s);return e?e.label:"未知分组"}const N=d(),U=d([]),K=d(!1);function Q(s,e){N.value.clearFiles(),U.value=[]}const X=s=>{console.log("文件 ",s)},ee=(s,e)=>{const a=s.raw;if(!(a.type==="text/plain"||a.name.endsWith(".txt")))return V({message:"文件类型错误,请上传txt文件",type:"error"}),N.value.clearFiles(),K.value=!1;const c=new FileReader;c.onload=function(v){if(v.target){const R=v.target.result;String(R).split(/\r?\n/).forEach(_=>{const S=_.trim();S!==""&&/^\d+$/.test(S)&&U.value.push(S)})}},c.readAsText(a)},h=d(!1),r=B({group:"默认分组",contact:"",remark:`联系人素材(${qe(new Date)})`});function le(s){h.value=!0,y.value=s,T()}function te(){f.value=!0;const a=[...r.contact.split(/\r?\n/),...U.value].filter(oe);if(a.length===0){V({message:"上传的文件中不包含有效的电话号码",type:"error"});return}const u=new FormData;a.forEach(c=>{u.append("phones",c)}),r.group=="默认分组"?u.append("group_id",String(0)):u.append("group_id",String(r.group)),u.append("remarks",r.remark),Oe(u).then(c=>{console.log("新增联系人成功",c),V.success("新增成功"),x()}).catch(c=>{console.log("新增联系人失败",c)}).finally(()=>{f.value=!1}),G()}function G(){h.value=!1,y.value="",N.value.clearFiles(),U.value=[],r.contact="",r.group="默认分组",r.remark=""}function oe(s){return/^[1-9]\d{9,14}$/.test(s)}const C=d("conSend"),ae=d(""),y=d(""),g=B({id:"",userName:""}),ne=(s,e)=>{console.log("修改",s),g.id=s.id,y.value=e,h.value=!0,ae.value=s.id};function se(){f.value=!0;const s={id:g.id,user_name:g.userName};console.log("修改联系人",s),Ye(s).then(e=>{console.log("修改联系人成功",e.data.data),V.warning("修改成功"),x()}).catch(e=>{console.log("修改联系人失败",e)}).finally(()=>{f.value=!1}),P()}function P(){h.value=!1,y.value="",g.id="",g.userName=""}const I=d(""),A=d([]);function x(){f.value=!0;const s={GroupId:r.group==="默认分组"?null:Number(r.group),Like:I.value,pageNum:p.pageNum,pageSize:p.pageSize};Ae(s).then(e=>{console.log("查询联系人成功",e.data.data),A.value=e.data.data.data,p.pageNum=e.data.data.pageNumber,p.pageSize=e.data.data.pageSize,p.total=e.data.data.totalCount}).catch(e=>{console.log("查询联系人失败",e)}).finally(()=>{f.value=!1})}const ie=()=>{console.log("cancel!")};function de(){f.value=!0;const s=k.value.map(a=>a.id),e=new FormData;s.forEach(a=>{e.append("ids",a)}),je(e).then(a=>{console.log("删除联系人成功",a.data.data),V.error("删除成功"),x()}).catch(a=>{console.log("删除联系人失败",a)}).finally(()=>{f.value=!1})}const F=d(!1);function re(){F.value=!0}const D=d(!1);function pe(){D.value=!0}const M=d(!1),j=d("");function ue(s){M.value=!0,j.value=s.phone}const p=B({pageSizes:[1,10,20,50],pageSize:10,pageNum:1,total:400}),me=s=>{x()},ce=s=>{x()},fe=d(),k=d([]),ge=s=>{k.value=s};return Ce(()=>{x(),T()}),(s,e)=>{const a=Te,u=De,c=Be,v=Re,R=Me,O=Fe,_=$e,S=Le,ve=Ne,be=Ue,ye=Ge,_e=Ie,we=Ve,Y=Ee;return b(),z(H,null,[i("div",Qe,[i("div",Xe,[i("div",null,[e[26]||(e[26]=i("div",{class:"mb-4 px-2 py-2",style:{"border-bottom":"1px dashed #ccc"}}," 联系人素材 ",-1)),i("div",null,[i("div",el,[t(u,{modelValue:l(I),"onUpdate:modelValue":e[0]||(e[0]=o=>q(I)?I.value=o:null),style:{"max-width":"230px"},placeholder:"Please input",class:"input-with-select"},{append:n(()=>[t(a,{type:"primary",plain:"",onClick:x},{default:n(()=>[t(l(w),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue"])]),i("div",ll,[t(a,{type:"primary",plain:"",class:"w-full overflow-hidden text-overflow-ellipsis",onClick:e[1]||(e[1]=o=>le("add"))},{default:n(()=>[t(l(w),{icon:"tabler:message-plus",style:{"font-size":"22px"}}),e[18]||(e[18]=i("span",{class:"hidden lg:inline-block ml-2"},"新增联系人",-1)),e[19]||(e[19]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"新增联系人",-1))]),_:1})]),i("div",tl,[t(c,{"confirm-button-text":"Yes","cancel-button-text":"No","icon-color":"#626AEF",title:s.$t("userMarger.user.areSureDel"),onConfirm:e[2]||(e[2]=o=>de()),onCancel:ie},{reference:n(()=>[t(a,{type:"danger",plain:"",class:"w-full overflow-hidden text-overflow-ellipsis"},{default:n(()=>[t(l(w),{icon:"material-symbols:delete-outline",style:{"font-size":"22px"}}),e[20]||(e[20]=i("span",{class:"hidden lg:inline-block ml-2"},"删除联系人",-1)),e[21]||(e[21]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"删除联系人",-1))]),_:1})]),_:1},8,["title"])]),i("div",ol,[t(a,{type:"primary",plain:"",class:"w-full overflow-hidden text-overflow-ellipsis",onClick:pe,disabled:l(k).length===0},{default:n(()=>[t(l(w),{icon:"tabler:message-plus",style:{"font-size":"22px"}}),e[22]||(e[22]=i("span",{class:"hidden lg:inline-block ml-2"},"一键群发",-1)),e[23]||(e[23]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"一键群发",-1))]),_:1},8,["disabled"])]),i("div",al,[t(a,{type:"primary",plain:"",class:"w-full overflow-hidden text-overflow-ellipsis",onClick:re,disabled:l(k).length===0},{default:n(()=>[t(l(w),{icon:"fluent:contact-card-link-20-filled",style:{"font-size":"22px"}}),e[24]||(e[24]=i("span",{class:"hidden lg:inline-block ml-2"},"导入为联系人",-1)),e[25]||(e[25]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"导入为联系人",-1))]),_:1},8,["disabled"])])])]),t(He,{typeId:1})]),$((b(),z("div",nl,[i("div",null,[i("div",sl,[$((b(),L(R,{ref_key:"tableRef",ref:fe,data:l(A),style:{width:"100%"},border:"",onSelectionChange:ge,height:"full"},{default:n(()=>[t(v,{type:"selection",width:"55"}),t(v,{prop:"userName",label:"用户名"}),t(v,{prop:"phone",label:"手机号"}),t(v,{prop:"remarks",label:"备注"}),t(v,{prop:"createTime",label:"联系人创建时间"}),t(v,{prop:"groupId",label:"分组"},{default:n(o=>[i("span",null,ke(Z(o.row.groupId)),1)]),_:1}),t(v,{width:"220"},{header:n(()=>e[27]||(e[27]=[i("div",{class:"must"},[i("span",{class:"red"}),m("操作")],-1)])),default:n(o=>[t(a,{size:"small",type:"warning",plain:"",onClick:he=>ne(o.row,"port")},{default:n(()=>[t(l(w),{icon:"mdi:progress-wrench",style:{"font-size":"18px"}}),e[28]||(e[28]=m(" 修改联系人 "))]),_:2},1032,["onClick"]),t(a,{size:"small",type:"primary",plain:"",onClick:he=>ue(o.row)},{default:n(()=>[t(l(w),{icon:"mdi:progress-wrench",style:{"font-size":"18px"}}),e[29]||(e[29]=m(" 私聊 "))]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,l(f)]])]),i("div",il,[t(O,{"current-page":l(p).pageNum,"onUpdate:currentPage":e[3]||(e[3]=o=>l(p).pageNum=o),"page-size":l(p).pageSize,"onUpdate:pageSize":e[4]||(e[4]=o=>l(p).pageSize=o),"page-sizes":l(p).pageSizes,"onUpdate:pageSizes":e[5]||(e[5]=o=>l(p).pageSizes=o),total:l(p).total,"onUpdate:total":e[6]||(e[6]=o=>l(p).total=o),size:"default",background:!0,layout:"total, sizes, prev, pager, next, jumper","default-current-page":1,onSizeChange:me,onCurrentChange:ce},null,8,["current-page","page-size","page-sizes","total"])])])])),[[Y,l(f)]]),t(we,{modelValue:l(h),"onUpdate:modelValue":e[14]||(e[14]=o=>q(h)?h.value=o:null),title:l(y)=="port"?"修改联系人":"新增联系人",width:"600"},{footer:n(()=>[i("div",ul,[l(y)=="port"?(b(),z("div",ml,[t(a,{onClick:P},{default:n(()=>e[33]||(e[33]=[m("Cancel")])),_:1}),t(a,{type:"primary",onClick:se},{default:n(()=>e[34]||(e[34]=[m("修改")])),_:1})])):(b(),z("div",cl,[t(a,{onClick:G},{default:n(()=>e[35]||(e[35]=[m("Cancel")])),_:1}),t(a,{type:"primary",onClick:te},{default:n(()=>e[36]||(e[36]=[m("新增")])),_:1})]))])]),default:n(()=>[l(y)=="port"?(b(),L(S,{key:0,inline:!0,model:l(g),class:"demo-form-inline"},{default:n(()=>[t(_,{label:"联系人id",prop:"id","label-width":"100px"},{default:n(()=>[t(u,{modelValue:l(g).id,"onUpdate:modelValue":e[7]||(e[7]=o=>l(g).id=o),type:"text",disabled:"",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(_,{label:"联系人名称",prop:"userName","label-width":"100px"},{default:n(()=>[t(u,{modelValue:l(g).userName,"onUpdate:modelValue":e[8]||(e[8]=o=>l(g).userName=o),type:"text",placeholder:"输入更改后的名称",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):l(y)=="add"?(b(),L(S,{key:1,inline:!0,model:l(r),class:"demo-form-inline"},{default:n(()=>[t(_,{label:"选择分组",prop:"group","label-width":"100px"},{default:n(()=>[t(be,{modelValue:l(r).group,"onUpdate:modelValue":e[9]||(e[9]=o=>l(r).group=o),placeholder:"选择分组",style:{width:"300px"},filterable:""},{default:n(()=>[(b(!0),z(H,null,Se(l(E),o=>(b(),L(ve,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(_,{label:"素材描述",prop:"remark","label-width":"100px"},{default:n(()=>[t(u,{modelValue:l(r).remark,"onUpdate:modelValue":e[10]||(e[10]=o=>l(r).remark=o),type:"text",clearable:"",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),i("div",dl,[t(ye,{class:"w-1/2 mb-2 pb-2",style:{"border-bottom":"1px solid #ccc"}},{default:n(()=>[t(a,{class:J(["w-1/2",{active:l(C)==="conSend"}]),type:"primary",plain:"",onClick:e[11]||(e[11]=o=>C.value="conSend")},{default:n(()=>e[30]||(e[30]=[m(" 手动输入 ")])),_:1},8,["class"]),t(a,{class:J(["w-1/2",{active:l(C)==="conList"}]),type:"primary",plain:"",onClick:e[12]||(e[12]=o=>C.value="conList")},{default:n(()=>e[31]||(e[31]=[m(" 导入联系人 ")])),_:1},8,["class"])]),_:1})]),$(i("div",rl,[t(_,{label:"联系人素材",prop:"contact","label-width":"100px"},{default:n(()=>[t(u,{modelValue:l(r).contact,"onUpdate:modelValue":e[13]||(e[13]=o=>l(r).contact=o),rows:8,type:"textarea",placeholder:"注：每行一个联系人",clearable:"",style:{width:"420px"}},null,8,["modelValue"])]),_:1})],512),[[W,l(C)==="conSend"]]),$(i("div",pl,[t(_,{label:"导入联系人","label-width":"100px"},{default:n(()=>[t(_e,{ref_key:"uploadRef",ref:N,class:"upload-demo","auto-upload":!1,"on-preview":X,"on-remove":Q,"on-change":ee,multiple:!0,limit:10,drag:"",style:{width:"420px"}},{default:n(()=>[t(l(w),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),e[32]||(e[32]=i("div",{class:"el-upload__text"},[m(" 请"),i("em",null,"点击或拖拽"),m("上传"),i("em",null,"`.txt`"),m("文件 ")],-1))]),_:1},512)]),_:1})],512),[[W,l(C)==="conList"]])]),_:1},8,["model"])):ze("",!0)]),_:1},8,["modelValue","title"])]),t(We,{show:l(F),multipleSelect:l(k),"onUp:show":e[15]||(e[15]=o=>F.value=o)},null,8,["show","multipleSelect"]),t(Je,{show:l(D),multipleSelect:l(k),"onUp:show":e[16]||(e[16]=o=>D.value=o)},null,8,["show","multipleSelect"]),t(Ze,{show:l(M),phone:l(j),"onUp:show":e[17]||(e[17]=o=>M.value=o)},null,8,["show","phone"])],64)}}}),Hl=Ke(fl,[["__scopeId","data-v-e4087974"]]);export{Hl as default};
