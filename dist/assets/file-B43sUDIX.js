import{d as me,t as p,y as U,B as fe,W as ge,o as m,b,X as i,a3 as t,i as n,e as a,a8 as D,H as G,h as L,Z as z,Y as f,$ as T,J as B,a2 as _e,T as ve,a9 as F}from"./index-SkQIWFxF.js";import{b as he,c as be,e as ye,v as we}from"./el-select-aoHRwLzr.js";import{E as xe,a as ze}from"./el-form-item-DjY6-g6w.js";import{E as ke}from"./el-upload-BngSqAe8.js";import"./el-tag-C-Ar2SHx.js";import{E as Ce}from"./el-scrollbar-B_RdZN1g.js";import{E as Ee}from"./el-pagination-BZTeeDdF.js";import{E as Se,a as Fe}from"./el-table-column-DFYlF3gl.js";import"./el-checkbox-oKrozKwu.js";import"./el-tooltip-l0sNRNKZ.js";import{E as Ie}from"./el-popover-B_wffsG6.js";import{E as Ve}from"./el-button-CaCwkDis.js";import{I as v}from"./iconify-BwnrVFpF.js";import{d as Ne,o as Pe,c as $e,p as Ue}from"./material-Co1NEuoq.js";import{_ as De}from"./group.vue_vue_type_script_setup_true_lang-BvEpzQXj.js";import{E as Ge}from"./index-CduaMGvE.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DMdzZa0p.js";import"./use-form-item-OJvLHTB4.js";import"./refs-C2TW7dIb.js";import"./_Uint8Array-BK-oSTMd.js";import"./_initCloneObject-C4kFkGVc.js";const Te={class:"grid grid-cols-12 gap-4 mt-1"},Be={class:"col-span-2 bg-white rounded-md p-4"},Me={class:"mr-4",style:{width:"100%"}},Re={class:"mt-2"},je={class:"col-span-10 bg-white rounded-md p-4"},Oe={style:{height:"82.5vh",overflow:"auto"}},Ae=["onClick"],Ye={key:0},He=["href"],Je={class:"mt-4"},We={class:"mx-auto max-w-full"},Xe=["src"],Ze=me({__name:"file",setup(qe){const u=p(!1),y=p([{value:0,label:"默认分组"}]);function I(){Ne({type:0}).then(e=>{try{y.value=e.data.data.data.map(s=>({value:s.id,label:s.name})),y.value.unshift({value:0,label:"默认分组"})}catch{}}).catch(e=>{})}function M(l){const e=y.value.find(s=>s.value==l);return e?e.label:"未知分组"}const g=p(!1),d=U({group:"默认分组",desc:""});function R(){g.value=!0,I()}function j(){u.value=!0;const l=new FormData;h.value.forEach(e=>{e instanceof File&&l.append("Files",e)}),d.group=="默认分组"?l.append("GroupId",String(0)):l.append("GroupId",String(d.group)),l.append("Description",d.desc),Pe(l).then(e=>{e.data.data,g.value=!1,F({message:"上传文件成功",type:"success"}),_()}).catch(e=>{}).finally(()=>{u.value=!1}),k()}function k(){C.value.clearFiles(),d.desc="",d.group="默认分组",g.value=!1,h.value=[]}const C=p(),h=p([]);function O(l,e){C.value.clearFiles(),h.value=[]}const A=l=>{},Y=(l,e)=>{const s=l.raw;h.value.push(s)},w=p(""),V=p([]);function _(){u.value=!0;const l={GroupId:d.group==="默认分组"?null:Number(d.group),Like:w.value,pageNum:r.pageNum,pageSize:r.pageSize};$e(l).then(e=>{try{V.value=e.data.data.data,r.pageNum=e.data.data.pageNumber,r.pageSize=e.data.data.pageSize,r.total=e.data.data.totalCount}catch{}}).catch(e=>{}).finally(()=>{u.value=!1})}function H(l){u.value=!0;const e={ids:l.id};Ue(e).then(s=>{F({message:"删除文件成功",type:"error"}),_()}).catch(s=>{}).finally(()=>{u.value=!1})}const J=()=>{},r=U({pageSizes:[1,10,20,50],pageSize:10,pageNum:1,total:400}),W=l=>{_()},X=l=>{_()},Z=p(),q=p([]),K=l=>{q.value=l};function Q(l){if(l){if(l=="账号异常，文件保存失败！")return"error";const e=l.lastIndexOf(".");if(e!==-1){const s=l.substring(e+1).toLowerCase();return["jpg","jpeg","png","gif","bmp","tiff","webp"].includes(s)?"image":"file"}}}function ee(l){let e="https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/"+l;navigator.clipboard.writeText(e).then(()=>{F({message:"成功复制到剪贴板",type:"success"})}).catch(s=>{console.error("复制文本失败:",s)})}const E=p(!1),N=p(""),te=l=>{N.value=l,E.value=!0},le=()=>{E.value=!1};return fe(()=>{_(),I()}),(l,e)=>{const s=Ve,S=Ge,c=Se,oe=Ce,ae=ge("spen"),ne=Ie,se=Fe,ie=Ee,re=he,de=be,x=xe,pe=ke,ue=ze,ce=ye,P=we;return m(),b(B,null,[i("div",Te,[i("div",Be,[i("div",null,[e[11]||(e[11]=i("div",{class:"mb-4 px-2 py-2",style:{"border-bottom":"1px dashed #ccc"}}," 文件素材 ",-1)),i("div",null,[i("div",Me,[t(S,{modelValue:a(w),"onUpdate:modelValue":e[0]||(e[0]=o=>D(w)?w.value=o:null),style:{"max-width":"230px"},placeholder:"Please input",class:"input-with-select"},{append:n(()=>[t(s,{type:"primary",plain:"",onClick:_},{default:n(()=>[t(a(v),{icon:"mingcute:search-fill",style:{"font-size":"22px"}})]),_:1})]),_:1},8,["modelValue"])]),i("div",Re,[t(s,{type:"primary",plain:"",class:"w-full overflow-hidden text-overflow-ellipsis",onClick:e[1]||(e[1]=o=>R())},{default:n(()=>[t(a(v),{icon:"tabler:message-plus",style:{"font-size":"22px"}}),e[9]||(e[9]=i("span",{class:"hidden lg:inline-block ml-2"},"新增文件",-1)),e[10]||(e[10]=i("span",{class:"hidden md:inline-block lg:hidden ml-2"},"新增文件",-1))]),_:1})])])]),t(De,{typeId:0})]),G((m(),b("div",je,[i("div",null,[i("div",Oe,[G((m(),L(se,{ref_key:"tableRef",ref:Z,data:a(V),style:{width:"100%"},border:"",onSelectionChange:K,height:"full"},{default:n(()=>[t(c,{type:"selection",width:"55"}),t(c,{prop:"name",label:"文件名"}),t(c,{prop:"description",label:"文件描述"}),t(c,{prop:"filePath",label:"文件路径"},{default:n(o=>[t(oe,{class:"box-item",effect:"dark",content:"点击复制文件路径",placement:"top"},{default:n(()=>[i("div",{class:"cursor-pointer",onClick:$=>ee(o.row.filePath)},z(o.row.filePath),9,Ae)]),_:2},1024)]),_:1}),t(c,{prop:"groupId",label:"分组"},{default:n(o=>[i("span",null,z(M(o.row.groupId)),1)]),_:1}),t(c,{prop:"createTime",label:"文件创建时间"}),t(c,null,{header:n(()=>e[12]||(e[12]=[i("div",{class:"must"},[i("span",{class:"red"}),f("操作")],-1)])),default:n(o=>[Q(o.row.filePath)=="image"?(m(),b("div",Ye,[t(s,{type:"primary",size:"small",plain:""},{default:n(()=>[t(a(v),{icon:"mdi-light:delete",style:{"font-size":"18px"}}),t(ae,{onClick:$=>te(`https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/${o.row.filePath}`)},{default:n(()=>e[13]||(e[13]=[f(" 预览文件 ")])),_:2},1032,["onClick"])]),_:2},1024)])):T("",!0),t(s,{type:"primary",size:"small",plain:""},{default:n(()=>[t(a(v),{icon:"mdi-light:delete",style:{"font-size":"18px"}}),i("a",{href:`https://tg-worker-files.oss-cn-hongkong.aliyuncs.com/${o.row.filePath}`,target:"_blank"},"下载文件",8,He)]),_:2},1024),t(ne,{"confirm-button-text":"Yes","cancel-button-text":"No","icon-color":"#626AEF",title:l.$t("userMarger.user.areSureDel"),onConfirm:$=>H(o.row),onCancel:J},{reference:n(()=>[t(s,{size:"small",type:"danger",plain:""},{default:n(()=>[t(a(v),{icon:"mdi-light:delete",style:{"font-size":"18px"}}),e[14]||(e[14]=f(" 删除文件 "))]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"])),[[P,a(u)]])]),i("div",Je,[t(ie,{"current-page":a(r).pageNum,"onUpdate:currentPage":e[2]||(e[2]=o=>a(r).pageNum=o),"page-size":a(r).pageSize,"onUpdate:pageSize":e[3]||(e[3]=o=>a(r).pageSize=o),"page-sizes":a(r).pageSizes,"onUpdate:pageSizes":e[4]||(e[4]=o=>a(r).pageSizes=o),total:a(r).total,"onUpdate:total":e[5]||(e[5]=o=>a(r).total=o),size:"default",background:!0,layout:"total, sizes, prev, pager, next, jumper","default-current-page":1,onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","page-sizes","total"])])])])),[[P,a(u)]]),t(ce,{modelValue:a(g),"onUpdate:modelValue":e[8]||(e[8]=o=>D(g)?g.value=o:null),title:"新增文件",width:"600","destroy-on-close":"",onClose:k},{default:n(()=>[t(ue,{inline:!0,model:a(d),class:"demo-form-inline"},{default:n(()=>[t(x,{label:"选择分组",prop:"group","label-width":"100px"},{default:n(()=>[t(de,{modelValue:a(d).group,"onUpdate:modelValue":e[6]||(e[6]=o=>a(d).group=o),placeholder:"选择分组",style:{width:"300px"},filterable:""},{default:n(()=>[(m(!0),b(B,null,_e(a(y),o=>(m(),L(re,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(x,{label:"文件描述",prop:"desc","label-width":"100px"},{default:n(()=>[t(S,{modelValue:a(d).desc,"onUpdate:modelValue":e[7]||(e[7]=o=>a(d).desc=o),placeholder:"请输入文件描述",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),t(x,{label:"导入文件","label-width":"100px"},{default:n(()=>[t(pe,{ref_key:"uploadRef",ref:C,class:"upload-demo","file-list":a(h),"auto-upload":!1,"on-preview":A,"on-remove":O,"on-change":Y,multiple:!0,limit:10,drag:"",style:{width:"420px"}},{default:n(()=>[t(a(v),{class:"w-1/2 mx-auto el-icon--upload",icon:"uiw:cloud-upload",style:{"font-size":"50px"}}),e[15]||(e[15]=i("div",{class:"el-upload__text"},[f(" 请"),i("em",null,"点击或拖拽"),f("上传文件 ")],-1))]),_:1},8,["file-list"])]),_:1}),t(x,{class:"ml-96"},{default:n(()=>[t(s,{onClick:k},{default:n(()=>[f(z(l.$t("btn.cancel")),1)]),_:1}),t(s,{type:"primary",onClick:j},{default:n(()=>[f(z(l.$t("btn.confirm")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(ve,{name:"zoom-fade",mode:"out-in"},{default:n(()=>[a(E)?(m(),b("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",style:{"z-index":"100"},onClick:le},[i("div",We,[i("img",{src:a(N),class:"object-cover w-full"},null,8,Xe)])])):T("",!0)]),_:1})],64)}}}),yt=Le(Ze,[["__scopeId","data-v-42268e0d"]]);export{yt as default};
