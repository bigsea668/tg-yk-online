import{d as ce,t as r,o as u,b as B,X as n,a3 as a,i as s,H as D,e as l,h as m,J as M,a2 as R,Z as y,Y as d,a8 as fe,$ as J,a9 as g,D as H}from"./index-SkQIWFxF.js";import{b as ve,c as ye,v as ke}from"./el-select-aoHRwLzr.js";import{E as be,a as he}from"./el-table-column-DFYlF3gl.js";import"./el-checkbox-oKrozKwu.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-scrollbar-B_RdZN1g.js";import{E as _e}from"./el-link-B2C_eMCh.js";import"./el-tag-C-Ar2SHx.js";import{E as ge,a as we}from"./el-form-item-DjY6-g6w.js";import{E as xe}from"./el-button-CaCwkDis.js";import{E as Ce}from"./el-switch-BbWJ60z-.js";import{I as f}from"./iconify-BwnrVFpF.js";import{g as Ne,b as Ee,c as ze}from"./el-step-C8DOLRVt.js";import{q as Le}from"./material-Co1NEuoq.js";import{b as Te}from"./account-BPjtnxSe.js";import{c as $e,e as Q}from"./utils-DqIM6Gu8.js";import{t as Ve}from"./task.StatusEnum-Cm9n79jd.js";import{a as q}from"./account.StatusEnum-BL7b9Vtv.js";import{_ as Se,a as Ue}from"./phoneSend.vue_vue_type_script_setup_true_lang-CPi3W6qV.js";import{_ as Ie}from"./oneClickG.vue_vue_type_script_setup_true_lang-Bh55nVue.js";import{E as Ae}from"./index-CduaMGvE.js";import{E as Be}from"./index-DMdzZa0p.js";import"./refs-C2TW7dIb.js";import"./use-form-item-OJvLHTB4.js";import"./_Uint8Array-BK-oSTMd.js";import"./_initCloneObject-C4kFkGVc.js";import"./validator-c3EkaPfX.js";import"./el-upload-BngSqAe8.js";/* empty css                        */import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./accountList.vue_vue_type_script_setup_true_lang-ooIg10n3.js";import"./im-BIoPmwMT.js";const De={class:"bg-white rounded-md p-4 mb-2 mt-1"},Me={style:{float:"left"}},je={style:{float:"right"}},Fe={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},Ge={class:"bg-white rounded-md p-4",style:{height:"81vh"}},Oe={class:"pb-2 flex justify-between",style:{"border-bottom":"1px dashed #ccc"}},Re={style:{float:"left"}},Je={class:"ml-6",style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},He={class:"mt-4"},Qe={class:"flex justify-center items-center mb-4 py-2"},qe={class:"mr-4"},Pe={class:"mr-4"},Xe={class:"mr-4"},Ye={class:""},$t=ce({__name:"gmCollect",setup(Ze){const h=r(!1),T=r(!1),$=r(!1),w="https://t.me/",j=r([]);function P(){T.value=!0,Te().then(o=>{try{j.value=o.data.data.data.map(e=>({status:e.account.status,value:e.account.id,label:e.account.nickName,phone:e.account.phone}))}catch{}}).catch(o=>{}).finally(()=>{T.value=!1})}const N=r([]),V=r(),x=r(),C=r(),c=r({accountId:"",groupLink:"https://t.me/demoTestOpen",join:!1});function X(o){o.status!=q.Online&&(g.error("该账号未登录"),c.value.accountId="")}const Y=()=>{h.value=!0;const o={id:c.value.accountId,group_url:c.value.groupLink,join:c.value.join};Ne(o).then(e=>{try{V.value=e.data.data.isChannel,x.value=e.data.data.mainUsername,C.value=e.data.data.title,N.value=e.data.data.taskGatherGroupMembers,g({message:H("p",{style:"line-height: 1; font-size: 14px"},[H("span",null,`${e.data.message}`)])})}catch{}}).catch(e=>{g.error("采集失败")}).finally(()=>{h.value=!1}),E.value=""},Z=r(),_=r([]),K=o=>{_.value=o};function W(o){$e(w,o)}const F=r([]),E=r();function ee(){$.value=!0;const o={taskType:Ve.GatherGroupMembers};Ee(o).then(e=>{try{F.value=e.data.data.map(i=>({id:i.id,name:i.name,type:i.type,userId:i.userId,status:i.status,createTime:i.createTime,endTime:i.endTime,totalMumberTasks:i.totalMumberTask,completedQuantity:i.completedQuantity,task_data:i.task_data?JSON.parse(i.task_data):null,userNameURL:i.task_data?w+JSON.parse(i.task_data).MainUsername:null}))}catch{}}).catch(e=>{}).finally(()=>{$.value=!1}),c.value.accountId=""}function te(o){V.value=o.task_data?o.task_data.IsChannel:"",x.value=o.task_data?o.task_data.MainUsername:"",C.value=o.task_data?o.task_data.Title:"",h.value=!0;const e={id:o.id};ze(e).then(i=>{try{g.success("获取任务详情成功"),N.value=i.data.data}catch{}}).catch(i=>{g.error("获取任务详情失败")}).finally(()=>{h.value=!1})}function le(){const o=_.value.map(p=>({userName:p.userName,phone:p.phone,isActive:p.isActive,isBot:p.isBot,mainName:`${w}${p.mainName}`})),e={userName:"昵称",phone:"电话号",isActive:"是否活跃",isBot:"是否机器人",mainName:"用户链接"},i=`群采集数据-${C.value}-${x.value}`;Q(o,i,e)}function ae(){const o=N.value.map(p=>({userName:p.userName,phone:p.phone,isActive:p.isActive,isBot:p.isBot,mainName:`${w}${p.mainName}`})),e={userName:"昵称",phone:"电话号",isActive:"是否活跃",isBot:"是否机器人",mainName:"用户链接"},i=`群采集数据-${C.value}-${x.value}`;Q(o,i,e)}const S=r(!1);function oe(){S.value=!0}const U=r(!1);function se(){U.value=!0}const I=r(!1),G=r(""),O=r("");function ne(o){I.value=!0,o.phone?G.value=o.phone:O.value=`@${o.mainName}`}function ie(o){const e=new FormData;e.append("phones",o.phone),e.append("group_id",String(0)),e.append("remarks","从群采集添加的联系人素材"),Le(e).then(i=>{g.success("新增到素材成功")}).catch(i=>{}).finally(()=>{h.value=!1})}return(o,e)=>{const i=ve,p=ye,z=ge,re=Ae,de=Ce,v=xe,ue=we,k=Be,b=be,pe=_e,me=he,A=ke;return u(),B(M,null,[n("div",null,[n("div",De,[a(ue,{inline:!0,model:l(c),class:"demo-form-inline"},{default:s(()=>[a(z,{label:"选择账号"},{default:s(()=>[D((u(),m(p,{modelValue:l(c).accountId,"onUpdate:modelValue":e[0]||(e[0]=t=>l(c).accountId=t),placeholder:"选择账号",clearable:"",filterable:"",style:{width:"180px"},onClick:P},{default:s(()=>[(u(!0),B(M,null,R(l(j),t=>(u(),m(i,{key:t.value,label:t.label,value:t.value,onClick:L=>X(t)},{default:s(()=>[n("span",Me,y(t.label),1),n("span",je,[t.status===l(q).Online?(u(),m(l(f),{key:0,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-green-600"})):(u(),m(l(f),{key:1,icon:"ic:round-lens",style:{"font-size":"10px"},class:"ml-2 text-red-600"}))]),n("span",Fe,y(t.phone),1)]),_:2},1032,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])),[[A,l(T)]])]),_:1}),a(z,{label:"群链接"},{default:s(()=>[a(re,{modelValue:l(c).groupLink,"onUpdate:modelValue":e[1]||(e[1]=t=>l(c).groupLink=t),placeholder:"请输入群链接",clearable:"",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(z,null,{default:s(()=>[a(de,{modelValue:l(c).join,"onUpdate:modelValue":e[2]||(e[2]=t=>l(c).join=t),size:"large","active-text":"加入群","inactive-text":"不加入群"},null,8,["modelValue"])]),_:1}),a(z,null,{default:s(()=>[a(v,{type:"primary",onClick:Y},{default:s(()=>[a(l(f),{icon:"hugeicons:message-user-01",style:{"font-size":"22px"},class:"mr-2"}),e[7]||(e[7]=d(" 采集群成员 "))]),_:1})]),_:1})]),_:1},8,["model"])]),n("div",Ge,[n("div",Oe,[n("div",null,[e[8]||(e[8]=d(" 查询历史采集任务数据 ")),D((u(),m(p,{modelValue:l(E),"onUpdate:modelValue":e[3]||(e[3]=t=>fe(E)?E.value=t:null),placeholder:"选择历史任务",clearable:"",filterable:"",style:{width:"180px"},class:"mr-2",onClick:ee},{default:s(()=>[(u(!0),B(M,null,R(l(F),t=>(u(),m(i,{key:t.id,label:t.name,value:t.id,onClick:L=>te(t)},{default:s(()=>[n("span",Re,y(t.name),1),n("span",Je,y(t==null?void 0:t.userNameURL),1)]),_:2},1032,["label","value","onClick"]))),128))]),_:1},8,["modelValue"])),[[A,l($)]])]),n("div",null,[a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:oe,disabled:l(_).length===0},{default:s(()=>[a(l(f),{icon:"tabler:message-share",style:{"font-size":"22px"}}),e[9]||(e[9]=n("span",{class:"hidden lg:inline-block ml-2"},"一键群发",-1)),e[10]||(e[10]=n("span",{class:"hidden md:inline-block lg:hidden ml-2"},"一键群发",-1))]),_:1},8,["disabled"]),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:se,disabled:l(_).length===0},{default:s(()=>[a(l(f),{icon:"fluent:contact-card-link-20-filled",style:{"font-size":"22px"}}),e[11]||(e[11]=n("span",{class:"hidden lg:inline-block ml-2"},"导入为联系人",-1)),e[12]||(e[12]=n("span",{class:"hidden md:inline-block lg:hidden ml-2"},"导入为联系人",-1))]),_:1},8,["disabled"]),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:ae},{default:s(()=>[a(l(f),{icon:"material-symbols:file-export-rounded",style:{"font-size":"22px"}}),e[13]||(e[13]=n("span",{class:"hidden lg:inline-block ml-2"},"一键导出所有数据",-1)),e[14]||(e[14]=n("span",{class:"hidden md:inline-block lg:hidden ml-2"},"一键导出所有数据",-1))]),_:1}),a(v,{type:"primary",plain:"",class:"overflow-hidden text-overflow-ellipsis",onClick:le},{default:s(()=>[a(l(f),{icon:"material-symbols:file-export-rounded",style:{"font-size":"22px"}}),e[15]||(e[15]=n("span",{class:"hidden lg:inline-block ml-2"},"导出选中数据",-1)),e[16]||(e[16]=n("span",{class:"hidden md:inline-block lg:hidden ml-2"},"导出选中数据",-1))]),_:1})])]),n("div",He,[e[29]||(e[29]=n("div",{class:"mb-4 p-2 px-4 flex justify-between items-center",style:{"border-left":"5px solid #409eff"}},"群信息",-1)),n("div",Qe,[n("span",qe,[e[17]||(e[17]=d("群标题 ")),a(k,{type:"primary",size:"large"},{default:s(()=>[d(y(l(C)),1)]),_:1})]),n("span",Pe,[e[18]||(e[18]=d("是否为频道 ")),a(k,{type:"primary",size:"large"},{default:s(()=>[d(y(l(V)),1)]),_:1})]),n("span",Xe,[e[19]||(e[19]=d("群名 ")),a(k,{type:"primary",size:"large"},{default:s(()=>[d(y(l(x)),1)]),_:1})])]),D((u(),m(me,{"element-loading-text":"正在采集群成员...",ref_key:"tableRef",ref:Z,data:l(N),style:{width:"100%",height:"58vh"},border:"",onSelectionChange:K},{default:s(()=>[a(b,{type:"selection",width:"55"}),a(b,{prop:"userName",label:"名称"}),a(b,{prop:"phone",label:"手机号码"}),a(b,{prop:"isActive",label:"是否活跃",width:"100"},{default:s(t=>[t.row.isActive?(u(),m(k,{key:0,type:"success",size:"large"},{default:s(()=>e[20]||(e[20]=[d("活跃")])),_:1})):(u(),m(k,{key:1,type:"info",size:"large"},{default:s(()=>e[21]||(e[21]=[d("不活跃")])),_:1}))]),_:1}),a(b,{prop:"isBot",label:"是否为机器人",width:"120"},{default:s(t=>[t.row.isBot?(u(),m(k,{key:0,type:"success",size:"large"},{default:s(()=>e[22]||(e[22]=[d("是")])),_:1})):(u(),m(k,{key:1,type:"info",size:"large"},{default:s(()=>e[23]||(e[23]=[d("否")])),_:1}))]),_:1}),a(b,{prop:"mainName",label:"用户链接"},{default:s(t=>[n("div",Ye,[a(pe,{type:"primary",href:`${l(w)}${t.row.mainName}`,target:"_blank"},{default:s(()=>[d(y(t.row.mainName),1)]),_:2},1032,["href"]),e[25]||(e[25]=n("br",null,null,-1)),a(v,{onClick:L=>W(t.row.mainName)},{default:s(()=>e[24]||(e[24]=[d("复制用户链接")])),_:2},1032,["onClick"])])]),_:1}),a(b,null,{header:s(()=>e[26]||(e[26]=[n("div",{class:"must"},[n("span",{class:"red"}),d("操作")],-1)])),default:s(t=>[t.row.phone||t.row.mainName?(u(),m(v,{key:0,size:"small",type:"primary",plain:"",onClick:L=>ne(t.row)},{default:s(()=>[a(l(f),{icon:"wpf:chat",style:{"font-size":"18px"},class:"mr-2"}),e[27]||(e[27]=d(" 私聊 "))]),_:2},1032,["onClick"])):J("",!0),t.row.phone?(u(),m(v,{key:1,size:"small",type:"success",plain:"",onClick:L=>ie(t.row)},{default:s(()=>[a(l(f),{icon:"wpf:chat",style:{"font-size":"18px"},class:"mr-2"}),e[28]||(e[28]=d(" 添到联系人素材 "))]),_:2},1032,["onClick"])):J("",!0)]),_:1})]),_:1},8,["data"])),[[A,l(h)]])])])]),a(Ie,{show:l(S),multipleSelect:l(_),"onUp:show":e[4]||(e[4]=t=>S.value=t)},null,8,["show","multipleSelect"]),a(Se,{show:l(U),multipleSelect:l(_),"onUp:show":e[5]||(e[5]=t=>U.value=t)},null,8,["show","multipleSelect"]),a(Ue,{show:l(I),phone:l(G),mainName:l(O),"onUp:show":e[6]||(e[6]=t=>I.value=t)},null,8,["show","phone","mainName"])],64)}}});export{$t as default};
